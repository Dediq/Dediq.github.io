typeof cfg=="undefined"&&(cfg={defaultCity:"intercity"});var ti={stops:0,routes:0,shapes:{},distances:{},taxi:[],specialDates:{},specialWeekdays:{},asciiStops:{},cityTransportRoutes:{},FLD_ID:0,FLD_CITY:1,FLD_AREA:2,FLD_STREET:3,FLD_NAME:4,FLD_INFO:5,FLD_LNG:6,FLD_LAT:7,FLD_STOPS:8,FLD_DIRS:9,RT_ROUTEID:0,RT_ORDER:1,RT_ROUTENUM:2,RT_AUTHORITY:3,RT_CITY:4,RT_TRANSPORT:5,RT_OPERATOR:6,RT_VALIDITYPERIODS:7,RT_SPECIALDATES:8,RT_ROUTETAG:9,RT_ROUTETYPE:10,RT_COMMERCIAL:11,RT_ROUTENAME:12,RT_WEEKDAYS:13,RT_ENTRY:14,RT_STREETS:15,RT_ROUTESTOPSPLATFORMS:16,RT_ROUTESTOPS:17,accent_map:{"ą":"a","ä":"a","ā":"a","č":"c","ę":"e","ė":"e","į":"i","ų":"u","ū":"u","ü":"u","ž":"z","ē":"e","ģ":"g","ī":"i","ķ":"k","ļ":"l","ņ":"n","ö":"o","õ":"o","š":"s","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"e","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"x","ц":"c","ч":"ch","ш":"sh","щ":"shh","ъ":!0,"ы":"y","ь":!0,"э":"je","ю":"ju","я":"ja","№":"n","–":"-","—":"-","̶":"-","­":"-","˗":"-","“":!0,"”":!0,"„":!0,"'":!0,"\"":!0},wordSeparators:"–—̶­˗“”„ _-.()'\""};ti.SERVER=typeof window=="object"?1:!0;if(typeof cfg=="object"){cfg.city=cfg.city||{},cfg.city.transport=cfg.city.transport||[];for(var i=0;i<cfg.city.transport.length;i++){var tr=cfg.city.transport[i];cfg.transportOrder[tr]=i+1}cfg.defaultCity=="klaipeda"?ti.transportRoutes=function(a,b){var c=new RegExp("[0-9][eE]"),d=a.split("(",1)[0].trim();if(d&&c.test(d))return"expressbus";if(b=="nightbus"||",N1,33,44A,55,66,88,140,170,".indexOf(","+d+",")>=0)return"nightbus";if(d=="31"||d=="32"||d.substring(0,1).toLowerCase()=="m")return"minibus";return"bus"}:cfg.defaultCity=="riga"&&(ti.transportRoutes=function(a,b){var c=/3[0-9][0-9]/;if(a&&c.test(a))return"expressbus";return b})}typeof window=="object"&&typeof console=="undefined"&&(window.console={log:function(){}}),String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},ti.dateToMinutes=function(a,b){var c=+a/6e4;b||(c=Math.floor(c)),c-=a.getTimezoneOffset();return c},ti.dateToDays=function(a){return Math.floor(ti.dateToMinutes(a)/1440)},ti.printTime=function(a,b,c){if(a<0)return"";!b&&b!==""&&(b=":");var d=~~a,e=~~(d/60);c=="duration"?c="":typeof cfg=="object"&&cfg.defaultCity!="intercity"&&(e%=24),d=d%60;return(c&&e<10?c:"")+e+b+(d<10?"0":"")+d},ti.printTimeWithSeconds=function(a,b,c){if(a<0)return"";!b&&b!==""&&(b=":");var d=~~a,e=~~(d/60),f=~~(e/60);c=="duration"?c="":typeof cfg=="object"&&cfg.defaultCity!="intercity"&&(f%=24),e=e%60,d=d%60;return(c&&f<10?c:"")+f+b+(e<10?"0":"")+e+b+(d<10?"0":"")+d},ti.toMinutes=function(a){if(typeof a!="string")return 0;var b=a.trim(),c=b.length,d;if(b.indexOf(":")<0){d=parseInt(b.substr(c-2,2),10);return c>2?d+parseInt(b.substr(0,c-2),10)*60:d*60}var e=a.split(":");d=parseInt(e[0],10)*60+parseInt(e[1],10),e[2]&&parseInt(e[2],10)>=30&&++d;return d},ti.fDownloadUrl=function(a,b,c,d){if(a&&b&&c){if(ti.SERVER===!0){http.get(b,function(a){a.setEncoding("utf8");var b="";a.on("data",function(a){b+=a}),a.on("end",function(){c(b)}),a.on("error",function(){})}).on("error",function(a){});return}var e;if(!window.XMLHttpRequest||window.location.protocol==="file:"&&window.ActiveXObject){try{e=new ActiveXObject("MSXML2.XMLHTTP.6.0")}catch(f){}if(!e)try{e=new ActiveXObject("MSXML2.XMLHTTP")}catch(f){}if(!e)try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(f){}}else e=new XMLHttpRequest,(d||b.indexOf("http")==0)&&!("withCredentials"in e)&&typeof XDomainRequest!="undefined"&&(e=new XDomainRequest,e.open(a,b),e.onload=function(){c(e.responseText)});e.open(a,b,!0),e.onreadystatechange=function(){if(e.readyState==4)if(e.status==200||e.status==0)typeof e.responseText=="string"?c(e.responseText):typeof e.responseXML=="string"?c(e.responseXML):c(e.responseText)};try{e.send(null)}catch(g){}}},ti.toAscii=function(a,b,c){var d=(a||"").toLowerCase(),e=d.split(""),f,g=ti.accent_map;for(var h=e.length;--h>=0;)c&&e[h]=="ž"?(e[h]="zh",d=!1):(f=g[e[h]])?(e[h]=f===!0?"":f,d=!1):b===!0&&e[h]===" "&&(e[h]="",d=!1);b===2&&(d=e.join("").trim().replace(/\s+-/g,"-").replace(/-\s+/g,"-"));return d||e.join("")},ti.cloneObject=function(a){var b=a instanceof Array?[]:{};for(var c in a)a[c]&&typeof a[c]=="object"?b[c]=a[c].clone():b[c]=a[c];return b},ti.naturalSort=function(a,b){var c=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,d=/(^[ ]*|[ ]*$)/g,e=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,f=/^0x[0-9a-f]+$/i,g=/^0/,h=a.toString().replace(d,"")||"",i=b.toString().replace(d,"")||"",j=h.replace(c,"\u0000$1\u0000").replace(/\0$/,"").replace(/^\0/,"").split("\u0000"),k=i.replace(c,"\u0000$1\u0000").replace(/\0$/,"").replace(/^\0/,"").split("\u0000"),l=parseInt(h.match(f))||j.length!=1&&h.match(e)&&Date.parse(h),m=parseInt(i.match(f))||l&&i.match(e)&&Date.parse(i)||null;if(m){if(l<m)return-1;if(l>m)return 1}for(var n=0,o=Math.max(j.length,k.length);n<o;n++){oFxNcL=!(j[n]||"").match(g)&&parseFloat(j[n])||j[n]||0,oFyNcL=!(k[n]||"").match(g)&&parseFloat(k[n])||k[n]||0;if(isNaN(oFxNcL)!==isNaN(oFyNcL))return isNaN(oFxNcL)?1:-1;typeof oFxNcL!==typeof oFyNcL&&(oFxNcL+="",oFyNcL+="");if(oFxNcL<oFyNcL)return-1;if(oFxNcL>oFyNcL)return 1}return 0},ti.loadData=function(){if(typeof cfg==="object"&&cfg.city&&cfg.city.datadir){var a=new Date;location.pathname.indexOf("test.html")<0?a=a.setHours(a.getHours(),0,0,0):(a=a.getTime(),cfg.city.datadir="test"),cfg.city.datadir.indexOf(".php")<0?(ti.fDownloadUrl("get",cfg.city.datadir+"/routes.txt?"+a,ti.loadRoutes),ti.fDownloadUrl("get",cfg.city.datadir+"/stops.txt?"+a,ti.loadStops)):(ti.fDownloadUrl("get",cfg.city.datadir+"routes.txt&timestamp="+a,ti.loadRoutes,!0),ti.fDownloadUrl("get",cfg.city.datadir+"stops.txt&timestamp="+a,ti.loadStops,!0))}else ti.fDownloadUrl("get","routes.txt",ti.loadRoutes),ti.fDownloadUrl("get","stops.txt",ti.loadStops);cfg.defaultCity==="latvia"&&ti.fDownloadUrl("get","taxi.txt",ti.loadTaxi)},ti.loadStops=function(a,b){a=a.split(b||"\n");var c="",d="",e="",f="",g="",h="",i="",j={},k={},l=[],m=a.length,n=a[0].toUpperCase().split(";"),o={};for(var p=n.length;--p>=0;)o[n[p]]=p;o.ID=0;for(var p=1;p<m;p++)if(a[p].length>1){var q=a[p].split(";"),r=q[o.CITY];r&&(d=r==="0"?"":r.trim());var s=c+ti.toAscii(q[o.ID],!0,!0),t=q[o.SIRIID],u=ti.toAscii(q[o.STOPS]||"",!0,!0);c&&(u=c+u.replace(/,/g,","+c));if(r=q[o.AREA])e=r==="0"?"":r.trim();if(r=q[o.STREET])f=r==="0"?"":r.trim();if(r=q[o.NAME]){g=r==="0"?"":r,h=ti.toAscii(r);var v=k[h];k[h]=v?v+","+s:s}else k[h]+=","+s;if(r=q[o.INFO])i=r==="0"?"":r;var w={id:s,siriID:t,lat:+q[o.LAT]/1e5,lng:+q[o.LNG]/1e5,name:g,city:d,area:e,street:f,info:i,towards:o.DIRECTION?q[o.DIRECTION]:"",raw_data:[s,d,e,f,g,i,q[o.LNG],q[o.LAT],u].join(";")};ti.SERVER&&(w.routes=[],w.neighbours=u?u.split(","):[]),j[s]=w,l.push(w),g=="Oro uostas"&&cfg.defaultCity=="vilnius"&&(q[o.STOPS]=s,q[o.ID]="A"+s,q[o.NAME]="Vilnius airport (VNO)",a[p]=q.join(";"),p--)}ti.stops=null,ti.stops=j,ti.asciiStops=k,l.sort(function(a,b){return a.lat<b.lat?-1:a.lat>b.lat?1:0});for(p=l.length;--p>0;)if(l[p].city==="kautra"){var x=l[p].lat;for(var y=p-1;--y>=0;){var z=x-l[y].lat;if(z>.015)break;var A=l[p].lng-l[y].lng;A>-.015&&A<.015&&(l[p].neighbours.push(l[y].id),l[y].neighbours.push(l[p].id))}}typeof ti.routes=="string"&&(ti.SERVER===!0?ti.loadRoutes(ti.routes):window.setTimeout(function(){ti.loadRoutes(ti.routes)},10))},ti.loadRoutes=function(a,b){if(typeof ti.stops!=="object")ti.routes=a;else{a=a.split(b||"\n");var c=[],d=ti.stops,e={},f="",g="",h="",i="",j="",k="",l="",m="",n="",o="",p="",q="",r=0,s=a[0].toUpperCase().split(";"),t={};for(var u=s.length;--u>=0;)t[s[u]]=u;t.ROUTENUM=0,t.ROUTESTOPSPLATFORMS||(t.ROUTESTOPSPLATFORMS=-1);var v=-1,w=a.length;for(var u=1;u<w;u++)if(a[u].charAt(0)==="#"){var x=a[u].split("#"),y=null,z=null,A=new Date;x[1]!==""&&(y=new Date(x[1])),x[2]!==""&&(z=new Date(x[2]));if((!y||y<=A)&&(!z||z>=A)){var B={comment:x[3]};x[4]&&(B.departures=x[4]),x[5]&&(B.weekdays=x[5]),x[6]&&(B.directions=x[6]);var C=c[v];C.comments?C.comments.push(B):C.comments=[B]}}else if(a[u].length>1){var x=a[u].split(";"),D;if(D=x[t.AUTHORITY])h=D==="0"?"":D;if(h==="SpecialDates"){var E={},F=x[t.VALIDITYPERIODS].split(","),G=0,H=0,I=x[t.ROUTENUM]=="";for(var J=-1,K=F.length;++J<K;)F[J]&&(G=+F[J]),H+=G,I?ti.specialWeekdays[H]=+x[t.WEEKDAYS]:E[H]=!0;I||(ti.specialDates[x[t.ROUTENUM]]=E);continue}++r;if(D=x[t.ROUTENUM])f=D==="-"?"":D,r=1;if(D=x[t.ROUTENAME])g=D;if(D=x[t.CITY])i=D==="0"?"":D,l=i+"_"+k,r=1;if(D=x[t.TRANSPORT])k=D==="0"?"":D,l=i+"_"+k,r=1;var L=k;typeof cfg==="object"&&cfg.defaultCity=="vilnius"&&(f.search(/1[5-9][0-9]/)<0?f.match(/SU(.)MEN/i)?L="eventbus":f.search("traukinuk")>=0&&(L="festal"):L="commercialbus",l=i+"_"+L),typeof cfg==="object"&&cfg.defaultCity=="riga"&&f.search(/[3-9][0-9][0-9]/)>=0&&(L="expressbus",l=i+"_"+L),typeof ti.transportRoutes=="function"&&(L=ti.transportRoutes(f,k),l=i+"_"+L),l&&(ti.cityTransportRoutes[i+"_"+L]=!0,l="");if(D=x[t.OPERATOR])m=D==="0"?"":D;if(D=x[t.VALIDITYPERIODS])n=D==="0"?"":D;if(D=x[t.SPECIALDATES])o=D==="0"?"":D;if(D=x[t.WEEKDAYS])p=D==="0"?"":D;q=t.STREETS?x[t.STREETS]:"";if(f.indexOf("разв")>=0){++u;continue}++v;var M=ti.toAscii(x[t.ROUTESTOPS],!0,!0).split(","),N=!1;for(var O=0,P=M.length;O<P;++O){var Q=M[O];Q.charAt(0)==="e"?(N||(N=(new Array(O+1)).join("0").split("")),N[O]="1",Q=Q.substring(1),M[O]=Q):Q.charAt(0)==="x"?(N||(N=(new Array(O+1)).join("0").split("")),N[O]="2",Q=Q.substring(1),M[O]=Q):N&&(N[O]="0"),j&&(Q=M[O]=j+Q);var R=d[Q];R?(e[Q]=!0,R.raw_data+=";"+v+";"+O,(!0||ti.SERVER)&&R.routes.push(v,O)):(M.splice(O,1),--P,--O)}var S=[v,r,f,h,i,L,m,n,o,x[t.ROUTETAG],ti.toAscii(x[t.ROUTETYPE]),x[t.COMMERCIAL],g,p,N&&N.join("")||"",q,x[t.ROUTESTOPSPLATFORMS]||"",M.join(";")].join(";");++u,ti.SERVER===!0?c[v]={id:v,authority:h,city:i,transport:L,num:f,name:g,stops:M,platforms:x[t.ROUTESTOPSPLATFORMS]||"",entry:N&&N.join("")||"",specialDates:o.split(",")||[],times:a[u],raw_data:S}:c[v]={id:v,times:a[u],operator:m,raw_data:S}}ti.routes=null,ti.routes=c;if(typeof cfg==="object"&&cfg.defaultCity!=="mariupol"&&cfg.defaultCity!=="kharkiv"&&cfg.defaultCity!=="helsinki"&&cfg.defaultCity!=="pppskov"&&cfg.defaultCity!=="kautra")for(var Q in d)!e[Q]&&Q.charAt(0)!="a"&&(d[Q].name="");if(typeof cfg==="object"&&cfg.defaultCity=="latvia")for(var Q in d)d[Q].city=ti.toAscii(d[Q].city);typeof window==="object"&&typeof pg==="object"&&(pg.fCreateNavigation(),pg.fTabActivate())}},ti.fCreateGeocoder=function(){return},ti.loadTaxi=function(a,b){ti.taxi=[],a=a.split(b||"\n");var c=a.length,d=a[0].toUpperCase().split(";"),e={};for(var f=d.length;--f>=0;)e[d[f]]=f;for(var f=1;f<c;f++)if(a[f].length>1){var g=a[f].split(";"),h={name:g[e.NAME],lat:parseFloat(g[e.LAT].replace(",",".")),lng:parseFloat(g[e.LNG].replace(",",".")),radius:parseInt(g[e.RADIUS]),phone:g[e.PHONE]};h.radius*=h.radius,ti.taxi.push(h)}},ti.fGetStopsByName=function(a,b,c){if(typeof ti.stops!=="object")return[];(a||"").charAt(0)=="!"&&(c=!0,a=a.substring(1));var d=ti.toAscii(a);if(!d)return[];var e=d.replace(/\W/g,""),f=a.toLowerCase().replace(/\W/g,""),g=[],h={},i=ti.wordSeparators,j=ti.asciiStops,k=ti.routes,l=ti.stops[a];l&&typeof cfg=="object"&&cfg.defaultCity=="krasnodar"&&g.push(ti.cloneObject(ti.stops[a]));var k=ti.routes;for(var m in j){var n=-1;for(;;){n=m.indexOf(d,n+1);if(n<0)break;if(n===0||i.indexOf(m.charAt(n-1))>=0){var o=j[m].split(",");for(var p=o.length;--p>=0;){var l=ti.fGetStopDetails(o[p]);if(l.name&&(f===e||l.name.toLowerCase().replace(/\W/g,"").indexOf(f)>=0)){if(!c&&cfg.defaultCity=="intercity"){var q=[o[p]];q[0].charAt(0)=="a"&&(q=(l.neighbours||"").split(",")||[]);for(var r=0;r<q.length;r++){var s=(ti.stops[q[r]]||{}).routes||[];for(var t=0,u=s.length;t<u;t+=2){var v=k[s[t]];typeof v.times==="string"&&(v.times=ti.explodeTimes(v.times));var w=v.times;if(!w)continue;var x=w.valid_from||[],y=x.length;for(var z=0;z<y;++z)if(x[z]<4e4)break;if(z<y){t=999999;break}}}if(t<999999)continue}l.indexOf=n,l.name2=l.name.replace(/[^0-9a-zA-Z\u00C0-\u024F\u1E00-\u1EFF\u0400-\u04FF]/g,""),l.streets=(l.street!="-"?l.street:"")||l.area,l.clusterStop=l,(h[l.name2]||(h[l.name2]=[])).push(l)}}}}}for(var A in h){var q=h[A],B=0;for(var C=2;C<=2;C++)for(var p=B;p<q.length;p++){var D=q[p];if(D.id){var E;do{E=!1;for(var r=B;r<q.length;r++){if(p==r)continue;var F=q[r];if(C==1&&F.id)continue;if(C==2&&!F.id)continue;var G=0;typeof cfg=="object"&&cfg.defaultCity=="intercity"?D.area!=F.area&&(D.area||F.area)&&(G=999999):G=ti.distance(D.lat,D.lng,F.lat,F.lng);if(G<=200){E=!0;var l=C==1?F.clusterStop:D.clusterStop,H=C==1?D:F;l.id+=","+H.id,H.id="",H.clusterStop=l,H.street&&(", "+l.streets+",").indexOf(", "+H.street+",")<0&&(l.streets=(l.streets?l.streets+", ":"")+H.street)}}}while(C==2&&E)}if(C==2){C=0;while(++B<q.length)if(q[B].id)break;break}}for(var p=0;p<q.length;p++)q[p].id&&g.push(q[p])}g.sort(function(a,b){if(typeof cfg=="object"&&cfg.defaultCity=="intercity"){if(a.info&&!b.info)return-1;if(!a.info&&b.info)return 1;var c=/[a-zA-Z]/g;if(c.test(a.name)){if(!c.test(b.name))return-1}else if(c.test(b.name))return 1}if(a.id.charAt(0)==="a"&&b.id.charAt(0)!=="a")return-1;if(b.id.charAt(0)==="a"&&a.id.charAt(0)!=="a")return 1;if(typeof pg=="object"){if(a.city===pg.city&&b.city!==pg.city)return-1;if(a.city!==pg.city&&b.city===pg.city)return 1}if(a.indexOf===0&&b.indexOf!==0)return-1;if(b.indexOf===0&&a.indexOf!==0)return 1;if(a.name<b.name)return-1;if(b.name<a.name)return 1;if(a.area<b.area)return-1;if(b.area<a.area)return 1;if(a.streets<b.streets)return-1;if(b.streets<a.streets)return 1;return 0});return g},ti.fGetAnyStopDetails=function(a,b){if(!a){if(b){b({});return}return{}}if(typeof ti.stops!=="object"){if(b){setTimeout(function(){ti.fGetAnyStopDetails(a,b)},200);return}return{}}var c=typeof a=="string"?a.split(","):a,d,e,f,g;e=f=g=0;for(var h=0;h<c.length;++h){var i=ti.fGetStopDetails(c[h]);!d&&i.id&&(d=i),i&&i.lat&&i.lng&&(e+=i.lat,f+=i.lng,++g)}g&&(d.latAvg=e/g,d.lngAvg=f/g);if(b)b(d||{});else return d||{}},ti.fGetStopDetails=function(a){if(typeof ti.stops!=="object"||!a)return{};var b=ti.stops[a],c;if(!b){var d=a.indexOf(";");if(d>0){c={id:a,name:typeof pg=="object"&&a==pg.myLocation&&i18n.myLocation||typeof mobile!="undefined"&&mobile.geocoder&&mobile.geocoder.index[a]||typeof pg=="object"&&pg.geocoder2&&pg.geocoder2.index[a]||typeof pg=="object"&&pg.geocoder&&pg.geocoder.index[a]||(typeof i18n=="object"?i18n.mapPoint:"Point on map"),neighbours:"",lat:parseFloat(a.substr(0,d)),lng:parseFloat(a.substr(d+1)),raw_data:""};return c}return{}}var e=b.raw_data.split(";");c={id:e[ti.FLD_ID],city:e[ti.FLD_CITY],area:e[ti.FLD_AREA],street:e[ti.FLD_STREET],name:b.name,info:e[ti.FLD_INFO],towards:b.towards,neighbours:e[ti.FLD_STOPS],lng:ti.stops[a].lng,lat:ti.stops[a].lat,raw_data:b.raw_data};return c},ti.fGetTransfersAtStop=function(a,b,c){var d=ti.stops,e=[a],f=parseInt(a,10);if(f&&""+f!==""+a&&cfg.defaultCity!=="druskininkai"&&cfg.defaultCity!=="riga")for(var g in d)f==parseInt(g,10)&&e.push(g);return ti.fGetRoutesAtStop(e,!1,b,c)},ti.fGetRoutesAtStop=function(a,b,c,d){var e=d&&d.dirType||"-",f=d&&d.id||null,g=[],h=typeof a=="string"?a.split(","):a,i=e.split("-"),j=i[0],k=i[i.length-1],l=j.charAt(0),m=k.charAt(0);for(var n=h.length;--n>=0;){var o=(ti.stops[h[n]]||{raw_data:""}).raw_data.split(";"),p=o.length;for(var q=ti.FLD_DIRS;q<p;q+=2){var r=ti.fGetRoutes(o[q]),s=+o[q+1]<r.stops.length-1;(s||c)&&(b||!r.routeTag||r.id===f)&&(r.stopId=h[n],e&&(r.dirType.indexOf(e)<0&&e.indexOf(r.dirType)<0&&r.dirType.indexOf("-d")<0&&j!==k&&(r.dirType.indexOf(k)==0||r.dirType.indexOf(j)==r.dirType.length-1||r.dirType.indexOf("-"+m)<0&&r.dirType.indexOf(j+"-")<0&&r.dirType.indexOf(l+"-")<0&&(r.dirType.indexOf("c")<0||r.dirType.indexOf("c")>=r.dirType.length-2)))?r.sortKey="1":r.sortKey="0",r.sortKey=[cfg.transportOrder[r.transport]||"Z",("000000"+parseInt(r.num,10)).slice(-6),("000000"+parseInt(r.num.substr(1),10)).slice(-6),(r.num+"00000000000000000000").substr(0,20),n===0?"0":"1",s?"0":"1",r.sortKey,("000000"+r.order).slice(-6)].join(""),g.push(r))}}g.sort(function(a,b){if(a.sortKey<b.sortKey)return-1;if(a.sortKey>b.sortKey)return 1;return 0});return g},ti.fGetRoutes=function(a,b,c,d,e,f){var g=[],h={},i=-1,j=0,k,l,m,n,o=ti.wordSeparators;if(f){f=ti.toAscii(""+f,2);if(f.slice(0,3)=="airp"||f.slice(0,4)=="ajero")f="oro uostas"}isNaN(a)?a&&typeof a=="object"?l=a:(k=ti.routes,i=0,j=k.length,m=c&&ti.toAscii(c,!0),a=","+a+","):l=ti.routes[+a];if(ti.SERVER===!0&&i==-1)return l;var p=new RegExp("[0-9]G");while(i<j){i>=0&&(l=k[i]);var q=l.raw_data.split(";"),r=q[ti.RT_CITY],s=q[ti.RT_TRANSPORT],t=q[ti.RT_ORDER],u=q[ti.RT_ROUTENUM],v;s=="expressbus"&&u&&p.test(u)?v=u.replace("G","<sup>G</sup>"):v=u,u=ti.toAscii(u,!0);var w=q[ti.RT_ROUTETAG];if(i<0||(","+r+",").indexOf(a)>=0&&(!b||b===s||b=="xxxbus"&&s=="eventbus")&&(!m||m===u&&(!w||e===!0||e==="0"&&w.indexOf("0")<0))&&(!d||d===q[ti.RT_ROUTETYPE])){var x=(q[ti.RT_VALIDITYPERIODS]||"").split(",");for(var y=0;y<7;++y)x[y]=parseInt(x[y],10)||0,y>0&&(x[y]+=x[y-1]);if(f){var z=u.indexOf(f);z===0&&u.length>f.length&&"0123456789".indexOf(u.charAt(f.length))>=0&&(z=-1);if(z!==0){var A=ti.toAscii(q[ti.RT_ROUTENAME],2);z=A.indexOf(f),z>0&&o.indexOf(A.charAt(z-1))<0&&o.indexOf(f.charAt(0))<0&&(z=-1)}if(z>=0||f==="*"){z=0,n=ti.toAscii(r+";"+s+";"+u+";"+q[ti.RT_ROUTENAME],!0);var B=h[n];if(B){z=-1,B.weekdays+=q[ti.RT_WEEKDAYS];for(var y=0;y<7;++y)B.validityPeriods[y]<x[y]&&(B.validityPeriods[y]=x[y])}}if(z<0||w){++i;continue}}else if(i>=0&&!m){n=ti.toAscii(r+";"+s+";"+u,!0);var B=h[n];if(B){var C=q[ti.RT_ROUTETYPE];if(C==="a-b"||C.indexOf("a-b_")===0)q[ti.RT_ROUTENAME]!==B.name&&(B=null);if(B){B.dirType.indexOf("_")<0&&(B.weekdays+=q[ti.RT_WEEKDAYS]);for(var y=0;y<7;++y)B.validityPeriods[y]<x[y]&&(B.validityPeriods[y]=x[y])}}if(B&&t!=="1"){++i;continue}}var D="Z";typeof cfg==="object"&&cfg.transportOrder&&(D=cfg.transportOrder[s]||"Z"),D+=("000000"+parseInt(u,10)).slice(-6)+("000000"+parseInt(u.substr(1),10)).slice(-6)+(u+"!!!!!!!!!!!!!!!!!!!!").substr(0,20)+("000000"+t).slice(-6),g.push({id:q[0],authority:q[ti.RT_AUTHORITY],city:r,transport:s,operator:q[ti.RT_OPERATOR],commercial:q[ti.RT_COMMERCIAL],num:q[ti.RT_ROUTENUM],numHTML:v,name:q[ti.RT_ROUTENAME],routeTag:w,dirType:q[ti.RT_ROUTETYPE],weekdays:q[ti.RT_WEEKDAYS],validityPeriods:x,specialDates:(q[ti.RT_SPECIALDATES]||"").split(",")||[],entry:q[ti.RT_ENTRY],streets:q[ti.RT_STREETS],platforms:q[ti.RT_ROUTESTOPSPLATFORMS],stops:q.slice(ti.RT_ROUTESTOPS),times:l.times,order:t,sortKey:D,raw_data:l.raw_data}),n&&(h[n]=g[g.length-1])}++i}if(!j)return g[0];g.sort(function(a,b){if(a.sortKey<b.sortKey)return-1;if(a.sortKey>b.sortKey)return 1;return ti.naturalSort(a.num,b.num)||(a.order<b.order?-1:a.order>b.order?1:0)});return g},ti.fOperatorDetails=function(a,b){var c=cfg.operators[a||b];if(!c)return a;c=b&&c[b]||c;return c[(pg||{}).language]||c.en||c},ti.encodeNumber=function(a){a=a<<1,a<0&&(a=~a);var b="";while(a>=32)b+=String.fromCharCode((32|a&31)+63),a>>=5;b+=String.fromCharCode(a+63);return b},ti.explodeTimes=function(a){var b=[],c=[],d=[],e=[],f=[],g=[],h=[],i=[],j,k,l=a.split(","),m,n,o=l.length,p=[],q="+",r="-";for(m=-1,j=0,k=0,n=0;++m<o;){var s=l[m];if(s=="")break;var t=s.charAt(0);t===q?p[m]=s.charAt(1)==="0"&&s!=="+0"?"2":"1":t===r&&s.charAt(1)==="0"&&(p[m]=s.charAt(2)==="0"?"2":"1"),n+=+s,b[j++]=n}for(var u=p.length;--u>=0;)p[u]||(p[u]="0");for(var u=0;++m<o;){var v=+l[m],w=l[++m];w===""?(w=j-u,o=0):w=+w;while(w-->0)d[u++]=v}--m;for(var u=0,o=l.length;++m<o;){var v=+l[m],w=l[++m];w===""?(w=j-u,o=0):w=+w;while(w-->0)e[u++]=v}--m;for(var u=0,o=l.length;++m<o;){var x=l[m],w=l[++m];w===""?(w=j-u,o=0):w=+w;while(w-->0)c[u++]=x}if(ti.has_trips_ids){--m;var o=l.length;for(var u=0;++m<o;){if(l[m]==="")break;f[u]=+l[m],u>0&&(f[u]+=f[u-1]),++u}for(var u=0;++m<o;){if(l[m]==="")break;g[u]=l[m],++u}if(ti.has_trips_ids===2){for(var u=0;++m<o;){if(l[m]==="")break;i[u]=l[m],++u}for(var u=0;++m<o;){if(l[m]==="")break;h[u]=l[m],++u}}++m}--m,k=1;for(var u=j,y=j,z=5,o=l.length;++m<o;){z+=+l[m]-5;var w=l[++m];w!==""?(w=+w,y-=w):(w=y,y=0);while(w-->0)b[u]=z+b[u-j],++u;y<=0&&(y=j,z=5,++k)}final_data={workdays:c,times:b,tag:p.join(""),valid_from:d,valid_to:e,trip_ids:f,trip_codes:g,trip_operators:h,trip_groups:i};return final_data},ti.fGetDirTag=function(a){if(a.indexOf("-d")>=0)return"0";if(a.indexOf("2")>=0)return"2";if(a.indexOf("3")>=0)return"3";var b=a.search(/[\dcefghijklmnopqrstuvwyz]/);if(b>0){var c=a.indexOf("_");if(c<0||c>b)return"1"}return""},ti.parseParams=function(a){var b={};if(!a){b.status="UNDEFINED";return b}a.origin||(b.status="NO_ORIGIN"),a.destination||(b.status+=(b.status?",":"")+"NO_DESTINATION");var c,d,e=1;if(a.departure_time||a.arrival_time){var f=a.departure_time||a.arrival_time;typeof f=="string"?f=new Date(f.replace(/-/g,"/")):(f=parseInt(a.departure_time||a.arrival_time,10),ti.TimeZoneOffset=-(new Date).getTimezoneOffset()/60,ti.TimeZoneOffset||(ti.TimeZoneOffset=3,f*1e3>+(new Date(2015,9,25,3,0,0))&&(ti.TimeZoneOffset=2),f+=ti.TimeZoneOffset*3600),f=new Date(f*1e3)),c=new Date(f.getFullYear(),f.getMonth(),f.getDate()),d=f.getHours()*60+f.getMinutes(),e=a.departure_time?1:-1}var g={};if(typeof a.transport=="object")g=a.transport;else if(a.transport){var h=","+a.transport+",";g={train:h.indexOf("train")>=0,tram:h.indexOf("tram")>=0||h.indexOf("city")>=0,trol:h.indexOf("trol")>=0||h.indexOf("city")>=0,bus:h.indexOf("cb")>=0||h.indexOf("city")>=0},g.regionalbus=g.internationalbus=h.indexOf("bus")>=0}b={status:b.status||"OK",mode:a.mode,optimization:a.optimization,origin:a.origin,origin_name:a.origin_name,start_stops:a.origin,destination:a.destination,destination_name:a.destination_name,finish_stops:a.destination,reverse:e,date:c,start_time:d,time_window:a.time_window,results_max:a.results_max,walk_min:parseInt(a.walk_min||ti.walk_min||10,10),walk_max:parseInt(a.walk_max||ti.walk_max||1e3,10),walk_max_total:parseInt(a.walk_max_total||ti.walk_max_total||999999,10),lowFloor:!1,transport:g,walk_speed_kmh:parseInt(a.walk_speed||4,10),change_time:parseInt(a.change_time||3,10),operators:a.operators,added_trips:a.added_trips,removed_trips:a.removed_trips,changed_trips:a.changed_trips,removed_trips_by_date:null,added_trips_by_date:null,max_changes:a.max_changes,route_nums:a.route_nums,include_private:a.include_private,shapes_url:a.shapes_url,timeout:a.timeout};if(a.origin&&a.origin.indexOf(";")>0){var i=a.origin.split(";"),j=parseFloat(i[0]),k=parseFloat(i[1]);if(j>1e3||k>1e3){b.start_east=j,b.start_north=k;var l=ti.ENtoLatLng(j,k);b.start_stops=l[0]+";"+l[1]}}if(a.destination&&a.destination.indexOf(";")>0){var i=a.destination.split(";"),j=parseFloat(i[0]),k=parseFloat(i[1]);if(j>1e3||k>1e3){b.end_east=j,b.end_north=k;var l=ti.ENtoLatLng(j,k);b.finish_stops=l[0]+";"+l[1]}}b.removed_trips_by_date={},b.added_trips_by_date={};if(a.changed_trips)for(var c in a.changed_trips){var m=ti.dateToDays(new Date(c)),n="removed";for(var o=1;o<=2;o++){var p=(a.changed_trips[c][n]||"").split(",");if(p.length)for(var q=0;q<p.length;++q)b[n+"_trips_by_date"][m+":"+p[q].trim()]=!0;n="added"}}return b},ti.printParameters=function(a){if(!a.date){var b=new Date;a.date=new Date(b.getFullYear(),b.getMonth(),b.getDate())}var c={origin:a.origin,origin_name:a.origin_name,destination:a.destination,destination_name:a.destination_name,optimization:a.optimization,results_max:a.results_max,walk_min:a.walk_min+" m",walk_max:a.walk_max/1e3+" km",walk_speed:a.walk_speed_kmh+" km/h",change_time:a.change_time+" minutes",max_changes:a.max_changes,time_zone_offset:ti.TimeZoneOffset,operators:a.operators,added_trips:a.added_trips,removed_trips:a.removed_trips,changed_trips:a.changed_trips,time_window:a.time_window,include_private:a.include_private};a.date&&(c.date=a.date.yyyymmdd(".")),a.reverse==1&&(c.departure_time=ti.printTime(a.start_time)),a.reverse==-1&&(c.arrival_time=ti.printTime(a.start_time)),a.walk_max_total&&(c.walk_max_total=a.walk_max_total/1e3+" km");if(typeof a.transport=="object")c.transport=a.transport;else if(a.transport){var d="";for(var e in a.transport)a.transport[e]&&(d+=", "+e);d&&(c.transport=d.substring(2))}return c},ti.toUnixTime=function(a,b){var c=new Date(a.getFullYear(),a.getMonth(),a.getDate(),Math.floor((b||0)/60),(b||0)%60);ti.TimeZoneOffset=-c.getTimezoneOffset()/60,c=+c/1e3,ti.TimeZoneOffset||(ti.TimeZoneOffset=3,a>new Date(2017,9,29,3,0,0)&&(ti.TimeZoneOffset=2),c-=ti.TimeZoneOffset*3600);return c},Date.prototype.yyyymmdd=function(a){var b=this.getFullYear().toString(),c=(this.getMonth()+1).toString(),d=this.getDate().toString();a||(a="");return b+a+(c[1]?c:"0"+c[0])+a+(d[1]?d:"0"+d[0])},ti.gtfs_vehicle_name={bus:"bus",regionalbus:"bus",internationalbus:"bus",trol:"trol",train:"train",tram:"tram",ferry:"ferry",ship:"ship",plane:"plane",1:"tram",2:"train",3:"bus",4:"ferry",800:"trol",1e3:"ship",1100:"plane"},ti.gtfs_vehicle_type={bus:"LOCALBUS",regionalbus:"BUS",internationalbus:"BUS",trol:"TROLLEYBUS",train:"RAIL",tram:"TRAM",ferry:"FERRY",ship:"SHIP",plane:"AIR",1:"TRAM",2:"RAIL",3:"BUS",4:"FERRY",800:"TROLLEYBUS",1e3:"WATER_TRANSPORT",1100:"AIR"},ti.ToGoogleFormat=function(a){if(!a||!a.status){var b={status:"UNDEFINED",parsed_parameters:{},routes:[]};return b}if(a.status!="OK"){var b={status:a.status,parsed_parameters:ti.printParameters(a),routes:[]};return b}var c=a.results,b={parsed_parameters:ti.printParameters(a),status:c.length?"OK":"ZERO_RESULTS",calculation_time:a.search_duration+"ms",text:undefined,summary:undefined,routes:[]};for(var d=0;d<c.length;d++){var e=c[d],f=c[d].legs,g={bounds:{northeast:{lat:undefined,lng:undefined},southwest:{lat:undefined,lng:undefined}},overview_polyline:{points:undefined},legs:[],warnings:[],copyrights:undefined,waypoint_order:undefined};g.bounds=undefined,g.overview_polyline=undefined,g.warnings=undefined;var h={duration:{value:undefined,text:undefined},walking_duration:{value:undefined,text:undefined},distance:{value:undefined,text:undefined},departure_time:{value:undefined,text:undefined,time_zone:undefined},arrival_time:{value:undefined,text:undefined,time_zone:undefined},start_location:{lat:undefined,lng:undefined},end_location:{lat:undefined,lng:undefined},start_address:undefined,end_address:undefined,origin_name:a.origin_name,destination_name:a.destination_name};h.departure_time.value=ti.toUnixTime(a.date,e.start_time),h.departure_time.text=ti.printTime(e.start_time),h.departure_time.time_zone=ti.TimeZone,h.arrival_time.value=ti.toUnixTime(a.date,e.finish_time),h.arrival_time.text=ti.printTime(e.finish_time),h.arrival_time.time_zone=ti.TimeZone,h.duration.value=e.travel_time*60,h.duration.text=e.travel_time+" min",h.walking_duration.value=e.walk_time*60,h.walking_duration.text=e.walk_time+" min",h.distance=Math.round(e.distance),h.cost=e.cost,h.steps=[];if(e.legs&&e.legs[0]){var i=f[0];h.start_location.lat=i.start_stop.lat,h.start_location.lng=i.start_stop.lng;if(a.start_east&&a.start_north)h.start_location.east=a.start_east,h.start_location.north=a.start_north;else if(a.mode=="vintra"){var j=ti.LatLngToEN(h.start_location.lat,h.start_location.lng);h.start_location.east=j[0],h.start_location.north=j[1]}}if(e.legs&&f.length&&e.legs[f.length-1]){var k=f[f.length-1];h.end_location.lat=k.finish_stop.lat,h.end_location.lng=k.finish_stop.lng;if(a.end_east&&a.end_north)h.end_location.east=a.end_east,h.end_location.north=a.end_north;else if(a.mode=="vintra"){var j=ti.LatLngToEN(h.end_location.lat,h.end_location.lng);h.end_location.east=j[0],h.end_location.north=j[1]}}g.legs.push(h);for(var l=0;l<f.length;l++){var m=f[l],n={travel_mode:undefined,duration:{value:undefined,text:undefined},distance:{value:undefined,text:undefined},start_location:{lat:undefined,lng:undefined},end_location:{lat:undefined,lng:undefined},polyline:{points:undefined},html_instructions:undefined,transit_details:{departure_time:{value:undefined,text:undefined,time_zone:undefined},arrival_time:{value:undefined,text:undefined,time_zone:undefined},weekdays:undefined,departure_stop:{name:undefined,location:{lat:undefined,lng:undefined},street:undefined,id:undefined,platform:undefined},arrival_stop:{name:undefined,location:{lat:undefined,lng:undefined},street:undefined,id:undefined,platform:undefined},headsign:undefined,num_stops:undefined,stops:undefined,line:{name:undefined,short_name:undefined,vehicle:{name:undefined,type:undefined,icon:undefined},trip_id:undefined,trip_date:undefined,trip_num:undefined,trip_operator:undefined,trip_group:undefined,agencies:[],weekdays:undefined,url:undefined,color:undefined,icon:undefined}}};n.travel_mode=m.route?"TRANSIT":"WALKING",n.distance=undefined,n.polyline=undefined;if(m.shape&&m.shape.length){n.geometry=[];for(var o=0;o<m.shape.length;++o){var p=[m.shape[o][0],m.shape[o][1]];m.route&&(p=ti.LatLngToEN(m.shape[o][0],m.shape[o][1])),n.geometry.push(p)}}m.distance&&(n.distance={value:m.distance,text:m.distance+" meters"}),n.start_location.lat=n.transit_details.departure_stop.location.lat=m.start_stop.lat,n.start_location.lng=n.transit_details.departure_stop.location.lng=m.start_stop.lng,n.end_location.lat=n.transit_details.arrival_stop.location.lat=m.finish_stop.lat,n.end_location.lng=n.transit_details.arrival_stop.location.lng=m.finish_stop.lng;if(a.mode=="vintra"){var j=ti.LatLngToEN(n.start_location.lat,n.start_location.lng);n.start_location.east=n.transit_details.departure_stop.location.east=j[0],n.start_location.north=n.transit_details.departure_stop.location.north=j[1],j=ti.LatLngToEN(n.end_location.lat,n.end_location.lng),n.end_location.east=n.transit_details.arrival_stop.location.east=j[0],n.end_location.north=n.transit_details.arrival_stop.location.north=j[1],n.geometry||(n.geometry=[[n.start_location.east,n.start_location.north],[n.end_location.east,n.end_location.north]])}n.duration.value=m.travel_time||m.finish_time-m.start_time,n.duration.text=n.duration.value+" min",n.duration.value*=60,n.transit_details.departure_time.value=ti.toUnixTime(a.date,m.start_time),n.transit_details.departure_time.text=ti.printTime(m.start_time),n.transit_details.departure_time.time_zone=ti.TimeZone,n.transit_details.arrival_time.value=ti.toUnixTime(a.date,m.finish_time),n.transit_details.arrival_time.text=ti.printTime(m.finish_time),n.transit_details.arrival_time.time_zone=ti.TimeZone,m.start_stop.id.indexOf(";")<0&&(n.transit_details.departure_stop.name=m.start_stop.name,n.transit_details.departure_stop.id=m.start_stop.id,n.transit_details.departure_stop.street=m.start_stop.street,n.transit_details.departure_stop.platform=m.start_platform),m.finish_stop.id.indexOf(";")<0&&(n.transit_details.arrival_stop.name=m.finish_stop.name,n.transit_details.arrival_stop.id=m.finish_stop.id,n.transit_details.arrival_stop.street=m.finish_stop.street,n.transit_details.arrival_stop.platform=m.finish_platform);if(m.route){n.transit_details.headsign=m.route.name,n.transit_details.num_stops=m.finish_pos-m.start_pos,n.transit_details.stops=m.stops,n.transit_details.cost=m.cost,n.transit_details.line.name=m.route.name,n.transit_details.line.short_name=m.route.num,n.transit_details.line.vehicle.name=ti.gtfs_vehicle_name[m.route.transport.toLowerCase()]||m.route.transport,n.transit_details.line.vehicle.type=ti.gtfs_vehicle_type[m.route.transport.toLowerCase()]||"OTHER",n.transit_details.line.trip_id=m.trip_id,n.transit_details.line.trip_date=m.trip_date&&m.trip_date.yyyymmdd("."),n.transit_details.line.trip_num=m.trip_code,n.transit_details.line.trip_operator=m.trip_operator,n.transit_details.line.trip_group=m.trip_group,n.transit_details.weekdays=m.weekdays,n.transit_details.line.weekdays=m.route.weekdays,n.transit_details.line.track_id=m.route.route_id||ti.toAscii([m.route.city,m.route.transport,m.route.num,m.route.dirType].join("_"));if(m.route.operator){var q={name:undefined,phone:undefined,url:undefined};q.name=m.route.operator,n.transit_details.line.agencies.push(q)}m.online_data&&(n.transit_details.online_data=m.online_data)}else n.transit_details.line=undefined;n.taxi=m.taxi,g.legs[0].steps.push(n)}b.routes.push(g)}return b};function SHA1(a){function b(a,b){var c=a<<b|a>>>32-b;return c}function c(a){var b="",c,d,e;for(c=0;c<=6;c+=2)d=a>>>c*4+4&15,e=a>>>c*4&15,b+=d.toString(16)+e.toString(16);return b}function d(a){var b="",c,d;for(c=7;c>=0;c--)d=a>>>c*4&15,b+=d.toString(16);return b}function e(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(d&63|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(d&63|128))}return b}var f,g,h,i=new Array(80),j=1732584193,k=4023233417,l=2562383102,m=271733878,n=3285377520,o,p,q,r,s,t;a=e(a);var u=a.length,v=new Array;for(g=0;g<u-3;g+=4)h=a.charCodeAt(g)<<24|a.charCodeAt(g+1)<<16|a.charCodeAt(g+2)<<8|a.charCodeAt(g+3),v.push(h);switch(u%4){case 0:g=2147483648;break;case 1:g=a.charCodeAt(u-1)<<24|8388608;break;case 2:g=a.charCodeAt(u-2)<<24|a.charCodeAt(u-1)<<16|32768;break;case 3:g=a.charCodeAt(u-3)<<24|a.charCodeAt(u-2)<<16|a.charCodeAt(u-1)<<8|128}v.push(g);while(v.length%16!=14)v.push(0);v.push(u>>>29),v.push(u<<3&4294967295);for(f=0;f<v.length;f+=16){for(g=0;g<16;g++)i[g]=v[f+g];for(g=16;g<=79;g++)i[g]=b(i[g-3]^i[g-8]^i[g-14]^i[g-16],1);o=j,p=k,q=l,r=m,s=n;for(g=0;g<=19;g++)t=b(o,5)+(p&q|~p&r)+s+i[g]+1518500249&4294967295,s=r,r=q,q=b(p,30),p=o,o=t;for(g=20;g<=39;g++)t=b(o,5)+(p^q^r)+s+i[g]+1859775393&4294967295,s=r,r=q,q=b(p,30),p=o,o=t;for(g=40;g<=59;g++)t=b(o,5)+(p&q|p&r|q&r)+s+i[g]+2400959708&4294967295,s=r,r=q,q=b(p,30),p=o,o=t;for(g=60;g<=79;g++)t=b(o,5)+(p^q^r)+s+i[g]+3395469782&4294967295,s=r,r=q,q=b(p,30),p=o,o=t;j=j+o&4294967295,k=k+p&4294967295,l=l+q&4294967295,m=m+r&4294967295,n=n+s&4294967295}var t=d(j)+d(k)+d(l)+d(m)+d(n);return t.toLowerCase()}ti.ENtoLatLng=function(a,b){var c=3.14159265,d=6378137,e=6356752.3141,f=0,g=0,h=5e5,i=.9998,j=24,k=g*(c/180),l=j*(c/180),m=d*i,n=e*i,o=(Math.pow(m,2)-Math.pow(n,2))/Math.pow(m,2),p=(m-n)/(m+n),q=a-h,r=ti.InitialLat(b,f,m,k,p,n),s=1/Math.cos(r),t=Math.tan(r),u=m/Math.sqrt(1-o*Math.pow(Math.sin(r),2)),v=u*(1-o)/(1-o*Math.pow(Math.sin(r),2)),w=u/v-1,x=t/(2*v*u),y=t/(24*v*Math.pow(u,3))*(5+3*Math.pow(t,2)+w-9*w*Math.pow(t,2)),z=t/(720*v*Math.pow(u,5))*(61+90*Math.pow(t,2)+45*Math.pow(t,4)),A=180/c*(r-Math.pow(q,2)*x+Math.pow(q,4)*y-Math.pow(q,6)*z),B=s/u,C=s/(6*Math.pow(u,3))*(u/v+2*Math.pow(t,2)),D=s/(120*Math.pow(u,5))*(5+28*Math.pow(t,2)+24*Math.pow(t,4)),E=s/(5040*Math.pow(u,7))*(61+662*Math.pow(t,2)+1320*Math.pow(t,4)+720*Math.pow(t,6)),F=180/c*(l+q*B-Math.pow(q,3)*C+Math.pow(q,5)*D-Math.pow(q,7)*E);return[A,F]},ti.LatLngToEN=function(a,b){var c=3.14159265,d=6378137,e=6356752.3141,f=0,g=0,h=5e5,i=.9998,j=24,k=a*(c/180),l=b*(c/180),m=g*(c/180),n=j*(c/180),o=d*i,p=e*i,q=(o*o-p*p)/(o*o),r=(o-p)/(o+p),s=o/Math.sqrt(1-q*Math.pow(Math.sin(k),2)),t=s*(1-q)/(1-q*Math.pow(Math.sin(k),2)),u=s/t-1,v=l-n,w=ti.Marc(p,r,m,k),x=Math.sin(k),y=Math.cos(k),z=Math.tan(k),A=w+f,B=s/2*x*y,C=s/24*x*Math.pow(y,3)*(5-z*z+9*u),D=s/720*x*Math.pow(y,5)*(61-58*(z*z)+Math.pow(z,4));Y=A+v*v*B+Math.pow(v,4)*C+Math.pow(v,6)*D,Y=Math.round(Y);var E=s*y,F=s/6*Math.pow(y,3)*(s/t-z*z),G=s/120*Math.pow(y,5)*(5-18*(z*z)+Math.pow(z,4)+14*u-58*(z*z)*u);X=h+v*E+Math.pow(v,3)*F+Math.pow(v,5)*G,X=Math.round(X);return[X,Y]},ti.InitialLat=function(a,b,c,d,e,f){var g=(a-b)/c+d,h=ti.Marc(f,e,d,g),i=(a-b-h)/c+g;while(Math.abs(a-b-h)>1e-5)i=(a-b-h)/c+g,h=ti.Marc(f,e,d,i),g=i;return i},ti.Marc=function(a,b,c,d){return a*((1+b+1.25*(b*b)+1.25*(b*b*b))*(d-c)-(3*b+3*(b*b)+21/8*(b*b*b))*Math.sin(d-c)*Math.cos(d+c)+(15/8*(b*b)+15/8*(b*b*b))*Math.sin(2*(d-c))*Math.cos(2*(d+c))-35/24*(b*b*b)*Math.sin(3*(d-c))*Math.cos(3*(d+c)))},ti.distance=function(a,b,c,d){if(!(a&&b&&c&&d))return 0;var e=6378137,f=Math.PI/180,g=f*(c-a),h=f*(d-b),i=Math.sin(g/2),j=Math.sin(h/2),k=i*i+Math.cos(f*a)*Math.cos(f*c)*j*j,l=2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k)),m=e*l;return m},ti.encodeNumber=function(a){a=a<<1,a<0&&(a=~a);var b="";while(a>=32)b+=String.fromCharCode((32|a&31)+63),a>>=5;b+=String.fromCharCode(a+63);return b},ti.parseISOLocal=function(a){var b=a.split(/\D/);return new Date(b[0],b[1]-1,b[2],b[3]||"0",b[4]||"0",b[5]||"0")},ti.stringToFields=function(a,b,c){var d=a.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/);if(d.length<b.length)return{error:"Missing data, fields found; "+d.length+", required: "+b.length};var e={};for(var f=0;f<b.length;++f){var g=d[f];if(g.indexOf("\"")>=0){g=g.replace(/""/g,"\"");var h=g.length;g.charAt(0)==="\""&&g.charAt(h-1)==="\""&&h>1&&(g=g.slice(1,-1))}e[b[f]]=g}return e};if(typeof module!=="undefined"&&module.exports){module.exports=ti;var http=require("http")}var Hash=function(){var a=this,b=document.documentMode,c=a.history,d=a.location,e,f,g,h=function(){var a=d.href.indexOf("#");return a==-1?"":decodeURI(d.href.substr(a+1))},i=function(){var a=h();if(a!=f){f=a,e(a,!1),pg.timeOfActivity=(new Date).getTime(),typeof _gaq!="undefined"&&_gaq.push(["_trackPageview","/"+d.hash]);if(typeof gtag=="function"){var b=d.href;b=d.pathname.replace("index.html","")+d.hash,gtag("config",cfg.city.ga,{page_path:b})}}},j=function(a){try{var b=g.contentWindow.document;b.open(),b.write("<html><body>"+a+"</body></html>"),b.close(),f=a}catch(c){setTimeout(function(){j(a)},10)}},k=function(){try{g.contentWindow.document}catch(a){setTimeout(k,10);return}j(f);var b=f;setInterval(function(){var a,c;try{a=g.contentWindow.document.body.innerText,a!=b?(b=a,d.hash=f=a,e(a,!0)):(c=h(),c!=f&&j(c))}catch(i){}},50)};return{getHash:h,init:function(d,j){e||(e=d,f=h(),d(f,!0),a.ActiveXObject?!b||b<8?(g=j,k()):a.attachEvent("onhashchange",i):(c.navigationMode&&(c.navigationMode="compatible"),setInterval(i,50)))},go:function(a){if(a!=f){if(typeof gtag=="function"){var b=d.href;b.indexOf("m.")<0&&b.indexOf("mobile")<0?b=d.pathname.replace("index.html","")+"#"+a:(b+="#",b=b.split("#")[0],b+="#"+a),b=d.pathname.replace("index.html","")+"#"+a,gtag("config",cfg.city.ga,{page_path:b})}if(top!==self&&(typeof cfg!="object"||cfg.defaultCity!="jelgava")&&!pg.sisp){var c="stopslt";pg.sisp&&top.frames[c]?(console.log("top",top.frames,top.frames[c]),top.frames[c].src=self.location.href.split("#")[0]+"#"+a):top.location.replace(self.location.href.split("#")[0]+"#"+a);return}g?j(a):(d.hash=f=a,e(a,!1))}}}}();if(typeof module!=="undefined"&&module.exports){var fs=require("fs"),ti=require(fs.existsSync(__dirname+"/ti.js")?__dirname+"/ti.js":"../JS/ti.js");module.exports=ti}var pikasRoute=ti.pikasRoute=function(a,b){a.mode=="vintra"&&typeof cfg!="undefined"&&(cfg.defaultCity="vilnius"),a=a||{origin:"3540",destination:"54.68561;25.28670",departure_time:"1355295600",walk_max:"1000"};var c=ti.parseParams(a);c.callback=function(a){var c="";a.search_duration&&(c+="Search took "+a.search_duration+"ms<br /><br />"),c+="Optimal routes:";var d=a.results||[];for(var e=0;e<d.length;e++){var f=d[e],g=d[e].legs;c+=["<br /><b>Option",e+1,"</b> travel time "+ti.printTime(f.travel_time)].join("&nbsp;"),f.distance&&(c+=", distance "+Math.round(f.distance)/1e3+" km"),typeof f.cost=="number"&&(c+=", cost "+f.cost+"&euro;"),c+="<br />";for(var h=0;h<g.length;h++){var i=g[h];c+=[i.start_stop.name,ti.printTime(i.start_time),ti.printTime(i.finish_time),i.finish_stop.name," "].join(" "),i.route?c+=[ti.gtfs_vehicle_name[i.route.transport]||i.route.transport,i.route.num,i.route.name,i.weekdays,i.cost+" Euro","<br />"].join(" "):c+="walk<br />"}}b==="JSON"||b==="json"?document.body.innerHTML=JSON.stringify(ti.ToGoogleFormat(a),null,4):typeof b==="string"?document.body.innerHTML=c:typeof b==="function"?(d=ti.ToGoogleFormat(a),d.text=c,d.version="2020-04-10",b(d)):window.JSClassObject.receiveResult(JSON.stringify(ti.ToGoogleFormat(a),null,4))},ti.findTrips(c)};ti.findTrips=function(args){!args.timezone&&typeof cfg!="undefined"&&cfg.defaultCity=="intercity"&&(args.timezone={AT:-1,BE:-1,BG:0,BY:0,CH:-1,CZ:-1,DE:-1,DK:-1,EE:0,ES:-1,FR:-1,HU:-1,IT:-1,LT:0,LU:-1,LV:0,NL:-1,PL:-1,RO:0,RU:args.date.getTimezoneOffset()==-3*60?-1:0,SK:-1,SR:-1,UK:-2,UKR:0},args.timezone.BY=args.timezone["RU Maskva"]=args.timezone["RU Sankt "]=args.timezone.RU+1),ti.args=args,ti.distances=ti.distances||{},ti.walking_responses=ti.walking_responses||[];if(args&&args.callback){if(args.status&&args.status!="OK"){args.callback(args);return}if(args.distances_missing)return;ti.timeout_for_finding_distances&&(clearTimeout(ti.timeout_for_finding_distances),ti.timeout_for_finding_distances=null);if(!args.stops_processed){args.stops_processed=!0,args.distances_missing=0;var walk_max_km2=(args.walk_max||500)/1e3;walk_max_km2=walk_max_km2*walk_max_km2;var walk_min_km2=(args.walk_min||10)/1e3;walk_min_km2=walk_min_km2*walk_min_km2;var start_point=null;for(var k=1;k<=2;++k){var latlng;if(k==1&&args.start_stops&&args.start_stops.indexOf(";")>0)latlng=args.start_stops.split(";");else if(k==2&&args.finish_stops&&args.finish_stops.indexOf(";")>0)latlng=args.finish_stops.split(";");else continue;var lat=parseFloat(latlng[0]).toFixed(5),lng=parseFloat(latlng[1]).toFixed(5);lat>54.636417&&lng>25.279669&&lat<54.650076&&lng<25.297436&&(lat=54.64331,lng=25.27948),latlng=lat+";"+lng,args[k==1?"start_stops":"finish_stops"]=latlng;if(args.mode!=="vintra")continue;k==1&&(start_point={id:"start_point;"+latlng,lat:lat,lng:lng});var stops=ti.stops,nearest_stops=[];for(var stop_id in stops){var stop=stops[stop_id];if(!stop.lat||!stop.lng||stop.id=="gps")continue;var dx=(lng-stop.lng)*58.1,dy=(lat-stop.lat)*111.2,distance=dx*dx+dy*dy;if(distance>walk_min_km2)distance<=walk_max_km2&&nearest_stops.push([distance,stop]);else{nearest_stops=[];break}}if(k==2&&start_point){var dx=(lng-start_point.lng)*58.1,dy=(lat-start_point.lat)*111.2,distance=dx*dx+dy*dy;distance<=walk_max_km2&&nearest_stops.push([-999,start_point])}nearest_stops.sort(function(a,b){return a[0]-b[0]});for(var i=0;i<10;i++){if(i>=nearest_stops.length)break;var stop=nearest_stops[i][1];shape_name=["distance",lat,lng,stop.id].join(";"),shape_name.indexOf(";start_point;")>=0&&(args.walking_shape_name=shape_name);if(ti.distances[shape_name])continue;args.walking_shape_name!=shape_name&&args.distances_missing++;var url=cfg.walk_path_url;if(url){var p1=ti.LatLngToEN(lat,lng),p2=ti.LatLngToEN(stop.lat,stop.lng);url=url.replace("$x1",p1[0]),url=url.replace("$y1",p1[1]),url=url.replace("$x2",p2[0]),url=url.replace("$y2",p2[1]),url.replace("esriNAOutputLineTrueShape","esriNAOutputLineNone")}var handler=function(){var curr_shape_name=shape_name,curr_url=url,curr_time=+(new Date);return function(lines){shape_name.indexOf(";start_point;")<0&&args.distances_missing--;if(lines.indexOf("DOCTYPE")<0){!ti.timeout_for_finding_distances&&ti.print_log=="function"&&ti.print_log("WARNING: late response in "+(+(new Date)-curr_time)+"ms from "+curr_url);try{var w;JSON?w=JSON.parse(lines):w=eval("(function(){return "+lines+";})()"),w=w.routes||{},w=(w.features||[])[0]||{},w=(w.attributes||{}).Total_Meters,typeof w=="number"&&w&&(ti.distances[curr_shape_name]=w/1e3)}catch(error){typeof ti.print_log=="function"&&(ti.print_log("WARNING: invalid JSON data from walking path service: "+error),ti.print_log("JSON data: "+ti.shapes[shape_name]),ti.shapes[curr_shape_name]=!1)}args.distances_missing<=0&&ti.timeout_for_finding_distances&&(args.distances_missing=0,ti.findTrips(args))}else ti.print_log=="function"&&ti.print_log("WARNING: response from walking path service for requested shape "+curr_shape_name+" is not JSON data:\n"+lines)}}();url&&ti.fDownloadUrl("get",url,handler)}}if(args.distances_missing){ti.timeout_for_finding_distances=setTimeout(function(){args.distances_missing=0,ti.findTrips(args)},cfg.timeout_for_geometry||1e3);return}}args.optimization?args.optimization=args.optimization.toString():args.optimization="",args.no_just_walking=!1,args.reverseOriginal=args.reverse;if(!args.attempt){if(typeof pg==="object"){if(pg.optimalSearchRunning)return;pg.optimalSearchRunning=!0}args.timeStarted=+(new Date),ti.timeStarted=+(new Date),args.attempt=1,args.curr_time=args.start_time,args.direct_routes=[],args.results0=[];var d=args.date;d||(d=new Date,d=new Date(d.getFullYear(),d.getMonth(),d.getDate()),args.date=d),args.transport||(args.transport={}),args.transportOriginal=ti.cloneObject(args.transport),typeof args.reverse=="undefined"&&(args.reverse=1,args.reverseOriginal=args.reverse);if(typeof cfg==="object"&&cfg.defaultCity==="intercity")args.transport.internationalbus=!1,args.lowFloor&&(args.include_private=!0,args.lowFloor=!1);else if(typeof cfg==="object"&&cfg.defaultCity==="latvia")args.transport.internationalbus=!1;else if(args.transport.bus||args.transport.trol||args.transport.tram)args.transport.regionalbus&&(args.transport.regionalbus=!1,args.attempt=-1),args.transport.commercialbus&&(args.transport.commercialbus=!1,args.attempt=-1),args.transport.intercitybus&&(args.transport.intercitybus=!1,args.attempt=-1),args.transport.train&&cfg.defaultCity!="rostov"&&(args.transport.train=!1,args.attempt=-1);dijkstra(args,args.start_time,args.reverse);return}if(args.attempt==-1){args.attempt=1;if(args.results.length<=0){args.transport=args.transportOriginal,dijkstra(args,args.start_time,args.reverse);return}}if(args.attempt==1&&args.results.length<=0)if(typeof cfg!=="object"||cfg.defaultCity!=="intercity")if(args.mode!="vintra"){args.attempt=2,args.reverse=-args.reverse,args.sort="no sort",dijkstra(args,args.reverse==1?0:4320,args.reverse);return}if(args.attempt==2&&args.results.length>0){args.attempt=999,args.reverse=-args.reverse;var time=null;for(var i=0;i<args.results.length;i++)args.reverse==1&&(time===null||time<args.results[i].start_time)&&(time=args.results[i].start_time),args.reverse==-1&&(time===null||time>args.results[i].finish_time)&&(time=args.results[i].finish_time);dijkstra(args,time,args.reverse);return}if(args.attempt==1){var time=null;for(var i=0;i<args.results.length;i++){if(args.results[i].code=="W")continue;args.reverse==1&&(time===null||time>args.results[i].finish_time)&&(time=args.results[i].finish_time),args.reverse==-1&&(time===null||time<args.results[i].start_time)&&(time=args.results[i].start_time)}args.results0=ti.filterSearchResults(args.results,args.reverse),args.callback1&&(args.results=args.results0.slice(0,1),args.results=ti.finalizeSearchResults(args),args.callback1(args)),args.attempt=6,args.no_just_walking=!0;if(time===null)args.results=[];else{dijkstra(args,time,-args.reverse,args.start_time);return}}var no_later_trips=args.optimization&&args.optimization.indexOf("2")<0;if(!1&&args.attempt>=3&&args.attempt<=5){args.results.push.apply(args.results,args.results0),args.results=ti.filterSearchResults(args.results,args.reverse);if(args.results.length>0)if(!0||args.results.length==1||args.results0.length>=args.results.length)if(args.results[0].legs.length!=1||args.results[0].legs[0].route)if(!no_later_trips){args.attempt=6,args.results0=args.results,args.no_just_walking=!0,dijkstra(args,args.reverse==1?args.results[0].start_time+1:args.results[0].finish_time-1,args.reverse);return}}if(!no_later_trips&&args.attempt<999)if(+(new Date)-args.timeStarted<=(args.timeout||5e3)||args.curr_reverse==args.reverse||args.start_time==1)if(args.attempt>=6&&(args.curr_reverse!=args.reverse||args.results.length>0&&(cfg.defaultCity==="intercity"||args.attempt<11||args.start_time==1)&&(args.reverse==1?args.results[0].start_time<1800:args.results[0].finish_time>0))){var start_time=null,finish_time=null;for(var i=0;i<args.results.length;i++)if(args.curr_reverse==1){if(start_time===null||start_time>args.results[i].start_time)start_time=args.results[i].start_time;if(finish_time===null||finish_time>args.results[i].finish_time)finish_time=args.results[i].finish_time}else{if(start_time===null||start_time<args.results[i].start_time)start_time=args.results[i].start_time;if(finish_time===null||finish_time<args.results[i].finish_time)finish_time=args.results[i].finish_time}args.curr_reverse*=-1,++args.attempt,args.results0.push.apply(args.results0,args.results),args.no_just_walking=!0,args.curr_reverse==args.reverse?(args.curr_reverse==1?(time=start_time!==null&&start_time>args.curr_time?start_time:args.curr_time,(cfg.defaultCity!="intercity"||time==args.curr_time)&&++time):(time=finish_time!==null&&finish_time<args.curr_time?finish_time:args.curr_time,(cfg.defaultCity!="intercity"||time==args.curr_time)&&--time),args.curr_time=time,dijkstra(args,time,args.curr_reverse)):(args.curr_reverse==-1?(time=finish_time,args.curr_time<start_time&&start_time!==null&&(args.curr_time=start_time)):(time=start_time,args.curr_time>finish_time&&finish_time!==null&&(args.curr_time=finish_time)),dijkstra(args,time,args.curr_reverse,args.curr_time-0*args.reverse));return}args.attempt>=6&&args.results.push.apply(args.results,args.results0),args.results=ti.filterSearchResults(args.results,args.reverse,args.start_time==1),args.results_max>0&&args.results.length>args.results_max&&(args.results.length=args.results_max),args.search_duration=+(new Date)-args.timeStarted;if(args.shapes_url||ti.SERVER===!0){ti.timeout_for_search_results=setTimeout(ti.returnSearchResults,cfg.timeout_for_geometry||1e3),ti.applyShapes(!0);return}if(typeof cfg=="object"&&cfg.defaultCity==="disable_temporary_latvia"&&args.attempt<=999){typeof pg==="object"&&(pg.optimalSearchRunning=!1,($("online_results")||{}).innerHTML=""),args.attempt=1e3;var start_finish_stops={};args.online_results=[],args.online_results_required_count=0;for(var i=0;i<args.results.length;i++){var result=args.results[i],legs=result.legs;for(var j=0;j<legs.length;j++){var leg=legs[j];if(leg.route){var start_stop=leg.start_stop&&ti.fGetStopDetails(leg.start_stop.id),finish_stop=leg.finish_stop&&ti.fGetStopDetails(leg.finish_stop.id);start_stop&&start_stop.info&&finish_stop&&finish_stop.info&&!start_finish_stops[start_stop.info+";separator;"+finish_stop.info]&&(start_finish_stops[start_stop.info+";separator;"+finish_stop.info]=[start_stop.info,finish_stop.info],++args.online_results_required_count)}}}for(var i in start_finish_stops){var start_stop=start_finish_stops[i][0],finish_stop=start_finish_stops[i][1],key="timetable"+args.date.yyyymmdd()+start_stop+finish_stop;key+="7xk$n1Lp1*9E!3",key=SHA1(key);var query_url="/api/ltc.php?action=timetable";query_url+="&date="+args.date.yyyymmdd(),query_url+="&from="+start_stop,query_url+="&to="+finish_stop,query_url+="&signature="+key,ti.SERVER===!0?typeof http!="undefined"&&http.get({host:"bezrindas.lv",port:80,path:query_url},function(a){a.setEncoding("utf8");var b="";a.on("data",function(a){b+=a}),a.on("end",function(){if(b){var a=JSON.parse(b);a.contents&&(a=a.contents),a&&a.length&&args.online_results.push.apply(args.online_results,[].concat(a)),--args.online_results_required_count==0&&ti.findTrips(args)}})}):(query_url="http://bezrindas.lv"+query_url,args.online_query_url=query_url,query_url="http://www.stops.lt/latviatest/proxy.php?url="+encodeURIComponent(query_url),($("online_results")||{}).innerHTML="<br/>Waiting data from bezrindas.lv for stops pairs: "+args.online_results_required_count,ti.fDownloadUrl("get",query_url,function(a){if(a){args.online_results_JSON=a;var b=JSON.parse(a);b.contents&&(b=b.contents),b&&b.length&&args.online_results.push.apply(args.online_results,[].concat(b)),($("online_results")||{}).innerHTML="<br/>Waiting data from bezrindas.lv for stops pairs: "+(args.online_results_required_count-1),--args.online_results_required_count==0&&ti.findTrips(args)}},!0))}if(args.online_results_required_count>0)return}ti.args=args,ti.returnSearchResults()}},ti.returnSearchResults=function(){ti.timeout_for_search_results&&(clearTimeout(ti.timeout_for_search_results),ti.timeout_for_search_results=null);var a=ti.args;a.results=ti.finalizeSearchResults(a,a.online_results),a.transport=a.transportOriginal,typeof pg==="object"&&(pg.optimalSearchRunning=!1);if(a.callback)a.callback(a,!0);else{if(typeof pg==="object")return a;if(typeof window=="object")document.body.innerHTML=JSON.stringify(a.results);else return a}},ti.applyShapes=function(bDownloadShapes){if(ti.args&&ti.args.results&&ti.args.results.length){var shapes_missing=0,shape_name;if(bDownloadShapes)for(shape_name in ti.shapes)ti.shapes[shape_name]===!1&&(ti.shapes[shape_name]="");for(var i=0;i<ti.args.results.length;i++){var legs=ti.args.results[i].legs;for(var j=0;j<legs.length;j++){var leg=legs[j];if(leg.shape)continue;var shape_name,lat1,lng1,lat2,lng2;if(leg.route){var route=ti.fGetRoutes(leg.route);shape_name=route.shape_id||ti.toAscii([route.city,route.transport=="eventbus"?"bus":route.transport,route.num,route.dirType].join("_"),!0)}else lat1=leg.start_stop.lat,lng1=leg.start_stop.lng,lat2=leg.finish_stop.lat,lng2=leg.finish_stop.lng,shape_name=["walk",lat1,lng1,lat2,lng2].join(";");if(ti.shapes[shape_name]){leg.shape=ti.shapes[shape_name];if(leg.route)leg.shape=ti.splitShape(leg.shape,leg.start_stop.lat,leg.start_stop.lng,leg.finish_stop.lat,leg.finish_stop.lng);else try{var w;JSON?w=JSON.parse(ti.shapes[shape_name]):w=eval("(function(){return "+ti.shapes[shape_name]+";})()"),w=w.routes||{},w=(w.features||[])[0]||{},leg.distance=(w.attributes||{}).Total_Meters,w=(w.geometry||{}).paths||[[]],w=w[0],leg.shape=w}catch(error){typeof ti.print_log=="function"&&(ti.print_log("WARNING: invalid JSON data from walking path service: "+error),ti.print_log("JSON data: "+ti.shapes[shape_name]),ti.shapes[shape_name]=!1)}}else if(ti.shapes[shape_name]===!1)++shapes_missing;else if(bDownloadShapes){ti.shapes[shape_name]=!1,++shapes_missing;var url=cfg.walk_path_url;if(leg.route)url=ti.args.shapes_url+shape_name+".txt";else if(url){var p1=ti.LatLngToEN(lat1,lng1),p2=ti.LatLngToEN(lat2,lng2);url=url.replace("$x1",p1[0]),url=url.replace("$y1",p1[1]),url=url.replace("$x2",p2[0]),url=url.replace("$y2",p2[1])}var handler=function(){var a=shape_name,b=url,c=+(new Date);return function(d){d.indexOf("DOCTYPE")<0?(ti.shapes[a]=d,ti.applyShapes(),!ti.timeout_for_search_results&&ti.print_log=="function"&&ti.print_log("WARNING: late response in "+(+(new Date)-c)+"ms from "+b)):ti.print_log=="function"&&ti.print_log("WARNING: response from walking path service for requested shape "+a+" is not JSON data:\n"+d)}}();leg.route?ti.fDownloadUrl("get",ti.args.shapes_url+shape_name+".txt",handler):url&&ti.fDownloadUrl("get",url,handler)}}}shapes_missing==0&&ti.returnSearchResults()}};function dijkstra(a,b,c,d){var e=(new Date).getFullYear();typeof cfg=="object"&&cfg.defaultLanguage=="lt"&&(ti.specialWeekdays[ti.dateToDays(new Date(e,0,1))]=7,ti.specialWeekdays[ti.dateToDays(new Date(2020,3,13))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,1,16))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,2,11))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,4,1))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,5,24))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,6,6))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,7,15))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,10,1))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,11,24))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,11,25))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,11,26))]=7,cfg.defaultCity=="vilnius"&&(ti.specialWeekdays[ti.dateToDays(new Date(2018,11,27))]=6,ti.specialWeekdays[ti.dateToDays(new Date(2018,11,28))]=6,ti.specialWeekdays[ti.dateToDays(new Date(2018,11,31))]=6)),typeof cfg=="object"&&cfg.defaultLanguage=="ee"&&(ti.specialWeekdays[ti.dateToDays(new Date(e,0,1))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,1,24))]=7,ti.specialWeekdays[ti.dateToDays(new Date(2020,3,13))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,4,1))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,5,23))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,5,24))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,7,20))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,11,24))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,11,25))]=7,ti.specialWeekdays[ti.dateToDays(new Date(e,11,26))]=7);var f="",g="a",h=a.mode==="vintra";typeof cfg=="object"&&cfg.defaultCity=="latvia"&&(f=";bus;trol;tram;minibus;",g="nothing");var i=!1,j=c==-1?a.finish_stops.split(","):a.start_stops.split(","),k=c==-1?a.start_stops.split(","):a.finish_stops.split(","),l=a.finish_stops==="0;0";c||(i=!0,c=1,a.direct_routes=[]),a.results=[],a.curr_reverse=c,b=typeof b!="undefined"?b*c:0,d=typeof d!="undefined"?d*c:7200;var m=b,n=c==1?"1":"2",o=c==1?"2":"1",p=a.route_nums?","+a.route_nums.toLowerCase().replace(/\s/g,"")+",":"",q=a.lowFloor,r=a.include_private;p.indexOf(",z,")>=0&&(q=!0,p=p.replace(/,z,/g,"")),a.date||(a.date=new Date);var s=ti.dateToDays(a.date),t=""+(a.date.getDay()||7),u=""+(ti.specialWeekdays[s]||""),v=u=="7";u||(u=t);var w=a.max_changes||Number.POSITIVE_INFINITY,x=a.change_time||3;if(h||cfg.defaultCity=="xxxintercity")x=0;var y=a.walk_speed_kmh||4,z=a.walk_max||500;z>0&&(z=i?.05:z/1e3,z=z*z);var A=(a.walk_min||10)/1e3;A=A*A;var B=ti.stops,C=ti.routes,D=ti.specialDates,E=a.direct_routes||[],F=a.transport,G=a.operators,H=a.removed_trips?","+a.removed_trips.replace(/\s/g,"")+",":"",I=a.added_trips?","+a.added_trips.replace(/\s/g,"")+",":"",J=a.removed_trips_by_date,K=a.added_trips_by_date,L=a.commercial,M=a.routetypes,N=M!=1,O=a.area,P=0,Q=a.middle_stops;if(Q){P=10;for(var R in Q){var S=B[R].routes;for(var T=0;T<S.length;T+=2)C[S[T]].available=10}}var U,V,W={},X={},Y={};for(var Z=1,$=j;Z<=2;++Z){for(var T=$.length;--T>=0;)if($[T].charAt(0)==g){var _=B[$[T]];if(_)for(var ba=_.neighbours.length;--ba>=0;)$.push(_.neighbours[ba]);$[T]="removed stop"}else if($[T].indexOf(";")>0){var bb=$[T].split(";"),bc=parseFloat(bb[0]),bd=parseFloat(bb[1]);if(bc>1e3||bd>1e3){var be=ti.ENtoLatLng(bc,bd);bc=be[0],bd=be[1]}Z==1?U={id:$[T],lat:bc,lng:bd,neighbours:[]}:(V={id:$[T],lat:bc,lng:bd},X[V.id]=!0,U&&(Y[U.id]=!0))}$=k}var bf=[],bg={};bg[m]=[];for(var R in B){var _=B[R];_.time=Number.POSITIVE_INFINITY,_.trip_date=null,l&&(_.rideStart=_.rideEnd=0);if(!_.lat||!_.lng)continue;if(U){var bh=(U.lng-_.lng)*58.1,bi=(U.lat-_.lat)*111.2,bj=bh*bh+bi*bi;if(bj>A||_.id=="gps"){if(bj<=z&&_.id!="gps"){var bk=["distance",U.lat,U.lng,_.id].join(";");bj=ti.distances[bk],bj?bj*=bj:h&&bj!==0&&(bj=z+1),(!bj||bj<=z)&&U.neighbours.push(_.id),typeof cfg=="object"&&cfg.defaultCity=="latvia"&&_.city&&_.city.toLowerCase().indexOf("latvija")<0&&(F.internationalbus=!0),typeof cfg=="object"&&cfg.defaultCity=="intercity"&&_.city!="LT"&&(F.internationalbus=!0)}}else j.push(_.id),U.remove=!0}if(V){var bh=(V.lng-_.lng)*58.1,bi=(V.lat-_.lat)*111.2,bj=bh*bh+bi*bi;bj<=A&&_.id!="gps"&&(k.push(_.id),V.remove=!0);if(bj<=z&&_.id!="gps"){var bk=["distance",V.lat,V.lng,_.id].join(";");bj=ti.distances[bk],bj?bj*=bj:h&&bj!==0&&(bj=z+1);if(!bj||bj<=z){Y[_.id]=!0;var bl=_.neighbours;for(var ba=bl.length;--ba>=0;)_.name===(B[bl[ba]]||{}).name&&(Y[bl[ba]]=!0)}typeof cfg=="object"&&cfg.defaultCity=="latvia"&&_.city&&_.city.toLowerCase().indexOf("latvija")<0&&(F.internationalbus=!0),typeof cfg=="object"&&cfg.defaultCity=="intercity"&&_.city!="LT"&&(F.internationalbus=!0)}}}for(var ba=j.length;--ba>=-1;){var _=ba>=0?B[j[ba]]:U;if(_){if(ba==-1&&U.remove){U=null;break}_.prev_stop=!1,_.route=null,_.changes=0,_.visited_stops=0,W[_.id]=!0,ba==-1&&c==-1&&x?(m-=x,bg[m]=[U]):bg[m].push(_),_.time=m,typeof cfg=="object"&&cfg.defaultCity=="latvia"&&_.city&&_.city.toLowerCase().indexOf("latvija")<0&&(F.internationalbus=!0),typeof cfg=="object"&&cfg.defaultCity=="intercity"&&_.city!="LT"&&(F.internationalbus=!0)}}for(var ba=k.length;--ba>=0;){if(ba==-1&&V.remove){X[V.id]=!1,V=null,Y={};break}var R=k[ba],_=B[R];_&&(X[R]=!0,typeof cfg=="object"&&cfg.defaultCity=="latvia"&&_.city&&_.city.toLowerCase().indexOf("latvija")<0&&(F.internationalbus=!0),typeof cfg=="object"&&cfg.defaultCity=="intercity"&&_.city!="LT"&&(F.internationalbus=!0))}if(!0||i)for(var bm=C.length;--bm>=0;){var bn=ti.fGetRoutes(bm),bo=C[bm];bo.weekdays=bn.weekdays,bo.available=F&&F[bn.transport]===!1||P&&P!==bo.available||p&&p.indexOf(","+bn.num.toLowerCase()+",")<0||L&&L!=bn.commercial||M&&N!=!_transport_data[bn.transport].region||O&&O!=bn.cities[0]?0:1}for(var ba=E.length;--ba>=0;)E[ba].available=0;for(var bm in C){var bo=C[bm];bo.trip_start_time=c*Number.POSITIVE_INFINITY}a.finish_stops||(k=!1);var bp=+(new Date),bq,br=0,bs=function(){for(var b=0;;){for(var e;!(e=bg[m])||!e.length;)if(++m>d){if(!bf.length){a.results=[];if(i)return[];a.callback2?window.setTimeout(a.callback2,10):typeof window==="object"?window.setTimeout(function(){ti.findTrips(a)},10):ti.findTrips(a);return}e=!1;break}if(!e)break;e=e.pop();if(e.time<m||e.changes<0)continue;if(++b==3e3&&!i&&typeof window=="object"){if(+(new Date)-bp>3e4){a.results=[],window.setTimeout(function(){ti.findTrips(a)},10);return}if(typeof bs=="function"){window.setTimeout(bs,5);return}}if(X[e.id]){d>m+60&&(d=m+60);continue}var g=e.changes||0,j=e.visited_stops||0,p=null,A=null;if(!i&&z>0&&(g>0||!a.no_start_walking)){var D=e;while(!D.route&&D.prev_stop)D=D.prev_stop;var E=D.lat,F=D.lng,L=e.neighbours;for(var M=L.length;--M>=-1;){if(typeof cfg==="object"&&cfg.defaultCity==="kaunas"){if(({549:!0,548:!0,547:!0,546:!0,545:!0,708:!0,709:!0,805:!0,786:!0,787:!0,"787a":!0,397:!0,398:!0,403:!0,404:!0,405:!0,641:!0})[e.id]&&({20:!0,21:!0,22:!0,23:!0,24:!0,25:!0,26:!0,27:!0,196:!0,195:!0,664:!0,201:!0,202:!0,203:!0,204:!0,207:!0,208:!0,209:!0,210:!0})[L[M]])continue;if(({549:!0,548:!0,547:!0,546:!0,545:!0,708:!0,709:!0,805:!0,786:!0,787:!0,"787a":!0,397:!0,398:!0,403:!0,404:!0,405:!0,641:!0})[L[M]]&&({20:!0,21:!0,22:!0,23:!0,24:!0,25:!0,26:!0,27:!0,196:!0,195:!0,664:!0,201:!0,202:!0,203:!0,204:!0,207:!0,208:!0,209:!0,210:!0})[e.id])continue}if(typeof cfg==="object"&&cfg.defaultCity.indexOf("viln")==0){if(({2367:!0,2366:!0,"0906":!0,"0905":!0,"0904":!0,"0903":!0,"0902":!0,"0901":!0,2309:!0,2308:!0,2310:!0,2311:!0,2316:!0,2317:!0})[e.id]&&({2368:!0,2369:!0,1103:!0,1104:!0,1107:!0,1110:!0,1113:!0,1114:!0,1115:!0,1116:!0,2314:!0,2315:!0,2318:!0,2319:!0,2320:!0})[L[M]])continue;if(({2367:!0,2366:!0,"0906":!0,"0905":!0,"0904":!0,"0903":!0,"0902":!0,"0901":!0,2309:!0,2308:!0,2310:!0,2311:!0,2316:!0,2317:!0})[L[M]]&&({2368:!0,2369:!0,1103:!0,1104:!0,1107:!0,1110:!0,1113:!0,1114:!0,1115:!0,1116:!0,2314:!0,2315:!0,2318:!0,2319:!0,2320:!0})[e.id])continue}var N;if(M<0)if(Y[e.id])N=V;else break;else N=B[L[M]]||{lat:999,lng:999};var O=(F-N.lng)*58.1,P=(E-N.lat)*111.2,R=e.distances&&e.distances[M];!1&&R?R=R*R/1e6:R=O*O+P*P;if(N===D||N===e)continue;if(N===V){if(D===U&&N.id.indexOf(";")>0){if(h){R=ti.distances[a.walking_shape_name];if(R)R*=R;else continue}if(R>z)continue}}else if(R>z&&(!e.name||N.name!==e.name))continue;R=Math.sqrt(R);var S=Math.round(R/y*60);S+=D.time;var T=S;if(!D.route||!D.prev_stop&&c<0)S+=x;S<m&&(S=T=m);if(S>d)continue;if(X[N.id])if(!1&&g===1&&D.prev_stop&&typeof cfg==="object"&&cfg.defaultCity==="latvia")e=D.prev_stop,p=D.id,A=D.prev_stop_start_time;else{if(S>N.time)continue;if(S==N.time&&g>=N.changes)continue;var Z={legs:[{start_stop:D,start_time:c*(D.time-(D.route?x:0)),finish_stop:N,finish_time:c*(S-x),route:null}]};bf.push(Z)}else{if(S>N.time)continue;if(S!=N.time||g<N.changes)N.route=!1,N.prev_stop=D,N.prev_stop_start_time=D.time-(D.route?x:0);else continue}l&&(typeof cfg!="object"||cfg.defaultCity!="vilnius"?(N.rideStart=D.rideStart,N.rideEnd=T):D.route&&(N.rideStart=D.rideStart,N.rideEnd=D.rideEnd)),N.time=S,N.changes=g,N.visited_stops=j;var $=bg[S];$?$[$.length]=N:bg[S]=[N]}}g=e.changes||0;if(g<=w){var _=e.routes||[];for(var M=0,ba=_.length;M<ba;M+=2){var bb=C[_[M]];if(i){if(bb.available===0&&k)continue;a.direct_routes.push(bb),M+2<ba&&_[M+2]==_[M]&&(M+=2)}else if(!bb.available)continue;bb.id==29&&(M=M+0);if(typeof bb.entry=="undefined"){typeof bb.times==="string"&&(bb.times=ti.explodeTimes(bb.times));var bc=ti.fGetRoutes(bb.id);bb.city=bc.city,bb.transport=bc.transport,bb.num=bc.num,bb.stops=bc.stops,bb.platforms=bc.platforms,bb.entry=bc.entry||"",bb.specialDates=bc.specialDates}var bd=bb.times,be="";f&&f.indexOf(bb.transport)<0?e.city.indexOf("riga")<0?e.city.indexOf("liep")<0?e.city.indexOf("jelg")>=0&&(be="jelg"):be="liep":be="riga":e.city=="LT"&&bb.transport=="internationalbus"&&(be="LT");var bh=_[M+1],bi=bb.stops||bb.raw_data.split(";").slice(ti.RT_ROUTESTOPS);if(c==1&&bh>=bi.length-1||c==-1&&bh==0)continue;var bj=bb.entry||"";if(bj.charAt(bh)==o)continue;bi[bh]==bi[bh+c]&&(bh+=c);if(!bd)continue;var bk=bd.workdays,bl=bd.valid_from,bm=bd.valid_to,bn=bd.exceptions||[],bo=bd.trip_operators,bq=bd.trip_groups,br=bd.trip_ids,bt=bd.tag,bu=bd.times;bd=null;var bv="",bw,bx=0,by=0,bz=bb.specialDates||[];for(var bA=0,bB=bz.length;bA<bz.length;bA+=2)if((ti.specialDates[bz[bA]]||{})[s]){(bv=bz[bA+1])==="*"&&(bv=u);break}if(bv=="0")continue;bv=u;if(bb.weekdays)if(bb.weekdays.indexOf("!")<0){if(bb.weekdays.indexOf("~")>=0&&v)continue}else{if(bb.weekdays.indexOf(t)<0)continue;bv=t}var bC=A||m;if(e.route&&bb.num===e.route.num&&bb.transport===e.route.transport&&bb.city===e.route.city)bC-=x;else if(g<0||a.mode!="vintra"||A){if(g>0&&typeof cfg=="object"&&cfg.defaultCity=="latvia"&&!A){bC-=x;var bD=bb;c==-1&&(bD=e.route||e.prev_stop&&e.prev_stop.route),bD&&(bD.transport=="internationalbus"?bC+=Math.max(x,20):bD.transport=="train"?bC+=Math.max(x,({1:10,2:15,3:20})[bD.num.charAt(1)]||10):bC+=Math.max(x,({2:5,3:5,4:10,5:10,6:10,7:15,8:20})[bD.num.charAt(0)]||x))}}else{var bD=bb;c==-1&&(bD=e.route||e.prev_stop&&e.prev_stop.route);if(bD){var bE=a.transport[bD.transport];typeof bE=="number"&&bE>=0&&(bC+=bE-x)}}var bF=bC*c;bC>=1440&&(bx=bC-bC%1440);var bG=!1,bH,bI=bH=bk.length,bJ=c!=-1?-1:bI,bK=999999,bL=0;do{var bM=-1,bN=Number.POSITIVE_INFINITY,bO,bP,bQ,bR=null,bS=!i||!Q,bT=c*bI;for(var bU=bJ+bh*bI;bH-->0;){bJ+=c,bU+=c;if(G){var bV=G[bo[bJ]];if(typeof bV!="string")continue;if(bV!=""&&(","+bV+",").indexOf(","+bq[bJ]+",")<0)continue}var bW=br[bJ];if(H&&H.indexOf(","+bW+",")>=0)continue;bO=bP=bu[bU];if(bO<0)continue;if(!h){if(bO-bF>=1440||bO*c-bC>=1440)bO=bF+(bO-bF)%1440;bO<bF==(c==1)&&bO!=bF&&(bO=(bC+1440)*c-(bF-bO)%1440)}bP=bO-bP,bO*=c;if(!i&&(bO<bC||bO>=bN))continue;bP?(bQ=((+t+Math.floor(bP/1440)+7)%7||7).toString(),bw=s+bP/1440):(bQ=bv,bw=s);var bX=(bn[bJ]||{})[bw];if(bX===!1)continue;bX&&(bO++,bO--);var bY=bl[bJ],bZ=bm[bJ];bY>4e4&&r&&(bY-=4e4),bK>bY&&(bK=bY),bL<bZ&&(bL=bZ);if((bO<bN||i||bG)&&(!u||bk[bJ].indexOf(bQ)>=0||bX||bk[bJ].charAt(0)=="0"||I&&I.indexOf(","+bW+",")>=0||K&&K[bw+":"+bW])&&(!q||bt.charAt(bJ)==="1")&&(!bZ||bZ>=bw)&&bY<=bw&&(!J||!J[bw+":"+bW])){if(bu[bU+bT]<0)continue;if(bk[bJ].charAt(0)=="0"){var b$=+bk[bJ];if((bw-bl[bJ])%b$)continue}bM=bU,bN=bO,by=bP;if(h&&bO<1440&&bP<=0)break;if(bG||i){if(!k){var Z={route:ti.fGetRoutes(bb.id),start_time:bN,date:bR,trip_num:bM%bI};Z.bLowFloorVehicle=bt.charAt(Z.trip_num)=="1",Z.route.stopId=e.id,bf.push(Z),bM=-2;continue}break}}}if(bM<0){if(bM!=-2&&!k&&bK<=s&&bL>=s){var Z={route:ti.fGetRoutes(bb.id),start_time:-1,trip_num:-1};Z.route.stopId=e.id,bf.push(Z)}break}var b_,ca=trip_start_time0=bu[bM%bI];ca*=c;if(bx||by)bR=new Date(a.date.valueOf()),bR.setDate(bR.getDate()+Math.floor(by/1440));i||bG||p?b_=c===-1?1:bi.length:c*(ca-bb.trip_start_time)<0?(b_=c==1?bi.length:1,bb.trip_start_time=ca+by,bb.pos_max=c*bh):(b_=bb.pos_max,b_>c*bh&&ca==bb.trip_start_time&&(bb.pos_max=c*bh));var bT=c*bI;j=e.visited_stops||0;for(var cb=bh;c*(cb+=c)<b_;){bM+=bT;if(bj.charAt(cb)==n)continue;var S;if((S=bu[bM])>=0){S=c*(S+by);if(S>d&&!bG)break;if(S<m&&!p)continue;var N;if(!(N=B[bi[cb]]))continue;if(be&&N.city.indexOf(be)>=0)continue;++j,S+=x;var cc;i&&!bS&&(bS=N.id in Q);if((X[N.id]||N.id===p)&&bS){if(g>0&&S>N.time)continue;if(g>0&&S==N.time&&g>=N.changes)continue;if(typeof cfg==="object"&&cfg.defaultCity==="intercity"&&g==0&&!bG){bG=!0,bH=bI,bJ=c!=-1?-1:bI,a.direct_routes.push(bb);break}if(i||bG){bb.available=0;if(e.id.indexOf(";")<0)for(var cd=0;cd<cb;++cd){if(bj.charAt(cd)==n||bi[cd]==bi[cd+1])continue;if(W[bi[cd]]&&bu[bM+bT*(cd-cb)]>=0){e=B[bi[cd]],bN=bu[bM+bT*(cd-cb)]+by;break}}for(var cd=b_;--cd>cb;){if(bj.charAt(cd)==n||bi[cd]==bi[cd-1])continue;++j;if(X[bi[cd]]&&bu[bM+bT*(cd-cb)]>=0){N=B[bi[cd]],S=bu[bM+bT*(cd-cb)]+x+by;break}}}var Z={direct_trip:bG||i,trip_start_time:trip_start_time0,trip_start_time_adjusted:trip_start_time0+by,legs:[{start_stop:e,start_time:c*bN,time_adjusted:by,trip_date:bR,trip_start_time:trip_start_time0,finish_stop:N,finish_time:c*(S-x),route:bb,trip_num:bM%bT,start_pos:c>=0?bh:cb,finish_pos:c>=0?cb:bh}]};bf.push(Z),cb=b_;if(bG&&S>=N.time)break}else{if(i||bG||p)continue;if(S>=(cc=N.time)){if(cc<m)break;continue}if(bb.available===2){N.time=S,N.changes=-1,N.visited_stops=j,N.trip_date=bR,N.trip_start_time=trip_start_time0,N.time_adjusted=by;continue}N.route=bb,N.prev_stop=e,N.prev_stop_start_time=bN,N.trip_num=bM%bT,N.start_pos=c>=0?bh:cb,N.finish_pos=c>=0?cb:bh}N.time=S,N.trip_date=bR,N.trip_start_time=trip_start_time0,N.time_adjusted=by,N.changes=g+1,N.visited_stops=j,l&&(typeof cfg!="object"||cfg.defaultCity!="vilnius"?(N.rideEnd=S-x,N.id=="00105-1"&&(--g,++g),g==0&&e.prev_stop?N.rideStart=bN-(e.time-e.prev_stop_start_time):N.rideStart=e.rideStart||bN):(N.rideStart=g>0?e.rideStart:bN,N.rideEnd=S-x));var $=bg[S];$?$[$.length]=N:bg[S]=[N]}}}while(i||bG);bu=null}}}if(!k){bf.sort(function(a,b){if(a.route.sortKey<b.route.sortKey)return-1;if(a.route.sortKey>b.route.sortKey)return 1;if(a.start_time<b.start_time)return-1;if(a.start_time>b.start_time)return 1;return 0});return bf}var ce={},cf=Number.POSITIVE_INFINITY;for(var M=bf.length;--M>=0;){var Z=bf[M],cg=Z.legs[0].route?";"+Z.legs[0].route.id:"",ch=Z.legs[Z.legs.length-1];Z.finish_time=ch.finish_time,Z.walk_time=ch.route?0:Math.abs(ch.finish_time-ch.start_time),S=Z.departure_time;for(var ci=Z.legs[0].start_stop;ci;ci=ci.prev_stop){if(!ci.prev_stop)break;ch={start_stop:ci.prev_stop,start_time:c*ci.prev_stop_start_time,finish_stop:ci,finish_time:c*(ci.time-x),route:ci.route,trip_num:ci.trip_num,trip_date:ci.trip_date,time_adjusted:ci.time_adjusted,start_pos:ci.start_pos,finish_pos:ci.finish_pos};if(ci.route){cg=c==1?";"+ci.route.id+cg:cg+";"+ci.route.id;if(c==-1||!Z.trip_start_time)Z.trip_start_time=ci.trip_start_time||ci.time_adjusted,Z.trip_start_time_adjusted=ci.trip_start_time+ci.time_adjusted}else c<0&&(!ci.prev_stop||!ci.prev_stop.prev_stop)&&(ch.finish_time-=x,ch.start_time-=x),Z.walk_time+=Math.abs(ch.finish_time-ch.start_time);Z.legs.splice(0,0,ch)}if(c==-1){var cj=Z.legs[0];if(!cj.route){var ck=Z.legs[1];ck&&ck.route?(cj.start_time+=ck.start_time-cj.finish_time,cj.finish_time=ck.start_time):(cj.start_time-=x,cj.finish_time-=x)}Z.finish_time=Z.legs[0].start_time,Z.legs=Z.legs.reverse();for(var cl=-1,cm=Z.legs.length;++cl<cm;){ch=Z.legs[cl];var S=ch.start_time-ch.finish_time;!ch.route&&cl>0?(ch.start_time=Z.legs[cl-1].finish_time,ch.finish_time=ch.start_time+S):(ch.finish_time=ch.start_time,ch.start_time-=S);var e=ch.finish_stop;ch.finish_stop=ch.start_stop,ch.start_stop=e}}var cj=Z.legs[0],ck=Z.legs[1];if(!cj.route)if(ck&&ck.route){var bE=x;if(a.mode=="vintra"){bE=a.transport[ck.route.transport];if(typeof bE!="number"||bE<0)bE=x}cj.start_time+=ck.start_time-bE-cj.finish_time,cj.finish_time=ck.start_time-bE}else if(a.no_just_walking)continue;Z.start_time=Z.legs[0].start_time,cg==""?(cg="W",Z.code=cg,cf=Z.walk_time):(cg+=";",Z.code=cg,Z.direct_trip&&(cg=Z.legs[0].start_time+"T"+cg));var cn=ce[cg];if(!cn||c==1&&Z.finish_time<cn.finish_time||c!=1&&Z.start_time>cn.start_time)ce[cg]=Z}if(i)a.results=bf;else{var co=[];for(var cg in ce){var Z=ce[cg],cp=Z.code;if(Z.walk_time>=cf&&cg!="W")continue;for(var M=co.length;--M>=0;){var cq=co[M];if(cq.code.indexOf(cp)>=0||cp.indexOf(cq.code)>=0)if(c==1&&cq.finish_time<=Z.finish_time||c!=1&&cq.start_time>=Z.start_time){if(cq.walk_time+cq.travel_time<=Z.walk_time+Z.travel_time&&cp.length>=cq.code.length)break}else!cq.direct_trip&&cq.walk_time+cq.travel_time>=Z.walk_time+Z.travel_time&&co.splice(M,1)}(M<0||Z.direct_trip)&&co.push(Z)}for(var M=co.length;--M>=0;){var Z=co[M];a.reverseOriginal==-1?Z.code=Z.code+"T"+Z.trip_start_time_adjusted:Z.code=Z.trip_start_time_adjusted+"T"+Z.code}a.results=co,typeof window==="object"?window.setTimeout(function(){ti.findTrips(a)},1):ti.findTrips(a)}};if(typeof bs=="function")return bs()}ti.filterSearchResults=function(a,b,c){if(ti.args.time_window){b==-1?a.sort(function(a,b){return-(a.finish_time-b.finish_time)}):a.sort(function(a,b){return a.start_time-b.start_time});for(var d=a.length;--d>=1;){var e=a[d];if(b==-1){if(ti.args.start_time-e.finish_time<=ti.args.time_window)break}else if(e.start_time-ti.args.start_time<=ti.args.time_window)break}a.length=d+1}if(ti.args&&ti.args.mode&&ti.args.mode.indexOf("vintra")>=0){var f=.64,g=.93;for(var d=a.length;--d>=0;){var h=a[d].legs,i=0,j=ticket_expiration_time=0,k=0;for(var l=0;l<=h.length-1;l++){var m=h[l],n=m.route;if(n){m.fares={};var o=0,p,q="";for(var r=1;;++r){var s=n.route_id||ti.toAscii([n.city,n.transport=="eventbus"?"bus":n.transport,n.num].join("_"),!0),t=[s,r,m.start_stop.id,m.finish_stop.id].join("#"),u=ti.fare_rules[t];if(u){o=ti.fare_attributes[u].price||0;break}t=[s,r,"",""].join("#"),u=ti.fare_rules[t];if(!u)break;var v=ti.fare_attributes[u];if(v.transfer_duration)if(v.transfer_duration<m.finish_time-m.start_time){if(!q)if(!p||v.transfer_duration>p)o=v.price,p=v.transfer_duration}else{for(var w=l;--w>=0;){var x=(h[w].fares||{})[u]||{transfer_duration:Number.NEGATIVE_INFINITY};if(x.transfer_duration>=m.finish_time-h[w].start_time){i+=x.price-h[w].cost,h[w].cost=x.price,o=-1,q=u,m.fares={};break}}if(o<0){o=0;break}if(!q||v.price<o)o=v.price,q=u;m.fares[u]=v}else if(!q||v.price<o)o=v.price,q=u}m.cost=o,i+=o}continue}if(!!0)if(ticket_expiration_time<k){i+=f;var y=0;for(var l=h.length;--l>=0;){var m=h[l];if(m.route){y==0&&(y=m.finish_time-30);if(y>m.start_time)break}else if(y>m.start_time&&y>0){y=m.start_time;break}}j+30>=y&&(i+=f-g)}a[d].cost=i}}if(ti.args&&ti.args.optimization.indexOf("shortest")>=0)for(var d=a.length;--d>=0;){var h=a[d].legs,z=0;for(var l=0;l<h.length;l++){var m=h[l];if(m.route){var A=null,B;for(var C=m.start_pos;C<=m.finish_pos;++C){var D=m.route.stops[C];B=ti.stops[D],A&&B&&(z+=ti.distance(A.lat,A.lng,B.lat,B.lng)),A=B}}else{var A=m.start_stop,B=m.finish_stop;z+=ti.distance(A.lat,A.lng,B.lat,B.lng)}}a[d].distance=z}else{for(var d=a.length;--d>=0;){var e=a[d];if(e.remove)continue;for(l=a.length;--l>=0;){if(d===l)continue;a[l].code.indexOf(e.code)<0?e.direct_trip&&!a[l].direct_trip&&e.start_time>=a[l].start_time&&e.finish_time<=a[l].finish_time&&(a[l].remove=!0):a[l].code==e.code?e.start_time<a[l].start_time||e.finish_time>a[l].finish_time?e.remove=!0:a[l].remove=!0:a[l].walk_time<e.walk_time?e.remove=!0:a[l].remove=!0}}var E=0;for(var d=a.length;--d>=0;){var e=a[d];if(e.remove)continue;for(l=a.length;--l>=0;){if(d===l)continue;if(a[l].remove||a[l].legs.length<=1)continue;a[l].legs.length>=e.legs.length+E&&(e.start_time>a[l].start_time&&e.finish_time<=a[l].finish_time?a[l].remove=!0:e.start_time>=a[l].start_time&&e.finish_time<a[l].finish_time&&(a[l].remove=!0))}}}if(cfg.defaultCity=="intercity"||cfg.defaultCity=="latvia")for(var d=a.length;--d>=0;){var e=a[d];e.start_time>=1440&&(e.remove=!0)}var F={};for(var d=a.length;--d>=0;){var e=a[d];e.travel_time=e.finish_time-e.start_time;if(e.remove)continue;if(e.start_time>=1680||e.finish_time<0){e.remove=!0;continue}ti.args&&ti.args.optimization.indexOf("shortest")>=0?e.penalty_time=e.distance:e.penalty_time=e.travel_time+5*e.legs.length;var G=F[e.code];if(!G||G.penalty_time>e.penalty_time)F[e.code]=e}a=[];for(var H in F)a.push(F[H]);a.sort(function(a,b){return a.penalty_time-b.penalty_time});if(ti.args&&ti.args.optimization.indexOf("shortest")>=0)return a;var I=Number.POSITIVE_INFINITY;for(var d=a.length;--d>=0;)a[d].ok=d<5?1:0,I>a[d].travel_time&&(I=a[d].travel_time);a.sort(function(a,b){return a.finish_time-b.finish_time}),b==-1&&a.sort(function(a,b){return-(a.start_time-b.start_time)});if(cfg.defaultCity!="intercity"&&!c){for(var d=a.length;--d>=0;){if(a[d].direct_trip){a[d].ok=1;continue}var J=b==1?a[d].finish_time-a[0].finish_time:a[0].start_time-a[d].start_time;if(J>a[0].travel_time/2+60&&cfg.defaultCity!="latvia")a[d].ok=0;else if(a[d].penalty_time>2*I&&J>I&&d>=2)a[d].ok=0;else if(a[d].walk_time>I&&J>I&&d>=2)a[d].ok=0;else if(d<3||cfg.defaultCity=="latvia"||ti.args.mode=="vintra")a[d].ok=1}a.sort(function(a,b){return b.ok-a.ok});for(var d=a.length;--d>0;)if(a[d].ok==1){a.length=d+1;break}}a.sort(function(a,b){return a.finish_time-b.finish_time}),b==-1&&a.sort(function(a,b){return-(a.start_time-b.start_time)});var K=ti.args.timezone;if(K)for(var d=a.length;--d>=0;){var e=a[d],h=e.legs,L=-999,M=L;for(var l=0;l<h.length;l++){var m=h[l];m.travel_time=m.finish_time-m.start_time;if(m.route){var N;N=m.start_stop,M=K[N.city+" "+N.name.substring(0,6)],isNaN(M)&&(M=K[N.city]||0),m.travel_time+=M*60,L==-999&&(L=M),N=m.finish_stop,M=K[N.city+" "+N.name.substring(0,6)],isNaN(M)&&(M=K[N.city]||0),m.travel_time-=M*60}}e.travel_time-=(M-L)*60}return a},ti.finalizeSearchResults=function(a,b){var c=a.results||[],d=Array(c.length);for(var e=0;e<c.length;e++){var f=c[e],g=f.legs,h=0;d[e]={start_time:f.start_time-h,finish_time:f.finish_time-h,travel_time:f.travel_time,distance:f.distance,cost:f.cost,walk_time:f.walk_time,direct_trip:f.direct_trip,legs:[],code:f.code};var i=Number.POSITIVE_INFINITY;for(var j=0;j<g.length;j++){var k=g[j],l=k.route?k.route.times.workdays[k.trip_num]:"",m=k.route?k.route.times.trip_ids[k.trip_num]:0,n=k.route?k.route.times.trip_codes[k.trip_num]:0,o=k.route?k.route.times.trip_operators[k.trip_num]:"",p=k.route?k.route.times.trip_groups[k.trip_num]:"",q=k.start_stop&&ti.fGetStopDetails(k.start_stop.id),r=k.finish_stop&&ti.fGetStopDetails(k.finish_stop.id),s=k.route&&k.route.platforms&&k.route.platforms.split(",")||[],t={trip_num:k.trip_num,trip_id:m,trip_code:n,trip_date:k.trip_date,trip_operator:o,trip_group:p,start_pos:k.start_pos,finish_pos:k.finish_pos,start_time:k.start_time-h,start_platform:s[k.start_pos||0],finish_platform:s[k.finish_pos||0],finish_time:k.finish_time-h,weekdays:l,cost:k.cost,distance:k.distance,travel_time:k.travel_time||k.finish_time-k.start_time,start_stop:q&&{id:q.id,name:q.name,street:q.street,lat:q.lat,lng:q.lng},finish_stop:r&&{id:r.id,name:r.name,street:r.street,lat:r.lat,lng:r.lng},shape:k.shape};if(k.route){t.stops=[];var u=k.route.times.workdays.length,v=k.route.times.times;for(var w=t.start_pos;++w<t.finish_pos;){var x=k.route.stops[w],y=ti.stops[x],z=v[t.trip_num+w*u]+k.time_adjusted;y=y&&{id:y.id,name:y.name,street:y.street,lat:y.lat,lng:y.lng},y.arrival_time=y.departure_time={minutes:z,value:ti.toUnixTime(a.date,z),text:ti.printTime(z)},y&&k.route.stops[w]==k.route.stops[w+1]&&(++w,z=v[t.trip_num+w*u]+k.time_adjusted,y.departure_time={minutes:z,value:ti.toUnixTime(a.date,z),text:ti.printTime(z)});if(a.mode=="vintra"){var A=ti.LatLngToEN(y.lat,y.lng);y.east=A[0],y.north=A[1]}t.stops.push(y)}t.route=ti.fGetRoutes(k.route);if(b){var B=k.start_time-h,C=Number.POSITIVE_INFINITY;n=t.route.num+String("0000"+n).slice(-4);for(var D=0;D<b.length;++D){var f=b[D];if(f.code==n&&f.fromStopId==q.info&&f.toStopId==r.info){t.online_data=f;break}if(!1&&f.code&&f.code.indexOf(t.route.num)===0){var E=Math.abs(B-ti.toMinutes(f.departureAsStr));C>E&&E<=5&&(C=E,t.online_data=f)}}}}if(ti.taxi)if(k.route&&k.start_time-i>30&&(j==g.length-1||j==g.length-2&&!g[g.length-1].route)||!k.route&&k.finish_time-k.start_time>=15||j==0&&k.start_time-a.start_time>120){for(var D=0;D<ti.taxi.length;++D){var F=ti.taxi[D],G=(q.lng-F.lng)*58.1,H=(q.lat-F.lat)*111.2,I=G*G+H*H,G=(r.lng-F.lng)*58.1,H=(r.lat-F.lat)*111.2,J=G*G+H*H;I<=F.radius&&J<=F.radius&&(t.taxi||(t.taxi=[]),t.taxi.push({name:F.name,phone:F.phone,km:Math.round(Math.sqrt(I))}))}if(t.taxi){t.taxi.sort(function(a,b){return a.km-b.km});var K=t.taxi[0].km;for(var D=1;D<t.taxi.length;++D)if(t.taxi[D].km>K){t.taxi.length=D;break}}}d[e].legs.push(t),k.route&&(i=k.finish_time)}}typeof cfg==="object"&&cfg.defaultCity==="intercity"?(d.sort(function(a,b){return a.start_time-b.start_time}),a.reverse==-1&&d.sort(function(a,b){return-(a.finish_time-b.finish_time)})):(d.sort(function(a,b){return a.finish_time-b.finish_time}),a.reverse==-1&&d.sort(function(a,b){return-(a.start_time-b.start_time)})),typeof ti.args=="object"&&ti.args.optimization&&(ti.args&&ti.args.optimization.indexOf("short")>=0?d.sort(function(b,c){if(b.distance<c.distance)return-1;if(b.distance>c.distance)return 1;return a.reverse==-1?-(b.start_time-c.start_time):b.finish_time-c.finish_time}):ti.args&&ti.args.optimization.indexOf("fast")>=0?d.sort(function(b,c){if(b.travel_time<c.travel_time)return-1;if(b.travel_time>c.travel_time)return 1;return a.reverse==-1?-(b.start_time-c.start_time):b.finish_time-c.finish_time}):ti.args&&ti.args.optimization.indexOf("cheap")>=0&&d.sort(function(b,c){if(b.cost<c.cost)return-1;if(b.cost>c.cost)return 1;return a.reverse==-1?-(b.start_time-c.start_time):b.finish_time-c.finish_time}));return d},ti.splitShape=function(a,b,c,d,e){var f;ti.SERVER===!0?f=a:f=a.split("\n");var g=[],h=Number.POSITIVE_INFINITY,i,j,k=0,l=0,m=0,n,o,p;b*=1e5,d*=1e5,c*=1e5,e*=1e5;for(var q=0;q<f.length;++q)ti.SERVER===!0?(n=f[q],o=n[0],p=n[1]):(n=f[q].split(","),o=+(n[0]||0),p=+(n[1]||0)),o&&p&&(i=(o-b)*(o-b)+(p-c)*(p-c),h>i&&(h=i,k=l=q,j=Number.POSITIVE_INFINITY),i=(o-d)*(o-d)+(p-e)*(p-e),j>i&&(j=i,l=q),g.push([o/1e5,p/1e5]));k<g.length&&l<g.length&&(g=g.slice(k,l+1));return g};function $(a){return document.getElementById(a)}var pg={urlPrevious:"",urlLoaded:"",urlUnderSchedulePane:"",language:"",languageUnderSchedulePane:"",city:"",transport:"",schedule:null,optimalResults:[],transfers:[],showDeparturesWithNumbers:"",GMap:null,hashForMap:"",map:{},mapOverlays:[],mapStops:{},mapStopForZones:"",mapShowVehicles:-1,mapShowAllStops:1,inputActive:null,stopsSuggested:[],stopsSuggestedForText:"",realTimeDepartures:{},vehicleCourses:{},inputStop:"",inputStopText:"",inputStart:"",inputFinish:"",timerSuggestedStopsHide:0,timerSuggestedStopsShow:0,imagesFolder:"images/",translationFolder:"translation/",browserVersion:999,vehicleIconState:""};pg.startVisibilityTest=function(){var a="hidden";a in document?document.addEventListener("visibilitychange",b):(a="mozHidden")in document?document.addEventListener("mozvisibilitychange",b):(a="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",b):(a="msHidden")in document?document.addEventListener("msvisibilitychange",b):"onfocusin"in document?document.onfocusin=document.onfocusout=b:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=b;function b(b){var c="visible",d="hidden",e={focus:c,focusin:c,pageshow:c,blur:d,focusout:d,pagehide:d};b=b||window.event,pg.visibility=d,b.type in e?pg.visibility=e[b.type]:pg.visibility=this[a]?"hidden":"visible"}b({type:"focus"})},pg.addCSS=function(a){var b=document.createElement("style");b.type="text/css",b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a)),document.getElementsByTagName("head")[0].appendChild(b)};var ej=function(a){var b=[],c=[],d=[],e=[],f=[],g=[],h=[],i=[],j,k,l=a.split(","),m,n,o=l.length,p=[],q="+",r="-",s=l[0],t=s.length,u=0,v=[],w=0;while(u<t){var x,y=0,z=0;do x=s.charCodeAt(u++)-63,z|=(x&31)<<y,y+=5;while(x>=32);var A=z&1?~(z>>1):z>>1;y=0,z=0,v.push(A)}H=10,n=240,t=v.length;for(m=-1,j=0;++m<t;){var B=v[m];p[m]=(B&3)==3?"3":B&1?"1":B&2?"2":B&4?"4":"0",B>>=3,m?(H+=B,n+=H):n+=B,b[j++]=n}for(var C=p.length;--C>=0;)p[C]||(p[C]="0");m=1;for(var C=0;++m<o;){var D=+l[m],E=l[++m];E===""?(E=j-C,o=0):E=+E;while(E-->0)d[C++]=D}--m;for(var C=0,o=l.length;++m<o;){var D=+l[m],E=l[++m];E===""?(E=j-C,o=0):E=+E;while(E-->0)e[C++]=D}--m;for(var C=0,o=l.length;++m<o;){var F=l[m],E=l[++m];E===""?(E=j-C,o=0):E=+E;while(E-->0)c[C++]=F}if(ti.has_trips_ids){--m;var o=l.length;for(var C=0;++m<o;){if(l[m]==="")break;f[C]=+l[m],C>0&&(f[C]+=f[C-1]),++C}for(var C=0;++m<o;){if(l[m]==="")break;g[C]=l[m],++C}if(ti.has_trips_ids===2){for(var C=0;++m<o;){if(l[m]==="")break;i[C]=l[m],++C}for(var C=0;++m<o;){if(l[m]==="")break;h[C]=l[m],++C}}++m}--m,k=1;for(var C=j,G=j,H=5,o=l.length;++m<o;){H+=+l[m]-5;var E=l[++m];E!==""?(E=+E,G-=E):(E=G,G=0);while(E-->0)b[C]=H+b[C-j],++C;G<=0&&(G=j,H=5,++k)}final_data={workdays:c,times:b,tag:p.join(""),valid_from:d,valid_to:e,trip_ids:f,trip_codes:g,trip_operators:h,trip_groups:i};return final_data};(function(){navigator.appVersion.indexOf("MSIE")>=0&&(pg.browserVersion=parseFloat(navigator.appVersion.split("MSIE")[1])),typeof document.body.style.transform!="undefined"?pg.transformCSS="transform":typeof document.body.style.MozTransform!="undefined"?pg.transformCSS="-moz-transform":typeof document.body.style.webkitTransform!="undefined"?pg.transformCSS="-webkit-transform":typeof document.body.style.msTransform!="undefined"?pg.transformCSS="-ms-transform":typeof document.body.style.OTransform!="undefined"&&(pg.transformCSS="-o-transform"),cfg.defaultCity=="tallinna-linn"&&(pg.translationFolder="tallinn/translation/");if(window.location.host.indexOf("soiduplaan.tallinn.ee")<0){var a=["stops.lt","ridebus.org","marsruty.ru"];for(var b=0;b<a.length;++b)if(window.location.host.indexOf(a[b])>=0){pg.imagesFolder="../_images/",pg.translationFolder="../_translation/";break}}else pg.imagesFolder="/_images/",pg.translationFolder="/_translation/";cfg.transport_colors={walk:"black",metro:"#ff6A00",bus:"#0073ac",trol:"#dc3131",tram:"#009900",nightbus:"#303030",regionalbus:"#004a7f",suburbanbus:"#004a7f",commercialbus:"purple",intercitybus:"purple",internationalbus:"purple",seasonalbus:"purple",expressbus:"green",minibus:"green",train:"#009900",plane:"#404040",festal:"orange",eventbus:"#ff6a00"},cfg.transport_icons={};for(var b in cfg.transport_colors)cfg.transport_icons[b]="'"+pg.imagesFolder+b+".png'";cfg.transport_icons.expressbus="'"+pg.imagesFolder+"bus_green.png'",cfg.transport_icons.eventbus="'"+pg.imagesFolder+"bus_orange.png'",pg.browserVersion>=8&&(cfg.transport_icons.walk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkBAMAAAATLoWrAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAhUExURQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG3RSMEAAAAKdFJOUwDrWzmzzpF1Hw5JKzDNAAAA0klEQVQoz6WSKw/CQBCEL31BHWlIKKdAEBIUoEgVslShq9BVaFQNHoXAFXotmV/J9Qy3W0WY5MyXfcxOTojf5O56aD7hZAjMGHKAEx/VrxKL3iyxLDm54sVHSVQ3ii4AzoQEmmBKi5QEWoLyFKirklyzBWIZkWvuwH6DgzVd+XphmKkv8poHsBbO2GpME27LWH0ylKHrJJJ1gZjF3AZQ5O6BjiajSfsYmWdppSscvC0SSp2fS3INjCmSToJjl1BNjHY2C2UbbcyOyv4iJigvEn/pAzWNQeXuoaM3AAAAAElFTkSuQmCC",cfg.transport_icons.bus="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAgMAAAAroGbEAAAADFBMVEUAAADAwMD///8Ac6wQQkMlAAAAAXRSTlMAQObYZgAAAD1JREFUeF5lysEJACAMA8CAg7mPMzlBKLiCI/UtQi0WCmIC9wjBk2rTXVSgmG23sbuk/MYnHSbX3KHeMHIA4toiwKUahYMAAAAASUVORK5CYII=",cfg.transport_icons.expressbus="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAgMAAAAroGbEAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURQAAAACAAP///8DAwFdGW0MAAAABdFJOUwBA5thmAAAANklEQVQI12NgQAaioQ5AMmpVAAMDY2hoCJB8tWoLkFy1aglWEqIGQi4NXQInwSIMAUAII0EAAGCcFKbJihAOAAAAAElFTkSuQmCC",cfg.transport_icons.trol="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAgMAAAAroGbEAAAADFBMVEUAAADAwMD////cMTHYIE0PAAAAAXRSTlMAQObYZgAAAEFJREFUeF5lytEJACEMA9BAB3DPm+kmKAVXEFyoAwgxWPDHBN5HCIBMYXPI1gRILUYu+fkv3eO1PtfOON4dqZaVDa25JKCSbwixAAAAAElFTkSuQmCC",cfg.transport_icons.tram="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAgMAAAAroGbEAAAADFBMVEUAAADAwMD///8Afw6EL87tAAAAAXRSTlMAQObYZgAAAEZJREFUeF5lzLEJQCEMBNBA2g8uJPyVnCuVIziHI1ilV4wXFBsv8LgiHBEPIvi5vxVoprBKgk3y6/659nn6XQgBUGTvittZX1shrS0B3oUAAAAASUVORK5CYII=",cfg.transport_icons.nightbus="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAgMAAAAroGbEAAAABGdBTUEAALGPC/xhBQAAAAxQTFRFAAAAwMDA////MDAwFsRlHAAAAAF0Uk5TAEDm2GYAAAA3SURBVHjaY2BABvb/DwDJX6s+MDAw////B0hmrZoDJFetWoOVhKiBkOv/r4GTYBGGD0AII0EAAOLaIsCN4ck7AAAAAElFTkSuQmCC",cfg.transport_icons.regionalbus=cfg.transport_icons.suburbanbus="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAgMAAAAroGbEAAAADFBMVEUAAADAwMD///8ASn8BHE3xAAAAAXRSTlMAQObYZgAAAD1JREFUeF5lysEJACAMA8CAg7mPMzlBKLiCI/UtQi0WCmIC9wjBk2rTXVSgmG23sbuk/MYnHSbX3KHeMHIA4toiwKUahYMAAAAASUVORK5CYII=",cfg.transport_icons.commercialbus=cfg.transport_icons.intercitybus=cfg.transport_icons.internationalbus=cfg.transport_icons.seasonalbus="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAgMAAAAroGbEAAAADFBMVEUAAADAwMD///+AAIDHvR5zAAAAAXRSTlMAQObYZgAAAD1JREFUeF5lysEJACAMA8CAg7mPMzlBKLiCI/UtQi0WCmIC9wjBk2rTXVSgmG23sbuk/MYnHSbX3KHeMHIA4toiwKUahYMAAAAASUVORK5CYII=",cfg.transport_icons.eventbus="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAgMAAAAroGbEAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURQAAAP9qAP///8DAwAwZbqEAAAABdFJOUwBA5thmAAAANklEQVQI12NgQAaioQ5AMmpVAAMDY2hoCJB8tWoLkFy1aglWEqIGQi4NXQInwSIMAUAII0EAAGCcFKbJihAOAAAAAElFTkSuQmCC",cfg.transport_icons.minibus="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAgMAAAAroGbEAAAABGdBTUEAALGPC/xhBQAAAAxQTFRFAAAAwMDA////AH8OhC/O7QAAAAF0Uk5TAEDm2GYAAAAzSURBVHjaY2DABPz/QaTd6gNA8v//D0Dy1qoCIPlq1QY4CRGHkK//bYCTEBEb5gNwEgEAnKMcHFzyiOMAAAAASUVORK5CYII=",cfg.transport_icons.train="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAgMAAAAroGbEAAAADFBMVEUAAADAwMD///8Afw6EL87tAAAAAXRSTlMAQObYZgAAAEJJREFUeF5lzLEJACAMBMAXV7J0ImdyguAIFtnHxgHEGEhI4xdXPM/DI7KBLHLURl0lGr+2Cdedpjf+g5I4PhkVlgctPiXCztUWnAAAAABJRU5ErkJggg==",cfg.transport_icons.plane="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASBAMAAACk4JNkAAAAD1BMVEUAAABAQEBLS0uAgIA5OTlhl+UMAAAAAXRSTlMAQObYZgAAAEBJREFUeF5tzNEJACAIRVGtBXqjOEL7LxXesJ98oBwVtC++Siq5csqwCsRloptG/qTlql8D5a+JIjti3saSanMATQYDyukaLU8AAAAASUVORK5CYII="),cfg.defaultCity=="riga"?(cfg.transport_colors.minibus="#7f237e",cfg.transport_icons.minibus="images/minibus_magenta.png",cfg.transport_colors.expressbus="#ff6600",cfg.transport_icons.expressbus="images/minibus_FF6600.png"):cfg.defaultCity=="rostov"?(cfg.transport_colors.bus="#dc3131",cfg.transport_colors.trol="#0073ac",cfg.transport_colors.minibus="#FF6600",cfg.transport_colors.suburbanbus="#9c1630",cfg.transport_icons.bus="images/bus_red.png",cfg.transport_icons.trol="images/trol_blue.png",cfg.transport_icons.minibus="images/minibus_FF6600.png",cfg.transport_icons.suburbanbus="images/suburbanbus_9c1630.png"):cfg.defaultCity=="tallinna-linn"?(cfg.transport_colors.bus="#00e1b4",cfg.transport_colors.trol="#0064d7",cfg.transport_colors.tram="#ff601e",cfg.transport_colors.regionalbus="#9c1630",cfg.transport_colors.commercialbus="#7f0086",cfg.transport_icons.bus="images_tallinn/bus.png",cfg.transport_icons.trol="images_tallinn/trol.png",cfg.transport_icons.tram="images_tallinn/tram.png",cfg.transport_icons.regionalbus="images_tallinn/regionalbus.png",cfg.transport_icons.commercialbus="images_tallinn/commercialbus.png",cfg.transport_icons.train="images_tallinn/train.png"):cfg.defaultCity=="krasnodar"||cfg.defaultCity=="mariupol"?(cfg.transport_colors.bus="green",cfg.transport_colors.trol="#0073ac",cfg.transport_colors.tram="#dc3131",cfg.transport_colors.minibus="#ff6600",cfg.transport_icons.bus="images/bus_green.png",cfg.transport_icons.trol="images/trol_blue.png",cfg.transport_icons.tram="images/tram_red.png",cfg.transport_icons.minibus="images/minibus_FF6600.png"):cfg.defaultCity=="chelyabinsk"?(cfg.transport_colors.minibus="#7f237e",cfg.transport_icons.minibus="images/minibus_magenta.png"):cfg.defaultCity=="klaipeda"&&(cfg.transport_colors.minibus="#ff6600",cfg.transport_icons.minibus="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASAgMAAAAroGbEAAAACVBMVEUAAADy0CQAAAB9nBbiAAAAAXRSTlMAQObYZgAAAB1JREFUCNdjwAUYQ0ND0MioKAS5dOkSKImpEhcAAHlGC+u+8/jOAAAAAElFTkSuQmCC");if(cfg.defaultCity=="vilnius"&&cfg.city.datadir!="vilniusGTFS"||cfg.defaultCity=="alytus"||cfg.defaultCity=="rostov"||cfg.defaultCity=="krasnodar"||cfg.defaultCity=="siauliai"||cfg.defaultCity=="novorossiysk"||cfg.defaultCity=="klaipeda"||cfg.defaultCity=="mariupol"||cfg.defaultCity=="kharkiv")ti.explodeTimes=ej;var c="";for(var b in cfg.transport_colors){var d=cfg.transport_colors[b];c+="."+b+"{ background-color:"+d+"; }",typeof mobile!="undefined"&&(c+=".nav-transport ."+b+" span, .nav-transport ."+b+" a, .icon.icon-"+b+"{ background-image:url("+cfg.transport_icons[b]+"); }",c+=".icon-"+b+"{ width:18px; height:18px;}",c+=".label-"+b+" {background-color:"+d+";}"),cfg.city.defaultTransport!="tablo"&&(c+=".icon.icon_"+b+"{ background-image:url("+cfg.transport_icons[b]+");}"),c+=".transfer"+b+",a.transfer"+b+"{ color:"+d+"; font-weight:bold; }",c+=".departure"+b+"{ color:"+d+"; font-size:smaller; font-style:normal; }"}cfg.city.custom_css&&(cfg.city.custom_css=cfg.city.custom_css.replace(new RegExp("_images/","g"),pg.imagesFolder),c+=cfg.city.custom_css||""),pg.addCSS(c)})(),pg.bodyKeyDown=function(a,b){b||(b=window.event?window.event.keyCode:a.keyCode);if(b==27){var c=$("ulScheduleDirectionsList");c&&c.style&&c.style.display!="none"?c.style.display="none":pg.schedule&&pg.aScheduleClose_Click(a)}},pg.fLang_Click=function(a){var b=a&&(a.target||a.srcElement);if(b&&(b.tagName||"").toLowerCase()=="a"){if(b.innerHTML.length<10){pg.fUrlSet({schedule:pg.schedule,language:b.innerHTML});return pg.cancelEvent(a)}}else if(b&&(b.tagName||"").toLowerCase()=="img"){pg.fUrlSet({schedule:pg.schedule,language:b.src.slice(-6,-4)});return pg.cancelEvent(a)}return!1},pg.divHeader_Click=function(a){a=a||window.event;var b=a.target||a.srcElement;while(b&&b.nodeName.toLowerCase()!=="a")b=b.parentNode;if(b&&b.href&&b.href.indexOf("http:")>=0)return!0;pg.aScheduleClose_Click(a)},pg.aScheduleClose_Click=function(a){a=a||window.event;if(pg.schedule)if(pg.urlUnderSchedulePane=="")pg.city="nothing",pg.fUrlSet({city:pg.schedule.city,transport:pg.schedule.transport,schedule:null});else{var b=pg.fUrlParse(pg.urlUnderSchedulePane);b.language!=pg.language&&(b.language=pg.language,pg.city="nothing"),b.schedule=null,pg.fUrlSet(b)}return pg.cancelEvent(a)},pg.fCreateLanguagesBar=function(){var a=$("divLang"),b="",c=cfg.city.languages.split(",");for(var d=0;d<c.length;d++){var e=c[d];cfg.city.languageFlags?b+="<a title=\""+cfg.languages[e]+"\"><img src=\""+e+".png\" style=\"width:32px; height:26px; padding:0 5px;\"></a>":(b+="<a title=\""+cfg.languages[e]+"\" class=\"underlined\">"+e+"</a>",cfg.city.navigation==="riga"&&d%3===2?b+=" ":b+="&nbsp;")}(a||{}).innerHTML=b},pg.fTranslateStaticTexts=function(){var a=pg.language||cfg.defaultLanguage;i18n.transport.expressbus=i18n.transport["expressbus_"+cfg.defaultCity]||i18n.transport.expressbus,i18n.transport1.expressbus=i18n.transport1["expressbus_"+cfg.defaultCity]||i18n.transport1.expressbus;if(cfg.defaultCity==="chelyabinsk"&&a=="ru"){i18n.transport.minibus=i18n.transport1.minibus=cfg.city.minibus;var b=i18n.lowFloorVehicles.lastIndexOf(",");b>1&&(i18n.lowFloorVehicles=i18n.lowFloorVehicles.substr(0,b)),b=i18n.lowFloorDepartures.lastIndexOf(","),b>80&&(i18n.lowFloorDepartures=i18n.lowFloorDepartures.substr(0,b)+"."),b=i18n.checkHandicapped.lastIndexOf(",")}cfg.defaultCity==="rostov"&&((cfg.city.minibus||{})[a]&&(i18n.transport.minibus=i18n.transport1.minibus=cfg.city.minibus[a]),(cfg.city.train||{})[a]&&(i18n.transport.train=i18n.transport1.train=cfg.city.train[a])),cfg.defaultCity==="siauliai"&&a=="lt"&&(i18n.transport.minibus="Prive&#382;amieji autobusai",i18n.transport1.minibus="Prive&#382;amasis autobusas"),cfg.defaultCity==="klaipeda"&&(i18n.smallBus12Departures=(i18n.smallBus12Departures||"").replace("Melsvu","Geltonu"),i18n.smallBus12Departures=(i18n.smallBus12Departures||"").replace("light blue","yellow"),a=="lt"&&(i18n.lowFloorVehicleMapTip="pritaikytas ne&#303;galiesiems",i18n.transport.expressbus="Ekspresiniai autobusai")),cfg.defaultCity==="alytus"&&(i18n.smallBus12Service=i18n.bigBusService,i18n.smallBus12Departures=i18n.bigBusDepartures,i18n.smallBus12Tip=i18n.bigBusTip,i18n.scheduleComments=(i18n.scheduleComments||"").replace("(troleibuso)",""),i18n.scheduleChangedDepartures=(i18n.scheduleChangedDepartures||"").replace("/troleibusas",""),i18n.lowFloorDepartures=i18n.canceledDepartures),cfg.defaultCity==="vilnius"&&(i18n.menuTickets=i18n.moreInformation||"",($("spanNewSchedulesSummer")||{}).innerHTML=i18n.NewSchedulesSummer,($("aNewSchedulesSummer")||{}).href="//www.stops.lt/vilnius/vasara.html#"+a,($("spanNewSchedulesWinter")||{}).innerHTML=i18n.NewSchedulesWinter,($("aNewSchedulesWinter")||{}).href="//www.stops.lt/vilnius/ruduo.html#"+a,i18n.transport.eventbus!=i18n.sumenek&&(i18n.transport.commercialbus=i18n.transport.eventbus,i18n.transport1.commercialbus=i18n.transport1.eventbus),i18n.sumenek&&(i18n.transport.eventbus=i18n.transport1.eventbus=i18n.sumenek)),document.title=i18n.headerTitle,($("header")||{}).innerHTML=(cfg.city.logoInHeader||"")+i18n.headerTitle,($("spanYouAreHere")||{}).innerHTML=i18n.youAreHere,($("aYouAreHere")||{}).href=pg.hashHome=(pg.hashHome+"map").split("map")[0]+"map/"+pg.language,($("spanRoutesFromStop")||{}).innerHTML=i18n.departingRoutes+":",($("spanPlan")||{}).innerHTML=cfg.city.navigation!=="top"?i18n.tripPlanner:i18n.tripPlanner.replace("<br/>"," ").replace("<br>"," "),($("spanShowMap")||{}).innerHTML=i18n.showStopsMap,($("spanShowVehicles")||{}).innerHTML=i18n.mapShowVehicles,($("spanShowTraffic")||{}).innerHTML=i18n.mapShowTraffic,($("aPlanShowMap")||{}).innerHTML="<br/><br/>"+i18n.showStopsMap.toLowerCase(),($("spanPrintSchedule")||{}).innerHTML=i18n.print,($("spanReturnToRoutes")||{}).innerHTML=i18n.returnToRoutes,($("spanShowDirectionsMap")||{}).innerHTML=i18n.showInMap,($("buttonSearch")||{}).value=i18n.searchRoute,($("inputReverseDepart")||{}).text=i18n.depart,($("inputReverseArrive")||{}).text=i18n.arrive,($("labelDepartureDate")||{}).innerHTML=i18n.departuresFor,($("inputDepartureDate-1")||{}).text=i18n.fromNow,($("inputDate0")||{}).text=($("inputDepartureDate0")||{}).text=i18n.today,($("inputDate1")||{}).text=($("inputDepartureDate1")||{}).text=i18n.tomorrow,($("mapShowAllStops")||{}).title=i18n.mapShowAllStops,($("mapShowWifiStops")||{}).title=i18n.mapShowWifiStops,($("mapShowBicyclesRent")||{}).title=i18n.mapShowBicyclesRent,($("mapShowTraffic")||{}).title=i18n.mapShowTraffic,($("mapShowVehicles")||{}).title=i18n.mapShowVehicles,($("mapShowCoolVehicles")||{}).title=i18n.mapShowCoolVehicles,($("mapShowWifiVehicles")||{}).title=i18n.mapShowWifiVehicles,($("mapShowUsbVehicles")||{}).title=i18n.mapShowUsbVehicles;var c=new Date;for(var b=2;b<=31;b++){var d=new Date(c.getFullYear(),c.getMonth(),c.getDate()+b);($("inputDate"+b)||{}).text=pg.formatDate(d),($("inputDepartureDate"+b)||{}).text=pg.formatDate(d)}($("labelHandicapped")||{}).title=i18n.checkHandicapped,($("aExtendedOptions")||{}).innerHTML=($("divContentPlannerOptionsExtended")||{style:{}}).style.display?i18n.extendedOptions:i18n.extendedOptionsHide,($("labelRoutes")||{}).innerHTML=i18n.rideOnlyRoutes+"",($("labelChangeTimeText")||{}).innerHTML=i18n.timeForConnection+"",($("labelWalkMaxText")||{}).innerHTML=i18n.walkingMax+"",($("labelWalkSpeedText")||{}).innerHTML=i18n.walkingSpeed+"";var e=$("inputStop");e&&(e.title=i18n.typeStartStop,e.className=="empty"&&(e.value=i18n.startStop)),e=$("inputStart"),e&&(e.title=i18n.typeStartStop,e.className=="empty"&&(e.value=i18n.startStop)),e=$("inputFinish"),e&&(e.title=i18n.typeFinishStop,e.className=="empty"&&(e.value=i18n.finishStop)),e=$("inputRoutes"),e&&(e.title=i18n.typeRouteNameOrNumber,e.className=="empty"&&(e.value=i18n.typeRouteNameOrNumber)),($("labelInputRoutes")||{}).innerHTML=i18n.filter+":"},pg.fGetCity=function(a){for(var b in cfg.cities)if(cfg.cities[b].region===a)return b;return a},pg.fCreateNavigation=function(a){if(typeof mobile=="undefined"||typeof a!="undefined"){var b="<dt class=\"splitter\"></dt><!-- -->",c=pg.fGetCity(pg.city),d=0;if(typeof mobile!="undefined")var e=[];if(cfg.cities[c]){var f="",g="",h={};for(var i=1;i<=2;i++){var j=pg.fUrlSet({city:c,transport:null,hashForMap:null},!0);typeof mobile!="undefined"&&e.push({hash:j,city:c,type:i==1?"city":"region",transport:[],timeout:cfg.cities[c].goHomeTimeout});if(!cfg.cities[c].goHomeTimeout){f+="<dt><a id=\""+(i==1?"city":"region")+"\" href=\"#"+j+"\">"+(cfg.cities[c].logo||"")+"<span class=\"hover\">";var k=cfg.cities[c].name;if(k)var l=k[pg.language]||k.en||(i==1?i18n.cityRoutes:i18n.regionRoutes);else var l=i==1?i18n.cityRoutes:i18n.regionRoutes;f+=l,typeof mobile!="undefined"&&(e[i-1].name=l,e[i-1].logo=cfg.cities[c].logo||""),f+="</span></a></dt>"}for(var m=0;m<cfg.cities[c].transport.length;m++){var n=cfg.cities[c].transport[m];if((cfg.cities[c].transportTemporary||{})[n]&&!(ti.cityTransportRoutes||{})[c+"_"+n]){ti.routes&&(cfg.cities[c].transport.splice(m,1),--m);continue}var o=" checked=\"checked\"";cfg.cities[c].transportPlannerUncheck&&cfg.cities[c].transportPlannerUncheck[n]&&(o="");var p=pg.fUrlSet({city:c,transport:n,hashForMap:null},!0),q=((cfg.cities[c].transportTip||{})[n]||{})[pg.language];q&&(q=" title=\""+q+"\""),f+=("<dt><a id=\""+c+"_{tr}\" href=\"#"+p+"\""+q+"><span class=\"icon icon_{tr}\"></span><span class=\"hover\">"+i18n.transport[n]+"</span></a></dt>").replace(/{tr}/g,n),typeof mobile!="undefined"&&e[i-1].transport.push({hash:p,transport:n,name:i18n.transport[n]}),h[n]||(h[n]=!0,g+=("<label for=\"checkbox{tr}\"><input name=\"checkbox{tr}\" id=\"checkbox{tr}\" type=\"checkbox\" value=\"{tr}\""+o+"/>").replace(/{tr}/g,n)+i18n.transport[n]+"</label> "),cfg.transportOrder[n]=++d}c=cfg.cities[c].region;if(!c||!cfg.cities[c])break;f+=b}if(cfg.defaultCity=="pskov"){f+=b;var r=["dedovichi","nevel","novorzhev","ostrov","porxov"];for(var m=0;m<r.length;++m){var c=r[m];f+="<dt><a id=\""+c+"_bus\" href=\"#"+c+"/bus\"><span class=\"hover\">"+cfg.cities[c].name[pg.language]+"</span></a></dt>"}}($("listTransports")||{}).innerHTML=f,($("divContentPlannerOptionsTransport")||{}).innerHTML=i18n.optionsTransport+"&nbsp;"+g}cfg.transportOrder.commercialbus&&cfg.transportOrder.regionalbus&&(cfg.transportOrder.commercialbus=cfg.transportOrder.regionalbus),a&&a(e)}},pg.fLoadPage=function(){cfg.city.languages=cfg.city.languages||"en,ru",cfg.defaultLanguage=cfg.city.defaultLanguage||cfg.city.languages.split(",")[0],pg.showDeparturesWithNumbers!==!0&&pg.showDeparturesWithNumbers!==!1&&(pg.showDeparturesWithNumbers=cfg.city.showDeparturesWithNumbers,pg.toggleClass($("divScheduleContentInner"),"HideNumbers",!pg.showDeparturesWithNumbers)),pg.fTranslateStaticTexts(),pg.fCreateLanguagesBar(),pg.loadedRoutesHash=null,pg.loadedDepartingRoutes=null,pg.loadedPlannerParams=null,pg.fCreateNavigation(null,"2"),pg.fTabActivate();pg.schedule&&pg.fScheduleLoad()},pg.fLoadLanguageScript=function(a,b){var c=$("scriptLanguage");c&&document.getElementsByTagName("head")[0].removeChild(c);var d=document.createElement("script");d.setAttribute("id","scriptLanguage"),d.setAttribute("type","text/javascript"),d.setAttribute("src",pg.translationFolder+a+".js"),b&&d.addEventListener("load",function(a){b(a)},!1),document.getElementsByTagName("head")[0].appendChild(d)},pg.fTogglePlannerOptions=function(a){var b=$("divContentPlannerOptionsExtended");b.style.display&&a!==!1?(b.style.display="",($("aExtendedOptions")||{}).innerHTML=i18n.extendedOptionsHide):(b.style.display="none",($("aExtendedOptions")||{}).innerHTML=i18n.extendedOptions);if(a)return pg.cancelEvent(a)},pg.storeMyLocation=function(a){var b=a.coords.latitude=Math.round(a.coords.latitude*1e6)/1e6,c=a.coords.longitude=Math.round(a.coords.longitude*1e6)/1e6;pg.myLocation=b+";"+c},pg.replaceHtml=function(a,b){if(a){var c=a.nextSibling,d=a.parentNode;d.removeChild(a),a.innerHTML=b,c?d.insertBefore(a,c):d.appendChild(a)}},pg.storeStyles=function(){pg.styles={};var a=document.styleSheets||[];for(var b=0;b<a.length;++b){var c=[];try{c=a[b].rules||a[b].cssRules||[]}catch(d){}for(var e=c.length;--e>=0;){var f=c[e].selectorText;if(f){var g=c[e].style,h=f.split(",");for(var i=h.length;--i>=0;)pg.styles[h[i].trim()]=g}}}},pg.getProtocol=function(){return location.protocol=="https:"?"https:":"http:"},pg.getStyle=function(a){if(a&&a.indexOf("transport_icon_")==0){var b=a.substring("transport_icon_".length),c=(pg.styles[".icon.icon_"+b]||pg.styles[".icon_"+b+".icon"]||pg.styles[".icon-"+b]||{backgroundImage:pg.imagesFolder+b+".png"}).backgroundImage||"";c=c.replace(/\"/g,""),c=c.replace(/\'/g,""),c.indexOf("url(")==0&&(c=c.substring(4,c.length-1));return c}return pg.styles[a]},pg.styleRGBtoHex=function(a){if(a=="green")return"008000";if(a=="purple")return"800080";if(a=="orange")return"FFA500";if(a.indexOf("#")===0)return a.substring(1);var b=a.replace("rgb(","").replace(")",""),c=b.split(",");b=((1<<24)+(+c[0]<<16)+(+c[1]<<8)+ +c[2]).toString(16).slice(1);return b},pg.toggleClass=function(a,b,c){if(a){var d=" "+(a.className||"")+" ";c&&d.indexOf(" "+b+" ")<0?a.className=(d+b).trim():!c&&d.indexOf(" "+b+" ")>=0&&(a.className=d.replace(" "+b+" ","").trim())}},pg.cancelEvent=function(a){a&&(a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation());return!1},pg.formatDate=function(a,b){typeof a=="number"&&(a=new Date(a*1e3*60*60*24));var c=a.getDate(),d=1+a.getMonth(),e=a.getFullYear();if(typeof b!="undefined"||(pg.language=="ru"||pg.language=="ee"))e=c,c=a.getFullYear();var f=(e<10?"0":"")+e+(d<10?"-0":"-")+d+(c<10?"-0":"-")+c;return b?f.replace(/-/g,b):f},pg.nonEmptyCount=function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&a[c]&&++b;return b},pg.render_airport_icon=function(a,b){if(a&&a.length>=9&&a.toLowerCase().indexOf("ro uostas")>=(b?a.length-9:0))return"&nbsp;<img style=\"vertical-align:text-top;\" height=\"16\" width=\"16\" src=\""+pg.imagesFolder+"airport_gray_36.png\" alt=\"airport\" title=\"\" />";return""},pg.vehicle_features_html=function(a,b){var c=[];a=a||{},a.bLowFloorVehicle&&b&&c.push("<img class=\"icon highlighted\" src=\""+pg.imagesFolder+"wheelchair.svg\">"),a.bCoolVehicle&&c.push("<img class=\"icon\" src=\""+pg.imagesFolder+"snowflake.png\">"),a.bBicycle&&c.push("<img class=\"icon\" src=\""+pg.imagesFolder+"bicycle.png\">");return c.join("&nbsp;")},cfg.city.areaBounds&&(pg.geocoder={index:{},suggestions:{},interval:300,timer:null,getPlaceId:function(key,callback){var self=this,url="https://geocoder.api.here.com/6.2/geocode.json?app_id=tCceiFWbbHa1UBUxw6P0&app_code=rpIftmFMyPP4h_m1YdP8Dw&jsonattributes=1&gen=9&locationid="+key.slice(1);ti.fDownloadUrl("GET",url,function(response){var result=[];try{JSON?result=JSON.parse(response):result=eval("(function(){return "+response+";})()"),result=(result.response||{}).view||[],result=(result[0]||{}).result||[]}catch(error){typeof (console||{}).log=="function"&&(console.log("WARNING: invalid JSON data from place details service: "+error),console.log("JSON data: "+response))}if(result.length){result=(result[0]||{}).location||{};var address=(result.address||{}).label||"";address=address.replace(", Lietuva",""),result=result.displayPosition||{};var lat=Math.round((result.latitude||0)*1e5)/1e5,lng=Math.round((result.longitude||0)*1e5)/1e5;if(lat&&lng){var id=[lat,lng].join(";");self.index[id]=address||id,callback(id)}}})},search:function(str,callback){var str2=ti.toAscii(str.trim());if(this.suggestions[str2])callback(this.suggestions[str2]);else{var self=this;this.timer!==null&&(window.clearTimeout(this.timer),this.timer=null),this.timer=window.setTimeout(function(){var b=cfg.city.areaBounds,url="https://places.api.here.com/places/v1/autosuggest?app_id=tCceiFWbbHa1UBUxw6P0&app_code=rpIftmFMyPP4h_m1YdP8Dw"+encodeURI("&hlStart=<b>&hlEnd=</b>&q="+str)+"&in="+b.southWest.lng+","+b.southWest.lat+","+b.northEast.lng+","+b.northEast.lat;ti.fDownloadUrl("GET",url,function(response){var predictions=[];try{JSON?predictions=JSON.parse(response):predictions=eval("(function(){return "+response+";})()"),predictions=predictions.results||predictions.suggestions||[]}catch(error){typeof (console||{}).log=="function"&&(console.log("WARNING: invalid JSON data from autosuggest service: "+error),console.log("JSON data: "+response))}var patt=cfg.city.addressFilter;if(predictions.length){var final_results=[],collected_names={};for(var i=0,prediction;prediction=predictions[i];i++){if((prediction.position||[]).length<2)continue;var name=prediction.title+", "+prediction.vicinity,name0=name.split("<br/>").join(", ");name=prediction.highlightedTitle+", "+prediction.highlightedVicinity,name=name.split("<br/>").join(", ");if(collected_names[name])continue;collected_names[name]=!0;var lat=Math.round((prediction.position[0]||0)*1e5)/1e5,lng=Math.round((prediction.position[1]||0)*1e5)/1e5,id=lat+";"+lng;self.index[id]=name0||id,final_results.push({name:name,type:prediction.type,id:id,lat:lat,lng:lng}),self.suggestions[name]=final_results[final_results.length-1]}self.suggestions[str2]=final_results,callback(final_results)}else callback([])})},self.interval)}}}),pg.location_interval_key=null,pg.location_circle=null,pg.location=null,pg.getLocation=function(a){a.classList.add("active");if(navigator.geolocation){window.clearInterval(pg.location_interval_key),pg.location_interval_key=window.setInterval(function(){a.classList.toggle("active")},500);function b(b){window.clearInterval(pg.location_interval_key),a.classList.add("active"),pg.location=b;var c=[b.coords.latitude,b.coords.longitude];pg.GMap&&(pg.location_circle&&pg.location_circle.remove(),pg.location_circle=L.circle(c,b.accuracy).addTo(pg.GMap),pg.GMap.flyTo(c,16),pg.GMap.once("moveend",function(){pg.fToggleVehicles(2),pg.mapShowAllStops=2,pg.clusterManager.refresh()}))}function c(b){window.clearInterval(pg.location_interval_key),a.classList.remove("active");var b="";switch(b.code){case b.PERMISSION_DENIED:b="User denied the request for Geolocation.";break;case b.POSITION_UNAVAILABLE:b="Location information is unavailable.";break;case b.TIMEOUT:b="The request to get user location timed out.";break;case b.UNKNOWN_ERROR:b="An unknown error occurred."}console.log("error",b)}navigator.geolocation.getCurrentPosition(b,c,{maximumAge:6e5,timeout:1e4,enableHighAccuracy:!0})}else console.log("Geolocation is not supported by this browser.")},pg.fUrlSet=function(a,b){if(a){a.schedule&&pg.schedule&&(typeof a.schedule.city=="undefined"&&(a.schedule.city=pg.schedule.city),typeof a.schedule.transport=="undefined"&&(a.schedule.transport=pg.schedule.transport),typeof a.schedule.num=="undefined"&&(a.schedule.num=pg.schedule.num),typeof a.schedule.dirType=="undefined"&&(a.schedule.dirType=pg.schedule.dirType),typeof a.schedule.stopId=="undefined"&&(a.schedule.stopId=pg.schedule.stopId));var c=["city","transport","inputStop","inputStart","inputFinish","hashForMap","language"];for(var d=c.length;--d>=0;)typeof a[c[d]]=="undefined"&&(a[c[d]]=pg[c[d]])}else a=pg;var e="";if(a.schedule)e=(a.schedule.tripNum||"")+(e?"/"+e:""),e=(a.schedule.stopId||"")+(e?"/"+e:""),e=(typeof mobile!="undefined"&&!b?a.schedule.dirUrl||"":a.schedule.dirType||"")+(e?"/"+e:""),e=(a.schedule.num||"")+(e?"/"+e:""),e=(a.schedule.transport||"")+(e?"/"+e:""),a.schedule.city&&a.schedule.city!=cfg.defaultCity&&(e=a.schedule.city+(e?"/"+e:"")),e+=a.hashForMap?"/map":"";else{a.transport=="stop"?(a.city=pg.fGetCity(a.city),e="stop"+(a.inputStop?"/"+a.inputStop:"")):a.transport=="plan"?(a.city=pg.fGetCity(a.city),e="plan/"+(a.inputStart||"")+(a.inputFinish?"/"+a.inputFinish:"")):e=(a.transport||"")+(e?"/"+e:"");if(!e||a.city!==cfg.defaultCity)e=a.city+(e?"/"+e:"");e+=a.hashForMap?"/"+a.hashForMap:""}e+=a.language!=cfg.defaultLanguage?"/"+a.language:"",e=ti.toAscii(e,!0);if(b)return e;Hash.go(e);return e},pg.fUrlSetMap=function(a,b){var c=pg.hashForMap||"map";a?(typeof a!="object"&&(a={}),a.optimalRoute&&(c="map,,,"+a.optimalRoute),a.maximized&&c.indexOf(",max")<0&&(c+=",max"),a.maximized===!1&&(c=c.replace(",max","")),a.clusters&&c.indexOf(",stops")<0&&(c+=",stops"),a.clusters===!1&&(c=c.replace(",stops",""))):c="";if(b)return c;pg.hashForMap=c,c=pg.fUrlSet(null,!0),c!=Hash.getHash()?Hash.go(c):pg.fMapShow()},pg.fUrlParse=function(a){a=decodeURI(a);var b={},c=a.indexOf("#");c>=0&&(a=a.substring(c+1)),a=a?a.split("/"):[],a.length&&(","+cfg.city.languages+",").indexOf(","+a[a.length-1]+",")>=0?b.language=a.pop():b.language=cfg.defaultLanguage,a.length&&"map"===a[a.length-1].substring(0,3)?b.hashForMap=a.pop():b.hashForMap="",b.transport="",a[0]||(b.transport=typeof cfg.city.defaultTransport!="undefined"?cfg.city.defaultTransport:cfg.city.transport[0]),a.length&&cfg.cities[a[0]]?b.city=a.shift():b.city=cfg.defaultCity,a[0]&&(b.transport=a[0],a[0]==="stop"?b.inputStop=a[1]||"":a[0]==="plan"?(b.inputStart=a[1]||"",b.inputFinish=a[2]||""):a[1]&&(b.schedule={city:b.city,transport:a[0],num:a[1],dirType:a[2]||"",stopId:a[3]||"",tripNum:isNaN(a[4])?0:+a[4],dirUrl:a[2]||""}));return b},pg.fUrlExecute=function(a){var b=pg.fUrlParse(a),c=pg.language;pg.language=b.language;var d=pg.city;pg.city=b.city;var e=pg.hashForMap;pg.hashForMap=b.hashForMap,pg.transport=b.transport,pg.inputStop=b.inputStop||pg.inputStop,pg.inputStart=b.inputStart||pg.inputStart,pg.inputFinish=b.inputFinish||pg.inputFinish,pg.urlPrevious=pg.urlLoaded,pg.urlLoaded=a,b.schedule?pg.fScheduleShow(b.schedule):(pg.fScheduleHide(),pg.fTabActivate()),c!=pg.language&&(c||pg.language!=cfg.defaultLanguage)&&pg.fLoadLanguageScript(pg.language),d!==pg.city&&cfg.defaultCity!="pskov"&&(cfg.cities[d]||{region:""}).region!==pg.city&&pg.fLoadPage(),pg.hashForMap?(e!==pg.hashForMap,pg.fMapShow()):document.body.className.indexOf("Map")>=0&&pg.fMapHide(),typeof mobile!="undefined"&&(b.hash=a,mobile.render(b))},cfg.yandexAPIkey="fd2746d9-dd29-4e30-a38a-a0d53590c8a1",cfg.hereAppId="tCceiFWbbHa1UBUxw6P0",cfg.hereAppCode="rpIftmFMyPP4h_m1YdP8Dw",typeof jq=="undefined"&&(jq=function(a){var b=null;if(typeof a=="string"){var c=a.charAt(0);c=="#"?b=document.getElementById(a.substr(1)):c=="."?b=document.getElementsByClassName(a.substr(1))[0]:b=document.getElementsByTagName(a)[0]}else b=a;return{el:b,hasClass:function(a){return this.el.className.match(new RegExp("(\\s|^)"+a+"(\\s|$)"))},addClass:function(a){this.hasClass(a)||(this.el.className+=" "+a);return this},removeClass:function(a){this.el.className=this.el.className.replace(new RegExp("\\b"+a+"\\b"),"");return this},toggleClass:function(a){var b=this.el.className.split(" "),c=b.indexOf(a);c!=-1?b.splice(c,1):b.push(a),this.el.className=b.join(" ")},bind:function(a,b){this.el&&("addEventListener"in this.el?this.el.addEventListener(a,b,!1):this.el.attachEvent&&this.el.attachEvent("on"+a,b))},html:function(a){this.el.innerHTML=a},remove:function(){this.el&&this.el.parentNode.removeChild(this.el)}}});var leaflet={loadingYandex:0,baseLayerYandex:!1};pg.fTabShowMap_Click=function(a,b){b=="traffic"?(pg.fShowTraffic(!0),pg.mapShowAllStops=-Math.abs(pg.mapShowAllStops)):b=="vehicles"?pg.fToggleVehicles(2):(pg.fShowTraffic(!1),pg.mapShowAllStops=typeof mobile=="xxxundefined"?-Math.abs(pg.mapShowAllStops):Math.abs(pg.mapShowAllStops)),pg.hashForMap=="map"&&b!="mylocation"?pg.fMapShow():(pg.hashForMap="map",b=="mylocation"&&(pg.hashForMap="map,mylocation"),pg.fUrlSet());return pg.cancelEvent(a)},pg.fMapHide=function(){pg.mapShowVehiclesInterval&&(clearInterval(pg.mapShowVehiclesInterval),pg.mapShowVehiclesInterval=0),pg.schedule&&(document.body.className="ScheduleDisplayed"),pg.browserVersion<=7&&($("divContent").innerHTML=$("divContent").innerHTML),jq("body").removeClass("ScheduleMapDisplayed").removeClass("MapDisplayed").removeClass("MapDisplayedMax")},pg.fMapShow=function(a){if(pg.sisp&&pg.GMap){var b=pg.GMap.getContainer();(!pg.schedule||!pg.schedule.stopId)&&b.parentNode.id!="divMapWrapper"&&document.getElementById("divMapWrapper").appendChild(b)}cfg.isMobilePage&&pg.urlPrevious&&pg.urlPrevious.indexOf("map")==-1&&(pg.urlUnderMobileMap=pg.urlPrevious);var c=(a||pg.hashForMap).split(";"),d=c[0].split(","),e;d[d.length-1]=="max"&&(e=!0,d.pop()),d[d.length-1]=="drive"&&(e=!0,d.pop()),d[d.length-1]=="stops"&&d.pop();var f=d[1]||cfg.defaultCity,g,h,i,j;pg.schedule?(e?jq("body").removeClass("ScheduleMapDisplayed").addClass("ScheduleMapDisplayedMax"):jq("body").removeClass("ScheduleMapDisplayedMax").addClass("ScheduleMapDisplayed"),f=pg.schedule.city,g=pg.schedule.transport,h=pg.schedule.num,i=pg.schedule.dirType,j=pg.schedule.stopId):(e?jq("body").removeClass("MapDisplayed").addClass("MapDisplayedMax"):jq("body").removeClass("MapDisplayedMax").addClass("MapDisplayed"),pg.browserVersion<=7&&($("divContent").innerHTML=$("divContent").innerHTML),f=d[1]||cfg.defaultCity,g=d[2]||"",h=d[3]||"",i=d[4]||"",j=d[5]||"");if(pg.GMap){if(typeof ti.stops!=="object"||typeof ti.routes!=="object"||!pg.stopLabelSelected._ready){setTimeout(pg.fMapShow,200);return}var k,l;if(pg.transport=="plan")pg.stopLabelSelected.remove(),pg.fToggleVehicles(-Math.abs(pg.mapShowVehicles));else{pg.fToggleVehicles(pg.mapShowVehicles),j||pg.transport=="stop"&&(j=pg.inputStop,pg.mapShowAllStops=Math.abs(pg.mapShowAllStops));if(j){l=ti.fGetAnyStopDetails(j),pg.schedule?I=pg.fUrlSet({schedule:{stopId:l.id}},!0):I=pg.fUrlSet({transport:"stop",stopId:l.id},!0);if(typeof l.latAvg=="number"&&typeof l.lngAvg=="number"){k=[l.latAvg,l.lngAvg],pg.stopLabelSelected.remove().setLatLng(k).bindTooltip(l.name,{permanent:!0,direction:"right",className:"tooltip-small yellow",offset:[4,0]}).addTo(pg.GMap).openTooltip();if(pg.transport=="stop"&&cfg.defaultCity==="vilnius"&&pg.mapStopForZones!=j&&!cfg.city.goHomeTimeout){pg.mapStopForZones=j;var m=new Date,n=m.getDay()||7,o={start_stops:j,finish_stops:"0;0",date:m,weekday:n,transport:{},walk_max:500,callback2:function(){pg.clusterManager.refresh()}};setTimeout(function(){dijkstra(o,720,1)},100)}}else pg.stopLabelSelected.remove()}else pg.stopLabelSelected.remove()}if(h||pg.transport=="plan"||pg.transport=="home"){if(pg.map.city==f&&pg.map.transport==g&&pg.map.num==h&&pg.map.dirType==i&&!a){k&&!pg.GMap.getBounds().contains(k)&&pg.GMap.panTo(k);return}pg.map.city=f,pg.map.transport=g,pg.map.num=h,pg.map.dirType=i,pg.mapStops={},pg.clusterManager.refresh(),pg.mapMarkerStart.remove(),pg.mapMarkerFinish.remove();while(pg.mapOverlays.length)pg.mapOverlays.pop().remove();var p=999,q=-999,r=999,s=-999,t="",u="";if(pg.transport=="plan"||pg.transport=="home"){if(pg.transport=="home"){var f=cfg.cities[pg.city]||{},v=[f.lat||59.43923,f.lng||24.7588];pg.GMap.setView(v,f.zoom||12)}var w;if(h&&pg.optimalResults&&pg.optimalResults.length){pg.mapShowAllStops==1&&(pg.mapShowAllStops=-1);if(typeof mobile=="undefined"&&cfg.defaultCity=="tallinna-linn"){var x=jQuery(jQuery("#planner .results .option header"));jQuery.each(x,function(a,b){var c=jQuery(b);c.hasClass("active")?a!=h-1&&c.click():a==h-1&&c.click()})}E=h?+h-1:0,E>=pg.optimalResults.length&&(E=0),w=pg.optimalResults[E].legs||[];var y=pg.optimalResults[E];u=i18n.option+" "+(E+1)+".";for(var z=0;z<pg.optimalResults.length;++z){var y=pg.optimalResults[z],A=i18n.option+" "+(z+1)+".&nbsp;&nbsp;"+ti.printTime(y.start_time,null,"&#x2007;")+" &mdash; "+ti.printTime(y.finish_time,null,"&#x2007;")+"&nbsp;("+ti.printTime(y.travel_time,":","duration")+")";t+="<a href=\"#map,,,"+(z+1)+"\"><span class=\"icon icon_narrow"+(z==E?" icon_checked":"")+"\"></span>"+A+"</a>",z==E&&(u=A)}}else{pg.mapShowAllStops=Math.abs(pg.mapShowAllStops);var B=pg.inputStart,C=pg.inputFinish;!B&&(pg.mapCenterTo||{}).type=="start"&&(B=pg.mapCenterTo.id),!C&&(pg.mapCenterTo||{}).type=="finish"&&(C=pg.mapCenterTo.id),w=[{start_stop:ti.fGetAnyStopDetails(B),finish_stop:ti.fGetAnyStopDetails(C)}]}var D;for(var E=0;E<=w.length;++E){var F,l,G,H;E==w.length?(F=w[E-1],l=F.finish_stop,H=F.finish_time,typeof l.lat=="number"&&typeof l.lng=="number"&&(pg.mapMarkerFinish.setLatLng([l.latAvg||l.lat,l.lngAvg||l.lng]),pg.mapMarkerFinish.addTo(pg.GMap),(pg.mapCenterTo||{}).type=="finish"&&(k=pg.mapMarkerFinish.getLatLng()))):(F=w[E],l=F.start_stop,typeof l.lat=="number"&&typeof l.lng=="number"&&(E==0&&(pg.mapMarkerStart.setLatLng([l.latAvg||l.lat,l.lngAvg||l.lng]),pg.mapMarkerStart.addTo(pg.GMap),(pg.mapCenterTo||{}).type=="start"&&(k=pg.mapMarkerStart.getLatLng()))),H=F.start_time);if(!l||!l.id)continue;p>l.lat&&(p=l.lat),r>l.lng&&(r=l.lng),q<l.lat&&(q=l.lat),s<l.lng&&(s=l.lng);var G=F.route||{},I,J=D&&G.num===D.num&&G.transport===D.transport&&G.city===D.city;H=H&&ti.printTime(H)+" "||"",l.id.indexOf(";")<0&&(F.route?I=pg.fUrlSet({schedule:{city:G.city,transport:G.transport,num:G.num,dirType:G.dirType,stopId:l.id,tripNum:(F.trip_num||-1)+1}},!0):l.id?I="stop/"+l.id+"/map":I="map",pg.mapStops[l.id]={lat:l.latAvg||l.lat,lng:l.lngAvg||l.lng,href:I,info:l.info,img:!G.transport&&h&&(E==0||E==w.length)?"stopGray":J?"stop":"stopOnRoute",time:H,name:l.name});if(!h||pg.optimalSearchRunning||!pg.optimalResults||!pg.optimalResults.length)continue;J||l.id.indexOf(";")<0&&E!==w.length&&(G.transport||E==w.length-1)&&(pg.mapStops["transport"+l.id]={lat:l.latAvg||l.lat,lng:l.lngAvg||l.lng,href:I,info:l.info,img:"MarkerStart",time:H,name:i18n.stop.toLowerCase()+"&nbsp;"+l.name,transport:G.transport||"walk",num:G.numHTML||""});if(E<w.length)if(G.transport){var K={};K[G.dirType]=!0;if(F.shape){var M=pg.getStyle("."+G.transport),N=[];for(var O=0;O<F.shape.length;++O)N.push([F.shape[O][0],F.shape[O][1]]);var P=L.polyline(N,{color:M&&(M.backgroundColor||M.color)||"#0000FF",opacity:.8,weight:3}).addTo(pg.GMap);pg.mapOverlays.push(P)}else pg.loadPolyline(G.city,G.transport,G.num,K,F.start_stop.lat,F.start_stop.lng,F.finish_stop.lat,F.finish_stop.lng);D=G;if(!isNaN(F.start_pos)&&!isNaN(F.finish_pos)){var Q=typeof G.times==="string"?ti.explodeTimes(G.times):G.times,R=Q.workdays.length;Q=Q.times;for(var S=F.start_pos;++S<F.finish_pos;){var l=ti.fGetStopDetails(G.stops[S]),I=pg.fUrlSet({schedule:{city:G.city,transport:G.transport,num:G.num,dirType:G.dirType,stopId:l.id,tripNum:(F.trip_num||-1)+1}},!0);pg.mapStops[l.id]={lat:l.lat,lng:l.lng,href:I,img:"stop",name:ti.printTime(Q[F.trip_num+S*R])+" "+l.name}}}}else if(pg.optimalResults){D=null;var N=[];if(F.shape&&F.shape.length&&F.shape.length>1)for(var O=0;O<F.shape.length;++O){var T=ti.ENtoLatLng(F.shape[O][0],F.shape[O][1]);N.push([T[0],T[1]])}else N=[[F.start_stop.lat,F.start_stop.lng],[F.finish_stop.lat,F.finish_stop.lng]];var P=L.polyline(N,{color:"Black",dashArray:"4 8",opacity:.6,weight:3}).addTo(pg.GMap);pg.mapOverlays.push(P)}}}else if(g){pg.mapShowAllStops==1&&(pg.mapShowAllStops=-1);if(pg.mapShowVehicles>0||h&&pg.mapShowVehicles==-1)pg.fToggleVehicles(Math.abs(pg.mapShowVehicles)),pg.fShowVehicles();var U=[{city:f,transport:g,num:h,dir:i}];if(c.length>1)for(var E=1;E<c.length;E++){var d=c[E].split(","),V=d.length>3?d[3]:"";U.push({city:d[0],transport:d[1],num:d[2],dir:V})}U.forEach(function(a){var b=ti.fGetRoutes(a.city,a.transport,a.num,a.dir,!0),d={};if(b.length){var e={},f={};for(var h=b.length;--h>=0;){var j=b[h];for(var m in f)(f[m]||0)<2&&(f[m]=0);for(var n=j.stops.length;--n>=0;){l=ti.fGetStopDetails(j.stops[n]);if(!l.lat||!l.lng)continue;f[l.name]=(f[l.name]||0)+1}}for(var h=b.length,o=0;--h>=0;){var j=b[h];if(j.routeTag&&j.dirType!=i)if(b.length>1&&(o||h>0))continue;cfg.defaultCity=="kaunas"&&h==0&&!i&&(i=j.dirType,d=[],pg.mapStops={}),d[j.dirType]=c.length>1?!0:!i||j.dirType==i;var v="map,"+j.city+","+j.transport+","+j.num+","+j.dirType;v=ti.toAscii(v,!0),t="<a href=\"#"+v+"\"><span class=\"icon icon_narrow"+(j.dirType==i?" icon_checked":"")+"\"></span>"+j.name+"</a>"+t;if(!d[j.dirType])continue;o++;var w=[];for(var n=j.stops.length;--n>=0;){l=ti.fGetStopDetails(j.stops[n]);if(!l.lat||!l.lng)continue;k=[l.lat,l.lng],w.push(k);var x=pg.fUrlSet({schedule:{city:j.city,transport:j.transport,num:j.num,dirType:j.dirType,stopId:l.id}},!0),y=pg.mapStops[l.id]={lat:l.lat,lng:l.lng,href:x,img:"stopOnRoute"+(!i&&h?"2":""),name:l.name,hidden:!0};f[l.name]>=2&&(y.name+=" ("+l.street+")"),e[y.name]=l.id,p>l.lat&&(p=l.lat),r>l.lng&&(r=l.lng),q<l.lat&&(q=l.lat),s<l.lng&&(s=l.lng),(h==0||i)&&(n==0||n==j.stops.length-1)&&(pg.mapStops[n==0?"MarkerStart":"MarkerFinish"]={lat:l.lat,lng:l.lng,href:x,img:n==0?"MarkerStart":"MarkerRed",transport:g,num:j.numHTML,name:(n==0?i18n.stop.toLowerCase()+"&nbsp;":"")+l.name})}if(cfg.defaultCity==="latvia"&&j.stops){var z="http://routelatvia.azurewebsites.net/?shape="+j.stops.join(",");z="http://www.stops.lt/latviatest/proxy.php?url="+encodeURIComponent(z),ti.fDownloadUrl("get",z,function(a){var b=JSON.parse(a);b.contents&&(b=b.contents),b=b.split(",");var c=[];for(var d=0;d<b.length;d+=2){var e=new GLatLng(parseFloat(b[d]),parseFloat(b[d+1]));c.push(e)}if(c.length>1){var f=pg.getStyle("."+g),h=d>0?.6:.8,i=f&&f.backgroundColor||"#0000FF",j=5,k=new GPolyline(c,i,j,h);pg.GMap.addOverlay(k),pg.mapOverlays.push(k)}},!0)}}for(var m in e)(pg.mapStops[e[m]]||{}).hidden=!1;b.length>1&&cfg.defaultCity!="kaunas"&&(v="map,"+j.city+","+j.transport+","+j.num,t="<a href=\"#"+v+"\"><span class=\"icon icon_narrow"+(i?"":" icon_checked")+"\"></span>"+i18n.mapShowAllDirections+"</a>"+t);var A=pg.getStyle("transport_icon_"+a.transport);u="<img class=\"icon icon_narrow\" src=\""+A+"\"/><span class=\"transfer"+a.transport+"\">&nbsp;"+b[0].numHTML+"</span>";if(cfg.defaultCity!=="latvia")if(cfg.defaultCity==="helsinki"){var B=pg.getStyle("."+g),C=h>0?.6:.8,D=B&&B.backgroundColor||"#0000FF",E=5,F=new GPolyline(w,D,E,C);pg.GMap.addOverlay(F),pg.mapOverlays.push(F)}else pg.loadPolyline(a.city,a.transport,a.num,d)}})}pg.$mapRoutesDropdown&&(t?(t="<div id=\"mapDropDownHeader\" style=\"float:left;\"><a href=\"#\" aria-haspopup=\"true\"><span class=\"arrow-down\"></span>&nbsp;"+u+"<span id=\"mapRemoveRoute\"></span><!--[if gte IE 7]><!--></a><!--<![endif]--><div id=\"mapDropDownContent\" class=\"dropdown2\">"+t+"<a id=\"mapShowStopsNames\" href=\"#map\" style=\"border-top:solid 1px #CCCCCC; margin-top:3px;\"><span class=\"icon icon_narrow stopsnames"+(pg.mapShowStopsNames?" icon_checked":"")+"\"></span>"+i18n.mapShowRouteStopsNames+"</a>"+(pg.schedule&&typeof mobile=="undefined"?"":"<a id=\"mapRemoveRoute2\" href=\"#map\"><span class=\"icon icon_narrow\"></span>"+i18n.mapClearRoute+"</a>")+"</div><!--[if lte IE 6]></a><![endif]--></div>",pg.$mapRoutesDropdown.innerHTML=t,pg.$mapRoutesDropdown.style.display="",resizeDropDown()):pg.$mapRoutesDropdown.style.display="none");var W;h&&(pg.mapShowAllStops==1?pg.mapShowAllStops=-1:pg.clusterManager.hideMarkers(),W=function(){if(p==q&&r==s)pg.GMap.panTo([p,r]);else{var a=L.latLngBounds([p,r],[q,s]);pg.map_popup.isOpen()&&pg.GMap.getBounds().intersects(a)?pg.clusterManager.refresh():(pg.GMap.fitBounds(a),pg.clusterManager.refresh())}})}if(!h){pg.$mapRoutesDropdown&&(pg.$mapRoutesDropdown.style.display="none"),pg.transport!=="plan"&&pg.transport!=="home"&&(pg.mapMarkerStart.remove(),pg.mapMarkerFinish.remove(),pg.mapStops={});while(pg.mapOverlays.length)pg.mapOverlays.pop().remove();pg.map={},pg.clusterManager.draw(),j&&l&&l.id&&typeof l.lat=="number"&&typeof l.lng=="number"?(pg.mapStops[j]={lat:l.latAvg,lng:l.lngAvg,href:"stop/"+j,info:l.info,img:"stopOnRoute",name:l.name},k=[l.lat,l.lng]):pg.mapCenterTo||(k=null),k?window.setTimeout(function(){pg.GMap.panTo(k,{animate:!0,duration:.5,easeLinearity:1})},300):pg.clusterManager.refresh()}pg.mapCenterTo="",setTimeout(function(){pg.GMap.invalidateSize(),typeof W=="function"&&W()},300)}else pg.GMap===null?(pg.GMap=!1,$("divMap").innerHTML="<div id=\"loading-map\" style=\"margin:10px;\">"+i18n.loadingMap+"</div>",pg.loadGoogleMapsScript(pg.GMapScriptLoadedMap)):pg.GMap!==!1&&pg.GMapScriptLoadedMap()},pg.loadGoogleMapsScript=function(a,b){pg.loadLeafletScript(a)},pg.loadLeafletScript=function(a){var b="leaflet-css";if(!document.getElementById(b)){var c=document.createElement("link");c.id=b,c.rel="stylesheet",c.type="text/css",c.href=location.hostname=="xxxlocalhost"?"JS/leaflet/leaflet.css":location.protocol.indexOf("http")>=0?"//www.stops.lt/vilnius/leaflet.css":"leaflet.css",c.media="all",document.head.appendChild(c),(document.getElementById("divMapHide")||{style:{}}).style.zIndex=1999,(document.getElementById("divMapMaximize")||{style:{}}).style.zIndex=1999,(document.getElementById("divMapRestore")||{style:{}}).style.zIndex=1999;var d=document.createElement("style");d.type="text/css",d.innerHTML=["#divMapHide,#divMapMaximize,#divMapRestore{ position:absolute; top:2px; width:19px; height:19px; cursor:pointer; z-index:1999;}",".station { padding:1px; line-height:12px; }",".wifi { padding:0px; background-color:transparent; border:0px; box-shadow:none; margin:0; }",".wifi:before { content:none; }",".mapMenu { display:block; top: auto; position:relative; }",".mapMenu .content { border:0px; margin:0px; padding:0px; }",".label_transport { display:flex; }",".tooltip-small { padding: 0 5px 0 5px;}",".yellow { background-color:yellow; }","#divNav a#aShowTraffic { display:none; }",".mapMenu .content { max-width:250px; }",".leaflet-tooltip:hover { z-index:1000;}",".mapMenu ymaps>a {height: 14px; bottom:0;}"].join(""),document.head.appendChild(d)}var e="leaflet-js";if(document.getElementById(e))jq("#loading-map").remove(),a();else{var f=document.createElement("script");f.id=e,f.onload=function(){jq("#loading-map").remove(),a()},f.src=location.hostname=="localhost"?"leaflet.js":location.protocol.indexOf("http")>=0?"//www.stops.lt/vilnius/leaflet.js":"leaflet.js",document.head.appendChild(f)}},pg.loadYandexPlugin=function(){L.Yandex=L.Layer.extend({options:{type:"yandex#map",mapOptions:{balloonAutoPan:!1,suppressMapOpenBlock:!0},overlayOpacity:.8,minZoom:0,maxZoom:19},initialize:function(a,b){typeof a==="object"&&(b=a,a=!1),b=L.Util.setOptions(this,b),a&&(b.type=a),this._isOverlay=b.type.indexOf("overlay")!==-1||b.type.indexOf("skeleton")!==-1,this._animatedElements=[]},_setStyle:function(a,b){for(var c in b)a.style[c]=b[c]},_initContainer:function(a){var b=this._isOverlay?"leaflet-overlay-pane":"leaflet-tile-pane",c=L.DomUtil.create("div","leaflet-yandex-container leaflet-pane "+b),d=this.options.opacity||this._isOverlay&&this.options.overlayOpacity;d&&L.DomUtil.setOpacity(c,d);var e={width:"100%",height:"100%"};this._setStyle(a,e),this._setStyle(c,e);return c},onAdd:function(a){var b=this;pg.loadYandexScript(function(){leaflet.baseLayerYandex=!0;var c=a.getPane("mapPane");b._container||(b._container=b._initContainer(c),a.once("unload",b._destroy,b),b._initApi()),c.appendChild(b._container);b._yandex&&(b._setEvents(a),b._update())})},beforeAdd:function(a){a._addZoomLimit(this)},onRemove:function(a){leaflet.baseLayerYandex=!1,a._removeZoomLimit(this)},_destroy:function(a){if(!this._map||this._map===a.target)this._yandex&&(this._yandex.destroy(),delete this._yandex),delete this._container},_setEvents:function(a){var b={move:this._update};this._zoomAnimated&&(b.zoomanim=this._animateZoom,b.zoomend=this._animateZoomEnd),a.on(b,this),this.once("remove",function(){a.off(b,this),typeof this._container.remove=="function"?this._container.remove():this._container.parentNode.removeChild(this._container)},this)},_update:function(){var a=this._map,b=a.getCenter();this._yandex.setCenter([b.lat,b.lng],a.getZoom());var c=L.point(0,0).subtract(L.DomUtil.getPosition(a.getPane("mapPane")));L.DomUtil.setPosition(this._container,c)},_resyncView:function(){if(this._map){var a=this._yandex;this._map.setView(a.getCenter(),a.getZoom(),{animate:!1})}},_animateZoom:function(a){var b=this._map,c=b.getSize()._divideBy(2),d=b.project(a.center,a.zoom)._subtract(c)._round(),e=b.project(b.getBounds().getNorthWest(),a.zoom)._subtract(d),f=b.getZoomScale(a.zoom);this._animatedElements.length=0,this._yandex.panes._array.forEach(function(a){if(a.pane instanceof ymaps.pane.MovablePane){var b=a.pane.getElement();L.DomUtil.addClass(b,"leaflet-zoom-animated"),L.DomUtil.setTransform(b,e,f),this._animatedElements.push(b)}},this)},_animateZoomEnd:function(){this._animatedElements.forEach(function(a){L.DomUtil.setTransform(a,0,1)}),this._animatedElements.length=0},_initApi:function(){ymaps.ready(this._initMapObject,this)},_mapType:function(){var a=this.options.type;if(!a||a.indexOf("#")!==-1)return a;return"yandex#"+a},_initMapObject:function(){ymaps.mapType.storage.add("yandex#overlay",new ymaps.MapType("overlay",[])),ymaps.mapType.storage.add("yandex#skeleton",new ymaps.MapType("skeleton",["yandex#skeleton"])),ymaps.mapType.storage.add("yandex#map~vector",new ymaps.MapType("map~vector",["yandex#map~vector"]));var a=new ymaps.Map(this._container,{center:[0,0],zoom:0,behaviors:[],controls:[],type:this._mapType()},this.options.mapOptions);this._isOverlay&&(a.container.getElement().style.background="transparent"),typeof this._container.remove=="function"?this._container.remove():this._container.parentNode.removeChild(this._container),this._yandex=a,this._map&&this.onAdd(this._map),this.fire("load")}});function a(){var a=new ymaps.traffic.provider.Actual({},{infoLayerShown:!0});a.setMap(this._yandex)}L.yandex=function(b){var c=new L.Yandex(b);b.traffic&&c.on("load",a);return c}},pg.loadYandexScript=function(a){var b=cfg.city.yandexAPIkey||cfg.yandexAPIkey||"fd2746d9-dd29-4e30-a38a-a0d53590c8a1";if(leaflet.loadingYandex==1)window.setTimeout(function(){loadYandexScript(a)},100);else{if(leaflet.loadingYandex==2){a();return}leaflet.loadingYandex=1;var c="yandex-js";if(!document.getElementById(c)){var d=document.createElement("script");d.id=c,d.onload=function(){ymaps.ready(function(){leaflet.loadingYandex=2,a()})},d.src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey="+b,document.head.appendChild(d)}}},pg.loadHerePlugin=function(){L.TileLayer.HERE=L.TileLayer.extend({options:{subdomains:"1234",minZoom:2,maxZoom:18,scheme:"normal.day",resource:"maptile",resource2:"maptile",mapId:"newest",format:"png8",appId:"",appCode:""},initialize:function a(a){a=L.setOptions(this,a);var b=a.scheme.split(".")[0];a.tileResolution=256,L.Browser.retina&&(a.tileResolution=512);var c="/{resource}/2.1/{resource2}/{mapId}/{scheme}/{z}/{x}/{y}/{tileResolution}/{format}?app_id={appId}&app_code={appCode}",d="/maptile/2.1/copyright/{mapId}?app_id={appId}&app_code={appCode}",e="base.maps.api.here.com";if(b=="satellite"||b=="terrain"||b=="hybrid")e="aerial.maps.api.here.com";a.scheme.indexOf(".traffic.")!==-1&&(e="traffic.maps.api.here.com",a.resource2="traffictile");var f="https://{s}."+e+c;b!="satellite"&&b!="hybrid"&&(f+="&ppi=320");if(pg.language=="ru"||pg.language=="by"||pg.language=="ua")f+="&lg=rus";this._attributionUrl=L.Util.template("https://1."+e+d,this.options),L.TileLayer.prototype.initialize.call(this,f,a),this._attributionText=""},onAdd:function b(a){L.TileLayer.prototype.onAdd.call(this,a),this._attributionBBoxes||this._fetchAttributionBBoxes()},onRemove:function c(a){L.TileLayer.prototype.onRemove.call(this,a),this._map.attributionControl.removeAttribution(this._attributionText),this._attributionText="",this._map.off("moveend zoomend resetview",this._findCopyrightBBox,this)},_fetchAttributionBBoxes:function d(){var a=new XMLHttpRequest;a.onreadystatechange=L.bind(function(){a.readyState==4&&a.status==200&&this._parseAttributionBBoxes(JSON.parse(a.responseText))},this),a.open("GET",this._attributionUrl,!0),a.send()},_parseAttributionBBoxes:function e(a){if(this._map){var b=a[this.options.scheme.split(".")[0]]||a.normal;for(var c=0;c<b.length;c++)if(b[c].boxes)for(var d=0;d<b[c].boxes.length;d++){var e=b[c].boxes[d];b[c].boxes[d]=L.latLngBounds([[e[0],e[1]],[e[2],e[3]]])}this._map.on("moveend zoomend resetview",this._findCopyrightBBox,this),this._attributionProviders=b,this._findCopyrightBBox()}},_findCopyrightBBox:function f(){if(this._map){var a=this._attributionProviders,b=[],c=this._map.getZoom(),d=this._map.getBounds();for(var e=0;e<a.length;e++){if(a[e].minLevel<c&&a[e].maxLevel>c)if(!a[e].boxes){b.push(a[e]);break}for(var f=0;f<a[e].boxes.length;f++){var g=a[e].boxes[f];if(d.overlaps(g)){b.push(a[e]);break}}}var h=["<a href=\"https://legal.here.com/terms/serviceterms/gb/\">HERE maps</a>"];for(var e=0;e<b.length;e++){var i=b[e];h.push("<abbr title=\""+i.alt+"\">"+i.label+"</abbr>")}var j="&copy "+h.join(", ")+". ";j!==this._attributionText&&(this._map.attributionControl.removeAttribution(this._attributionText),this._map.attributionControl.addAttribution(this._attributionText=j))}}}),L.tileLayer.here=function(a){a.appId=cfg.city.hereAppId||cfg.hereAppId,a.appCode=cfg.city.hereAppCode||cfg.hereAppCode;return new L.TileLayer.HERE(a)}},pg.GMapScriptLoadedMap=function(){if(typeof L=="undefined"){console.log("Sorry, the Leaflet map failed to load!");return!1}if(typeof ti.stops!=="object"||typeof ti.routes!=="object")setTimeout(pg.GMapScriptLoadedMap,200);else{pg.addCSS("#divMap .leaflet-control-zoom, #divMap .leaflet-control-layers { margin-right: 0; }"),pg.addCSS("#divMap .leaflet-control-layers-toggle { width: 30px; height: 30px; }"),pg.loadYandexPlugin(),pg.loadHerePlugin(),pg.storeStyles(),pg.GMap=0;if((document.body.className||"").indexOf("Map")<0)return;var a,b=cfg.cities[pg.city]||{};b.streetMap=b.streetMap||"GMaps";var c=pg.urlLoaded.indexOf("mylocation")!=-1&&gps?[gps.lat,gps.lng]:[b.lat||59.43923,b.lng||24.7588];console.log("leaflet dragging",!cfg.mapDraggingDisabled);var d=pg.GMap=L.map("divMap",{dragging:!cfg.mapDraggingDisabled,minZoom:pg.city=="mariupol"?b.zoom-1:null,maxBounds:pg.city=="mariupol"?[[47.52,37.8],[46.7,36.46]]:null,maxBoundsViscosity:1,zoomControl:!1,renderer:L.canvas({padding:1})}).setView(c,b.zoom||12);(new L.Control.Zoom({position:"bottomright"})).addTo(d),(new L.Control.Scale({position:"bottomleft",imperial:!1})).addTo(d);var e={attribution:"&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors"},f=b.map_tile_url,g="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",h={};(f||"").indexOf("here")>0?h["HERE map"]=L.tileLayer.here({scheme:"normal.day"}).addTo(d):f?h.OSM=L.tileLayer(f,e).addTo(d):cfg.defaultLanguage=="ru"?h["Yandex map"]=L.yandex({type:"map"}).addTo(d):h.OSM=L.tileLayer(g,e).addTo(d),cfg.defaultLanguage=="ru"?(h["Yandex map"]||(h["Yandex map"]=L.yandex({type:"map"})),h["Yandex traffic"]=L.yandex({type:"map",traffic:!0}),h["Yandex satellite"]=L.yandex({type:"satellite"}),h["Yandex hybrid"]=L.yandex({type:"hybrid"}),d.attributionControl.setPrefix(""),pg.addCSS("#divMap .leaflet-control-zoom {margin-bottom:30px;}")):(h["HERE map"]=L.tileLayer.here({scheme:"normal.day"}),h["HERE traffic"]=L.tileLayer.here({scheme:"normal.traffic.day"}),h["HERE satellite"]=L.tileLayer.here({scheme:"satellite.day"}),h["HERE hybrid"]=L.tileLayer.here({scheme:"hybrid.day"})),h.OSM||(h.OSM=L.tileLayer(g,e));var j={},k=L.control.layers(h,j,{position:"bottomright"});k.addTo(d),L.DomEvent.off(k._container,{mouseenter:k.expand,mouseleave:k.collapse},k);if(b.streetMap!="OSMlocal"){var l;cfg.isMobilePage&&(pg.mapShowVehicles=2)}typeof mobile!="undefined"&&(pg.$mapClose=document.createElement("div"),pg.$mapClose.id="divMapHide",pg.$mapClose.className="map_hide",pg.$mapClose.style.left="5px",pg.$mapClose.style.top="5px",pg.$mapClose.style.zIndex="1999",pg.$mapClose.innerHTML=["<a onclick=\"return true;\" alt=\"",i18n.btnBack,"\" title=\"",i18n.btnBack,"\" class=\"btn btn-back pull-left\"></a>"].join(""),d.getContainer().appendChild(pg.$mapClose),L.DomEvent.disableClickPropagation(pg.$mapClose),L.DomEvent.disableScrollPropagation(pg.$mapClose),jq(pg.$mapClose).bind("click",function(a){pg.divMapHide_Click(a)}));var m=typeof mobile!="undefined"||location.host.indexOf("riga")>=0?55:55,n=48;cfg.defaultCity=="adazi"&&(pg.addCSS("#mapLegend{ position:absolute; bottom:0; left:50%; margin-left:-80px; height:20px; padding:4px; z-index:1000; background-color:white; text-transform: lowercase;}"),pg.$mapLegend=document.createElement("div"),pg.$mapLegend.id="mapLegend",pg.$mapLegend.className="leaflet-bar",pg.$mapLegend.style.display="none",pg.$mapLegend.innerHTML="<div class=\"circle\" style=\"background-color:#F58220; position:relative; float:left; cursor:default;\"></div><div style=\"position:relative; float:left; padding-right:4px;\">&nbsp;-&nbsp;"+i18n.transport1.minibus+"</div><div class=\"circle\" style=\"background-color:#0073ac; position:relative; float:left; cursor:default;\"></div><div style=\"position:relative; float:left;\">&nbsp;-&nbsp;"+i18n.transport1.bus+"</div>",d.getContainer().appendChild(pg.$mapLegend));if(!document.getElementById("divMapHide")){var o=document.createElement("div");o.id="divMapHide",jq(o).bind("click",function(a){pg.divMapHide_Click(a)}),d.getContainer().appendChild(o);var p=document.createElement("div");p.id="divMapMaximize",jq(p).bind("click",function(a){pg.divMapMaximize_Click(a)}),d.getContainer().appendChild(p);var q=document.createElement("div");q.id="divMapRestore",jq(q).bind("click",function(a){pg.divMapRestore_Click(a)}),d.getContainer().appendChild(q)}pg.$mapRoutesDropdown=document.createElement("div"),pg.$mapRoutesDropdown.id="mapDropDown",pg.$mapRoutesDropdown.className="dropdown",pg.$mapRoutesDropdown.style.display="none",d.getContainer().appendChild(pg.$mapRoutesDropdown),jq(pg.$mapRoutesDropdown).bind("click",function(a){a||(a=window.event);var b=a&&(a.target||a.srcElement);if(b.id=="mapShowStopsNames"){pg.mapShowStopsNames=!pg.mapShowStopsNames;var c=pg.$mapRoutesDropdown.innerHTML.replace("stopsnames icon_checked","stopsnames");pg.$mapRoutesDropdown.innerHTML=pg.mapShowStopsNames?c.replace("stopsnames","stopsnames icon_checked"):c,pg.clusterManager.refresh();return pg.cancelEvent(a)}});if(!1||pg.sisp)pg.$mapShowLocation=document.createElement("div"),pg.$mapShowLocation.id="divMapShowLocation",pg.$mapShowLocation.style.right="1px",pg.$mapShowLocation.style.top="6px",pg.$mapShowLocation.style.zIndex=1998,pg.$mapShowLocation.className="map_button",pg.$mapShowLocation.innerHTML="<div id=\"mapShowLocation\" class=\"map_button_icon\" title=\""+(i18n.mapShowLocation||"Nustatyti buvimo vietą")+"\"></div>",d.getContainer().appendChild(pg.$mapShowLocation),L.DomEvent.disableClickPropagation(pg.$mapShowLocation),L.DomEvent.disableScrollPropagation(pg.$mapShowLocation),jq(pg.$mapShowLocation).bind("click",function(a){pg.getLocation(this)});pg.$mapShowAllStops=document.createElement("div"),pg.$mapShowAllStops.id="divMapShowAllStops",pg.$mapShowAllStops.style.right="0",pg.$mapShowAllStops.style.top=m+"px",m+=n,pg.$mapShowAllStops.className="map_button",pg.$mapShowAllStops.innerHTML="<div id=\"mapShowAllStops\" class=\"map_button_icon\" title=\""+i18n.mapShowAllStops+"\"></div>",d.getContainer().appendChild(pg.$mapShowAllStops),L.DomEvent.disableClickPropagation(pg.$mapShowAllStops),L.DomEvent.disableScrollPropagation(pg.$mapShowAllStops),jq(pg.$mapShowAllStops).bind("click",function(a){pg.mapShowAllStops=pg.mapShowAllStops>0?-2:2,pg.clusterManager.refresh()}),typeof pg.mapShowAllStops=="undefined"&&(pg.mapShowAllStops=-1),cfg.city.showWifiStops&&(pg.$mapShowWifiStops=document.createElement("div"),pg.$mapShowWifiStops.id="divMapShowWifiStops",pg.$mapShowWifiStops.style.right="0",pg.$mapShowWifiStops.style.top=m+"px",m+=n,pg.$mapShowWifiStops.className="map_button",pg.$mapShowWifiStops.innerHTML="<div id=\"mapShowWifiStops\" class=\"map_button_icon\" title=\""+i18n.mapShowWifiStops+"\"></div>",d.getContainer().appendChild(pg.$mapShowWifiStops),L.DomEvent.disableClickPropagation(pg.$mapShowWifiStops),L.DomEvent.disableScrollPropagation(pg.$mapShowWifiStops),pg.mapShowWifiStops=!1,jq(pg.$mapShowWifiStops).bind("click",function(a){pg.mapShowWifiStops=!pg.mapShowWifiStops,pg.clusterManager.refresh()})),cfg.city.bicycles&&(pg.$mapShowBicyclesRent=document.createElement("div"),pg.$mapShowBicyclesRent.id="divMapShowBicyclesRent",pg.$mapShowBicyclesRent.style.right="0",pg.$mapShowBicyclesRent.style.top=m+"px",m+=n,pg.$mapShowBicyclesRent.className="map_button",pg.$mapShowBicyclesRent.innerHTML="<div id=\"mapShowBicyclesRent\" class=\"map_button_icon\" title=\""+i18n.mapShowBicyclesRent+"\"></div>",d.getContainer().appendChild(pg.$mapShowBicyclesRent),L.DomEvent.disableClickPropagation(pg.$mapShowBicyclesRent),L.DomEvent.disableScrollPropagation(pg.$mapShowBicyclesRent),pg.mapShowBicyclesRent=!1,jq(pg.$mapShowBicyclesRent).bind("click",function(a){pg.mapShowBicyclesRent=!pg.mapShowBicyclesRent,pg.clusterManager.refresh()})),b.streetMap!="OSMlocal"&&(cfg.city.urlGPS&&(pg.$mapShowVehicles=document.createElement("div"),pg.$mapShowVehicles.id="divMapShowVehicles",pg.$mapShowVehicles.style.right="0",pg.$mapShowVehicles.style.top=m+"px",m+=n,pg.$mapShowVehicles.className="map_button",pg.$mapShowVehicles.innerHTML="<div id=\"mapShowVehicles\" class=\"map_button_icon\" title=\""+i18n.mapShowVehicles+"\"></div>",d.getContainer().appendChild(pg.$mapShowVehicles),L.DomEvent.disableClickPropagation(pg.$mapShowVehicles),L.DomEvent.disableScrollPropagation(pg.$mapShowVehicles),jq(pg.$mapShowVehicles).bind("click",function(a){pg.mapShowVehicles>0?(pg.mapShowCoolVehicles=!1,pg.mapShowWifiVehicles=!1,pg.mapShowUsbVehicles=!1,pg.hashForMap=="map"?pg.fToggleVehicles(-1):pg.fToggleVehicles(0)):pg.hashForMap=="map"?pg.fToggleVehicles(2):pg.fToggleVehicles(1)})),cfg.defaultCity=="vilnius"&&!pg.sisp&&(pg.$mapShowCoolVehicles=document.createElement("div"),pg.$mapShowCoolVehicles.id="divMapShowCoolVehicles",pg.$mapShowCoolVehicles.style.right="0",pg.$mapShowCoolVehicles.style.top=m+"px",m+=n,pg.$mapShowCoolVehicles.className="map_button",pg.$mapShowCoolVehicles.innerHTML="<div id=\"mapShowCoolVehicles\" class=\"map_button_icon\" title=\""+i18n.mapShowCoolVehicles+"\" style=\"background-size: 20px 20px; background-position: 5px 5px; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAABXCAYAAABxyNlsAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxMAAAsTAQCanBgAAA7ySURBVHhe7ZwJlBxFGcdDAI0iQjw4vFA8kUREUHxeoBgFiQIKMQGC4kEgEhU8QIJyeAEGEEGQIyKBxDWIBA8eRBBCJHKpD5PII8ipIohXBBVRwd+vMz3OzlTPVM927czK/t/7v57pna7jq6qvvqN6x4xiFCMSa9WufYkpU/fagMtFcKvsxmDcBHdfOLBg9Zqv/YextWu/wsFXwE8J0Pt9PTn6XbgjGqPCTYhR4SbEsAuXTaonA9qLenvR0U3o6OFwI1i7lQaWD8fDD/P15WvuDh96IdzHw8/DS+AUOr6+N6sG5T6By87we/BkuCEcVvRkidawDTwfzkcQ28F1s7tDBOWsA7WLz4HayK/1fi/QS+EKBfp2+EM4B6FsBrtqE8+tBZ/Bx2Pg5fDd0FXSM/RauDlUDerFa+AshLQ+9H4U+O0TubwHXgk/BZ8Ge45KhUsnN4frlhFME54Jvwyvgs7oTu0bS13bc10M58IXebMbUM7a0PorQ9Uz143jYrh19q17vAIughfCjbwRwFPh16EqRb3adV8Q6ou5qP+/lt2oCFUL1/LcoZfS4FOhOrBbWNYO8FnZt1ZsBneFXW+EtE9zUMvlOjgVViqPqoWbYz04E95A4w+G6sQcd0E78qvsW3r8Gh4Ar86+AdozDu7HR3X8YdAgUOVIJVxhxMqZezxcTGee7M2FAwsegd/i46vh0fD33k+Av8IT4KvgmdT5b2/W2qHtqwp4AUwmg5TCzbEOVKc9KftWA539IxfNJpf+PPg3WAUeht+BO8JDqede+Kh/qMF26K09LvuWEMMh3ELQaWfxzXycAd8JNaX+BbvBI/BaqMqZTrk3wv/4h16hrXBZQuvBveBzareSACE8BDWn3gVnQQVeBrfDQ+GulHMR/Ht2NxGQx6ZwOtRiKUSnmTsZng0vo6ADYBLFnwOh/JnLmVCL4zh4H2yHv8BT4NvgiTyfSn9noP9ONleGcZGz4FS+F2ZDCoXLQ9qXH4cGQF4C7cQi7k+CyfQVAnoUalHMhrvDu70fwG+hLu4h/P4WqFpIAvqrg6EtvRB+A6qzda31Kp8PgwgKl4IcjQ9CjfkcbkxuPhr3c/nNFjCZzkZY6kvVwx+yG61wVl/P7zIrIAXon9ycjydBZ6srpDFe8UJ4IL9Ze83XwSgSjjNV4Yb+rs26D/wRPIKCNcT7OlFYFjWhqk8/At1k3QcyU7IJ9ns63Db71oQW4dUE9VGoB9QOm0DtVN3PPXlOx2HEg36oBt1rfgCNc3TazJ8OZ/Nci6oMzUynuBuLbLQPi/Ay+E1oHOB53hjBUJDa3NrJ23kjAg/C38CW8GaLcNVhUJdwEvw+jNFplvNWuEX2beRiAtwDxsQr3BNUGZOR10z4QHa3AaGZm4Ef/5SLhr2VrfDeKOq4DRo/3hk5LcnuBFAoXMGDzmJDiK+E6uH7vf8YhkenjoLbIJf58J/Z3QK0FW4OCnmIy1egualTof57GajsjS/0Awxhlg1TqgK0b837HYM8os6nlTah2BXd8KxES0E9G1uGUSobOIfGGQbsCOoyY3sFbLS3c/wM7khZemkdQVmaVofAA6HlxrbbsKQOzTLqKhX3iJq5jaACR/F6qD52Nsd6RtqJ2ovL6OhMOChKlgrUY+z2vXw0IG5+bTyMEayW0gK4E1xSVrCitHBpqBdNLm1AG12mDDvlsjQddAVlTYaVpNSbQbm6rG/ioxaPsVvd1DIr1d+a6TgD6o2WeTZDKeFSgUvrY1DvbH/YbSBHV9og9gCcR7lbw9IDHYJCgJqEp0Ntb+O63abYdYycTbk3uqk3YxH0iZtBoeO2nDDRUTwN7gs9H1sF3Oi0LXeDG1LHbStXLK9vFnwfx0WTJ9Sp38F5/N7NNgPtNNikVXMidNb6fBVQhRlX2Yk2PQBvp96Om3rbqU5j883rE9CgRWMurB307jSwtRBeCmOWlDrul9AgyYVuVNQftaHxO2eYLqtRPH8buwqMA1uO6Xnd2BhoftmmL8Fr2uniYKdprPeNLZjYez+MPWRhxRrVX4Tuss44swyWsTGMgY01mXgsXA6NRhUJV2vFswp6lG+BscvfFJOblRvyHdDAyyeh5cXGSFxhuv3uH6sQcsvG3iJcBOvsdOm7vGJtUws2POhoOuv0tzPUBkr72EzBO2Ds7NedNHhiIvO53miCXpKDoLqKVVOqEA+cmLszXFlPA9FOB2YXeDi0ve4LMXBwVJdnUd4g+zck3Dxja6A6RhBG/908TqPwwkwA5apiNGv0cAw2xza+CuSDr1Avpp2FnhXt1FQz7e7k0rIJru4GOGBueLMoVzVTR/BBKrDjplo+DT09ExLEP6CB88/Bmyk4JoJm2Q6YsWL1owNZiZVQANuky/5VeBJtbAmuFIF2ulpcbcZrQ6oiD+Z7qGQRZdc31hxtR4UKLPR9UJ2m/vT3Rsl+Dq34qlihNoOynRVulM6SFGd0TVJeAHVXB82oWNBGL4YevwBfD7XJ7a86243X1VroIXaa8hmoxBmmws8SgfAcCm0btIgFZbuZfBYa4owyDTvAGbUMHkkbtViGDNpou6bAI+FP4NGUfSfXtogSbmrUGu9m4hLT7u0Wbi4KYIDOd3v+oTL0hXBFbQkaf3Dn3dsvJWG6yefuR7DZjV4j5WZSFrqsCtaAUDfQg/KMrrHnvkCsztUG3BO6dE9hZqjTKgFl67IeBHVYdFaGsprcbPQO50NDm0VnHkqDdk7kYlzF6Np5lF235YvQtiM1Xfg6qGGti6iQ3R31TDwRc1e3S5CyNckcMDdKnZUqNrMc2rUeLHHzPZc2RptgjaCNXtzMDZV+ABq40lq6AWqCXk7Z5dxfQcF22OCyp1pC0S8br/s4lwqiIvM5KPsNXNx4PMXSbcQqBnbcXKCCuJR21j2yTqCNmqEOvhPLcGWzCnXADGfqld5E2VHurx6K4URjAhrS7Wa3jb0RagcupoIWQzoH5VqOcQAHzPNWoUMWqeDxVM/kGvNYTjsLbXPaqS3rKjX78BrY6ejWPdDXsk6m3EE5xpaluOWEiY6Ym4obgwck2sHR1BnQv5/Is3fA+1auWD6o8TRYvepguWEZCoyZrQ6cgRvrCHlIhhz1kCy7k0rJQ5u69ONp4y3wQdrp3zLQxrHcM4LnLNdNjlVV/sZza0soz1RWHcFZWRs9PRLTIl5jl67nt8yTGflXbeRvMerhxYYCHRjtVcvQvTagXhQVU1iWbxzAVRFr/ShVT53rtq6mv+pVsyrm15wsMVDlmO5SLVwWWrXtlrxC1i31zKy7pKMa23jjsudCsw1aGLFBazdL36rRIllF/bHx3GfzWYtDATmTY6BwDI9eCrWPDSa1lUcNDr4ROfeb86lf6ySImMIUsrFYj0uWicuWQR4KzOLANDjbeGKF6xd+a1/yuKyzOaRKhgoF6aRx8DvGK6JmIgW53I+Ab4baXlWd3FaI6k3NnN2o5+pcsGXBc57r1UTSfpoG3WirOl5qHMUN0WC654GjAkFRM7cRzBAHxEqMyzqjuonLurSMLBnFP53G+rkFZWZuM3hWa8SVdjCMicuG4ECvgoZe1c+lBr6bCjPQeDcrd1Y3k1hdLNR1blJHdZoBQxFuDspwszI86mZVJo3vBDgPHkQdXTkhZYRSBw3Wu/oMtMGxZdhY37ZRIPt2EmxVoJ57oIeYjcv6NnuLsV8AJ57q5Xj62/bFkiKUmrlU4sgbmdcOLPMSslkLLQ7zTNF6sIqZ2wzKND+ovV1mw8vfmTub+qL3m6hZR4N8O9yokwlB32Ip+3a3HtJ3ywg2IZy9DnYZOHPNPFyLHHaBUeqlo3ApyFCg7p0pbjOxXakSoFoYybDfRsY8xTOAXLaFbWVR+Ece9EUSgyuOtKqgkyv8WIHeqp6hzsexyEgHJogW4fJj/0eMb+sY2dcEcbeN0c2+hW4QYyTDo62/WPOxLZRH/dwc8poBWyZfaOb6oEf1fZEkJnChstdPN8EY07B+hq8nmIR1UnV6e1MoP998131umYAtwmXT0Q5Vef8pu1EMXVb/+5GNOYznzIbGmjn9Cr08I1yGUD0eFfM2vX/3TESLFVGkc03jaOiHNiEF6LkF3cy9KTTpW4y9AP3xbXpXoW654VfT6UV9dKOXLQgKl4Kdvbqmjbl5BW0Y0cj8JH7j2+FlTZpooMNcZgbui45UGbHbuPa7JFAO0LfpDQQZuLoVNq5OVccJ/CZ4hqNo5lqwPrXGtv600SAzqwr1OBiMBVQFBOZ5WPW+J2Z8VTYE37v9NtyP3zsIyUB/V0PPwxm4ctKZcVDIxq4NEAVRKNwafNjj+R5OnkEFjlwyICT/bZZuavaf8qBng9vB7ILH6i/guTfCTimZIYH+3w1NU3kW2HiuQafCYE6lS4rOeeTTDa4Zvnm+FQ0Jmmo8Zzs8D2zDtal1e8tCFWVW2hOat1JXcHOlLk1L/yV36MzxJTxncL8SdJq5yUFn9fHNIpgVMIXdjWCFdqaHBn8M/S+nG0Dv9wzDJVzNtkG7LR03XuEsVxjqsar+1Ysz0oN9Ht6YZj3ebICbz6BEYiqkFq4vZbhUt2e51Q9G02Ezq9rIRvdjc1dlYR3q7Supr667aYebsecl3KAKjwJUgVTCVd8the6u+9CheuyWjpoVUOd5hD/14DpoHkC5jnrr/3CC9tzL5UPQzLY2ahI7PUXntCg8Oe4b3Uth88ZiuC42Va9dXWT2aQ5ZV0y0TTd+0CEU2qU3phlldttDKv87xFARqhaudrGnVTwcPZR/wqbgzNEZryg6TGeQxVyep9Oj3iUOgXaqGvznFR5WmeO9qpDMuykCy9NXW4tSPJpTOgaaU2aF9cLaZiKgm5NlasYZQCl6q9OshS+GDBtS67xYaIjbceOk+yOEFTAq08rvjAN4SMMsr/9zV1u7klcKhop+EK4zVDt3D4QUPBYUA557GLqJmlTU3nXT7Cl6KVy9Nt+S1NY9A8EUHgsqA8oxDa75l7/q5YG9nqAXwnW5m4fSzZyNMO6ElebXLA8qVF9gcVP0/EGyCF4ReiFcOz2NzhsHDvr/VaEm5JV89F03Y9DDimG3FsoAy6LycwvDiX6xFv4vMSrchBgVbkKMCjcZxoz5L0ShsU4sRHNgAAAAAElFTkSuQmCC)\"></div>",d.getContainer().appendChild(pg.$mapShowCoolVehicles),L.DomEvent.disableClickPropagation(pg.$mapShowCoolVehicles),L.DomEvent.disableScrollPropagation(pg.$mapShowCoolVehicles),pg.mapShowCoolVehicles=!1,jq(pg.$mapShowCoolVehicles).bind("click",function(a){pg.mapShowCoolVehicles=!pg.mapShowCoolVehicles,pg.fToggleVehicles(pg.mapShowCoolVehicles?2:pg.mapShowVehicles),pg.fShowVehicles()}),pg.$mapShowWifiVehicles=document.createElement("div"),pg.$mapShowWifiVehicles.id="divMapShowWifiVehicles",pg.$mapShowWifiVehicles.style.right="0",pg.$mapShowWifiVehicles.style.top=m+"px",m+=n,pg.$mapShowWifiVehicles.className="map_button",pg.$mapShowWifiVehicles.innerHTML="<div id=\"mapShowWifiVehicles\" class=\"map_button_icon\" title=\""+i18n.mapShowWifiVehicles+"\" style=\"background-size: 20px 20px; background-position: 5px 5px; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAABXCAMAAABGFileAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAALiIAAC4iAari3ZIAAAKRUExURQAAABoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERoYERBESUQAAADadFJOUwAAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcZGhscHR4fICEiIyYnKCkrLC0uLzAxMzQ1Njc4OTo7PD4/QEJFRkdISUpLTE1OT1BRUlNUVVhZWltdXl9hYmRlZ2hpa25vcHN0dXZ3eHl7fH1+f4GChYaHiIqLjI2Oj5CRkpSVlpeZmpucnZ6foKGipKWmp6ipqqusra6vsLGytba3uLm6vL2+v8DExcfIycrLzM3P0NHS09TV1tfY2dvc3d7f4OHi4+Tl5ufo6uvs7e7v8PHy8/T19vf4+fr7/P3+z8oHMQAABCpJREFUGBntwf1/TXUAB/DP99y7i7PtbrehnVgoeSySQqk8hpbWIioV5lnKPKR5aBRD0tIqZU7FpiWMcK/QaNUMm43lYbv389d0X3c795xzdx/X+a37fiMpKSmpy0T2mFcWfVDy1cHDlYcOlpWsL8h7qrfAfyL65xdVXmdnVys25D2Irsl8ecclRnPx41wnEpQx+8Adxnb721fTETdpzK5bjFfzjtEC8eg26wQTczQvBbF0f+sSE3fhDQeisc2qYdecz7MhEjH2OMPw1lbsXD1/du6USVNyX1tQuKvyLy/DqHoC4WXt8DJU3RcLxrkQ6r6nF5ZdYShvcSY6EzPqaOY9sniYhEhsjy6r8tKsdrJAiPQSmp0p6ItY+i310MS3NRUmw8/RqLV0rEA8pGfK2mh0ejAM8ltocHtLP8Tv4W13adD8EjS2NT7q2rbnIDH9d7dR531XQkD3UhpUDEcYIj1nyOOjRg7JSRMIY+QRGux2wM95iLqrsyWYiT4z3is71ehlO29D9b5V0xUBM9vrDdSVpwKuKur2Z8Mkbfq2Cz525vuteGoqTPqUU1fpxAYG/TNPgkHK5NJbjKx5z/N2GEjz7zCoBLLKDhdHwKDnssuM5fdFLhiM/oMdPAogqwyo6AXd/etuMh43CntCl/0TA9wK/GSVfp92Q1DqiibGq3FJDwTJ++jnVhAgq+SHNmjE1Bom4vwEAY29mHQr6CCrqwU0WXsZhu9GzdkzZy81+diZb2cmNFKRW0GQQ0AzvpYh6vcvnzYoFe3SBs9Y+d11hqgZA43kQhjS4laaVK8YISGUbeSqX2lyb75AFD320Khx41CB8MRjW5potN2BiDIraVC30IloXEvrafB9OiLodZy6myvSEIvz/RbqqlwIbyN13+QgHgMOULcH4ckqOzTmC8RHmtPEDh4FEcgqA44NgIno9ey8NdtLvy79pPDN8VkCJgNPMcCjICJZpd9nMgy6TfzonJc679nNzzlgkFZGP4+CKGSVXGuDbmBRPTu7sv4h6GybSLeCqGR1uUDQkC/bGF7r3kcQJBW6FcSQIqDJ2trKyO5tyoRGZCBu4oW/GV3tBCTOUeRjLL61diTIdYjxKHciIdknadLww8aFc/LnFmz+sZEmv2QhEVtocLlwlB0a+5Pr/qTB50iErFJTPTMFZo6809S4FSREVhlwba4NndnnNTDAoyBBsko/VUF4fQ/Tz6MgYbJKrrMjkpTNpEdBF8gHCwQiEyvdCrrELhCNSMf/ki3NBsu5lhy7yztHCzJgqWn1bFc3ARaa1UZN60xYZuht6loGwiKinEZlsEiOl0atvWGNfJq9CGsspdk7sMYimr0Na+TSbCKs0fMujVqcsMhuGhXDKg9co66uNywzrpmaxtGw0LATbPfzIFjKNnXXyZrqkkkSkpKSuupf8PvzD5hOHXkAAAAASUVORK5CYII=)\"></div>",d.getContainer().appendChild(pg.$mapShowWifiVehicles),L.DomEvent.disableClickPropagation(pg.$mapShowWifiVehicles),L.DomEvent.disableScrollPropagation(pg.$mapShowWifiVehicles),pg.mapShowWifiVehicles=!1,jq(pg.$mapShowWifiVehicles).bind("click",function(a){pg.mapShowWifiVehicles=!pg.mapShowWifiVehicles,pg.fToggleVehicles(pg.mapShowWifiVehicles?2:pg.mapShowVehicles),pg.fShowVehicles()}),pg.$mapShowUsbVehicles=document.createElement("div"),pg.$mapShowUsbVehicles.id="divMapShowUsbVehicles",pg.$mapShowUsbVehicles.style.right="0",pg.$mapShowUsbVehicles.style.top=m+"px",m+=n,pg.$mapShowUsbVehicles.className="map_button",pg.$mapShowUsbVehicles.innerHTML="<div id=\"mapShowUsbVehicles\" class=\"map_button_icon\" title=\""+i18n.mapShowUsbVehicles+"\" style=\"background-size: 20px 20px; background-position: 5px 5px; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAArQIAAK0CAWJHqbAAAAFlUExURQAAAEVHSTk7PEdISk1PUU1PUE1PUVFTVU1PUU5QUVBSU1BRU1FTVVFTVVBSVFJUVlNVVlJUVVJUVlNVVlNVV1VXWVRWWFRWWFNVVlJUVlRWWFVXWVNVV1NVV1VXWVRWWFVXWVNVVlNVV1RWWFRWWFVXWVNVV1RWWFRWV1RWWFRWWFRWWFVXWVRWWFNVV1NVVlNVV1RWWFJUVlVXWVRWWFNVVlRWV1NVV1JUVlVXWVVWWFRWWFVXWVVXWVVXWVNVV1JUVlZYWlVXWVVXWVVXWVVXWFRWWFZYWlVXWVZYWlVXWVVXWVRWWFVXWVVXWVVXWVVXWVZYWVVXWVVXWVRWWFZYWlVXWVZYWlZYWlVXWVVXWVVXWVZXWVZYWlZYWlZYWlVXWVZYWlVXWVZYWlZYWlVXWVZYWlZYWlVXWVZYWlVXWVZYWlVXWVZYWlZYWlVXWVZYWlVXWVZYWlZYWlZYWlZYWlZYWmMFa1UAAAB2dFJOUwAAAQEBAwMDBAQEBQgJCgoKCw4ODg8QExQVGBkaHR4fICEhIycoLS0vMDM0OkNISktLTE9QUVNXWFldamptb3BydXh5foKEhouQlJWZmZucnZ+gsbKyubm/wcLDxsrNzs/Q0tXX293f4ODj5Obn6u3t7/L7/f6SFjcuAAABM0lEQVQ4y6XSR1MCQRCG4QEUA+YsJszZNStiQoyLCuoawJzFrOD7+z0sniiYrrKPU09VT3d/SmWW16tktRuRuYFkclDiXDGIuQTQD+DXu8oEQKJcC9uDUYgGOwS9DTBEUxtgqGnLsqxtAQwBPPwbjkU22yRw7gdeGgTwEmDehhOHcLWVBV4DLKbX44PlbF9cAD6bBTBvD4b+Ft4FS1kXswG+NCw5gGEBrDmBs2I9nD2Fm1alhx9w0ZjjeKvQqZQBcF6f68qTEC5QBnBUljMOFY+wk2/Acakmin3vsD8Fo9rQ9r7BE4zo4919DyKoWu6EUDXdCqGakcJxIfSsw5pH76rjAPEqLTQBwNS5wi8bfhdpYC3pqtNA57PtXp263is2DGmHcZspSIXd+v04egKBfkfG8y/YEnkqBkUaFAAAAABJRU5ErkJggg==)\"></div>",d.getContainer().appendChild(pg.$mapShowUsbVehicles),L.DomEvent.disableClickPropagation(pg.$mapShowUsbVehicles),L.DomEvent.disableScrollPropagation(pg.$mapShowUsbVehicles),pg.mapShowUsbVehicles=!1,jq(pg.$mapShowUsbVehicles).bind("click",function(a){pg.mapShowUsbVehicles=!pg.mapShowUsbVehicles,pg.fToggleVehicles(pg.mapShowUsbVehicles?2:pg.mapShowVehicles),pg.fShowVehicles()}),pg.$mapShowVehiclesBicycleFriendly=document.createElement("div"),pg.$mapShowVehiclesBicycleFriendly.id="divMapShowVehiclesBicycleFriendly",pg.$mapShowVehiclesBicycleFriendly.style.right="0",pg.$mapShowVehiclesBicycleFriendly.style.top=m+"px",m+=n,pg.$mapShowVehiclesBicycleFriendly.className="map_button",pg.$mapShowVehiclesBicycleFriendly.innerHTML="<div id=\"divMapShowVehiclesBicycleFriendly\" class=\"map_button_icon\" title=\""+i18n.mapShowVehiclesBicycleFriendly+"\" style=\"background-size: 20px 20px; background-position: 5px 5px; background-image: url("+pg.imagesFolder+"bicycle.png)\"></div>",d.getContainer().appendChild(pg.$mapShowVehiclesBicycleFriendly),L.DomEvent.disableClickPropagation(pg.$mapShowVehiclesBicycleFriendly),L.DomEvent.disableScrollPropagation(pg.$mapShowVehiclesBicycleFriendly),pg.mapShowVehiclesBicycleFriendly=!1,jq(pg.$mapShowVehiclesBicycleFriendly).bind("click",function(a){pg.mapShowVehiclesBicycleFriendly=!pg.mapShowVehiclesBicycleFriendly,pg.fToggleVehicles(pg.mapShowVehiclesBicycleFriendly?2:pg.mapShowVehicles),pg.fShowVehicles()}))),pg.mapShowTraffic&&pg.fShowTraffic(!0),pg.mapShowVehicles>0&&pg.fToggleVehicles(pg.mapShowVehicles);var r;d.on("contextmenu",function(a){event=a.originalEvent;if((cfg.city.urlGPS||"").indexOf("sos")>=0)return pg.cancelEvent(event);r=null,$("divSuggestedStops").style.display="none",event||(event=window.event);var b=event&&(event.target||event.srcElement);if(!b||b.className=="map_button")return pg.cancelEvent(event);var c=b&&(b.tagName||"").toLowerCase()||"";b&&c!=="a"&&c!=="img"&&(b=b.parentNode,c=b&&(b.tagName||"").toLowerCase()||"");var d=b&&(c==="a"&&b.href||c==="img"&&b.id||"")||"";if(b&&b.parentNode&&(b.parentNode.tagName||"").toLowerCase()=="td")return pg.cancelEvent(event);if(d&&d.indexOf("#")>=d.length-1)return pg.cancelEvent(event);d?r=b:r={},s(a)});var s=function(a){if((cfg.city.urlGPS||"").indexOf("sos")>=0)return pg.cancelEvent(a.originalEvent);var b=a.containerPoint.x,c=a.containerPoint.y,d=Math.round(1e6*a.latlng.lat)/1e6+";"+Math.round(1e6*a.latlng.lng)/1e6;pg.openMapInfoWindow(b,c,"","",d,a.latlng)};d.on("click",function(a){var b=a.originalEvent;pg.timeOfActivity=(new Date).getTime(),pg.inputSuggestedStops_Blur(),b=b||window.event;var c=b&&(b.target||b.srcElement),d=c&&c.getAttribute&&c.getAttribute("data-vehicle-id");if(d){pg.realTimeDepartures.vehicleID!=d&&(pg.realTimeDepartures.vehicleID=d,pg.realTimeDepartures.mapStop="",pg.realTimeDepartures.vehicleTransport=c.getAttribute("data-transport"),pg.realTimeDepartures.vehicleRouteNum=c.getAttribute("data-route"),pg.realTimeDepartures.$mapPopup={},pg.fProcessVehicleDepartures()),pg.pannedTo=2,pg.fShowVehicles();return pg.cancelEvent(b)}if((cfg.city.urlGPS||"").indexOf("sos")>=0)return pg.cancelEvent(b);var e=c&&(c.tagName||"").toLowerCase()||"",f,g="";if(e!="input"&&e!="label"&&e!="fieldset"){if(!c||c.id!="mapRemoveRoute"&&c.id!="mapRemoveRoute2"){for(var h=c;h;h=h.parentNode){if(h.id=="mapDropDownContent")break;if(h.id=="mapDropDown")return pg.cancelEvent(b)}c&&e!=="a"&&e!=="img"&&(c=c.parentNode),f=c&&(e==="a"&&c.href||e==="img"&&c.id||"")||"",g=c.id}else f="#map",(pg.mapShowVehicles<0||pg.mapShowVehicles==1)&&pg.fToggleVehicles(-Math.abs(pg.mapShowVehicles));if(f.indexOf("#")<0||f.indexOf("#")>=f.length-1){var i=a.sourceTarget.stopIds,j=a.containerPoint.x,k=a.containerPoint.y;if(!i){var l=256;for(var m=0;m<pg.clusterManager.clusters.length;m++){var n=pg.clusterManager.clusters[m],o=pg.GMap.latLngToContainerPoint(n.getLatLng()),p=(o.x-j)*(o.x-j)+(o.y-k)*(o.y-k);l>p&&(l=p,i=n.stopIds)}}if(i){pg.realTimeDepartures.mapStop=i,pg.realTimeDepartures.vehicleID=null;var q=[];i.indexOf(";")==-1&&q.push("<br/><a class=\"show-departures\" href=\"#stop/"+i+(cfg.isMobilePage?"":"/map")+"\"><span class=\"icon icon_narrow\"></span>"+i18n.mapShowRoutesFromStop+"</a>"),q.push("<a href=\"#stop/"+i+"/map\" class=\"cluster\"><span class=\"icon icon_narrow\"></span>"+i18n.mapZoomIn+"</a>");var r=ti.fGetRoutesAtStop(i,!1,!0),s=[],t=null,u=16,v=1,w=null;for(var x=0;x<r.length;x++){route=r[x],t!=route.transport&&(t!=null&&s.push("<br/>"),t=route.transport,s.push("<span class=\"icon icon_narrow icon_"+route.transport+"\"></span>"),v=1,w=null);var y={id:route.id,city:route.city,transport:route.transport,num:ti.toAscii(route.num,!0),dirType:route.dirType,routeTag:route.stopId,stopId:route.stopId};if(y.num===w)continue;w=y.num;var z=pg.fUrlSet({schedule:y},!0),A="<a class=\"hover "+(cfg.defaultCity=="xxxriga"?"activetransfer ":"transfer")+route.transport+"\" href=\"#"+z+"\" title=\""+(route.name||"").replace(/"/g,"")+"\">"+route.numHTML.replace(/\s/g,"&nbsp;")+"</a> ";s.push(A),v%u||s.push("<br/><span style=\"margin-left:22px;\"></span>"),v+=1}var B=ti.fGetAnyStopDetails(i);if(B&&B.latAvg&&B.lngAvg){var C=B.name,D="&nbsp;&nbsp;";(B.info||"").indexOf("wifi")>=0&&(C+=D+"<img style=\"margin: 0;\" src=\""+pg.imagesFolder+"stop_wifi.png\" alt=\"wifi stop\" title=\""+i18n.stopHasWiFi+"\" />",D="&nbsp;"),(B.info||"").indexOf("wc")>=0&&(C+=D+"<img style=\"margin: 0; width:16px; height:16px; border:solid 1px black;\" src=\""+pg.imagesFolder+"wc.png\" alt=\"wc stop\" title=\""+i18n.stopHasWC+"\" />");var E=[s.join(""),q.join("")].join("");pg.openMapInfoWindow(a.containerPoint.x,a.containerPoint.y,C,E,i,{lat:B.latAvg,lng:B.lngAvg})}}return}var F=pg.fUrlParse(f);if(F.schedule&&e!=="img"&&g!="specialstop")f=pg.fUrlSet({schedule:F.schedule});else if(F.transport=="stop"||F.schedule){var i=F.schedule&&F.schedule.stopId||F.inputStop;if((c.className||"").toLowerCase().indexOf("cluster")<0)F.transport=="stop"&&(pg.hashForMap=cfg.isMobilePage?"":"map",pg.map={},pg.fTabStop_Click(F.inputStop));else{var G=i.split(","),H=[];for(var m=0;m<G.length;m++){var I=ti.fGetStopDetails(G[m]);I.lat&&I.lng&&H.push([I.lat,I.lng])}pg.GMap.fitBounds(H)}}else F.transport=="plan"?(pg.hashForMap=F.hashForMap,pg.map={},pg.optimalResults=null,pg.fTabPlanner_Click(F.inputStart,F.inputFinish)):(pg.hashForMap=F.hashForMap,pg.hashForMap=="map"&&(pg.mapShowAllStops=Math.abs(pg.mapShowAllStops)),typeof mobile!="unknown"&&(pg.schedule=null),pg.sisp&&pg.transport!="plan"&&F.transport==""&&(pg.transport=""),cfg.defaultCity=="tallinna-linn"&&F.hashForMap=="map"&&(pg.inputStart="",pg.inputStop="",pg.inputFinish=""),pg.fUrlSet(pg),pg.mapShowVehicles>0&&f=="#map"&&pg.fShowVehicles());return pg.cancelEvent(b)}}),pg.hideMapInfoWindow=function(){pg.GMap.closePopup()},pg.openMapInfoWindow=function(a,b,c,d,e,f){var g=(cfg.defaultCity=="mariupol"||cfg.defaultLanguage=="ru")&&leaflet.baseLayerYandex,h=0;g?h=150:!1&&cfg.city.googleAPIkey&&(h=70);var i=["<div class=\"mapMenu\">","<div class=\"content\">",c?"<span class=\"baloon_title\">"+c+"</span><br/>":"","<div class=\"streetview\" style=\"display:block;visibility:hidden;width:250px;height:",h,"px;transition: height 0.1s ease-in;\">","</div>",d];g||(cfg.defaultLanguage=="ru"?i.push("<a href=\"https://yandex.ru/maps/?panorama[point]="+f.lng+","+f.lat):cfg.defaultCity=="mariupol"?i.push("<a href=\"https://yandex.ua/maps/?panorama[point]="+f.lng+","+f.lat):i.push("<a href=\"http://maps.google.com/maps?q=&layer=c&cbll="+f.lat+","+f.lng),i.push("\" target=\"_blank\"><span class=\"icon icon_narrow\"></span>",i18n.streetview||"\"Street View\"","</a>"));if(typeof e!="undefined"){var j=pg.fUrlSet({transport:"plan",inputStart:e,hashForMap:"map"},!0),k=pg.fUrlSet({transport:"plan",inputFinish:e,hashForMap:"map"},!0);i.push("<div class=\"a start-set\" id=\"start-set\"><span class=\"icon icon_stopGreen\"></span>"+(e.indexOf(";")==-1?i18n.mapDirectionsFromStop:i18n.mapDirectionsFromHere)+"</div>"),i.push("<div class=\"a finish-set\" id=\"finish-set\"><span class=\"icon icon_stopRed\"></span>"+(e.indexOf(";")==-1?i18n.mapDirectionsToStop:i18n.mapDirectionsToThere)+"</div>")}i.push("</div></div>"),pg.map_popup.setLatLng(f);var d=L.DomUtil.create("div");d.innerHTML=i.join(""),pg.map_popup.setContent(d),pg.map_popup.openOn(pg.GMap);if(typeof e!="undefined"){jq(d.getElementsByClassName("start-set")[0]).bind("click",function(){pg.hideMapInfoWindow(),pg.inputStart="",pg.loadedPlannerParams="",pg.map.num="",pg.optimalResults=null;var a={transport:"plan",inputStart:e};cfg.isVilniusAirport&&(a.inputFinish="2613"),pg.fUrlSet(a)}),jq(d.getElementsByClassName("finish-set")[0]).bind("click",function(){pg.hideMapInfoWindow(),pg.inputFinish="",pg.loadedPlannerParams="",pg.map.num="",pg.optimalResults=null;var a={transport:"plan",inputFinish:e};cfg.isVilniusAirport&&(a.inputStart="2613"),pg.fUrlSet(a)});var l=d.getElementsByClassName("cluster");l.length&&jq(l[0]).bind("click",function(){pg.GMap.closePopup(),pg.clusterManager.fitStops(e.split(","))});var m=d.getElementsByClassName("streetview")[0];if(g)pg.loadYandexScript(function(){pg.loadYandexPanorama(m,f)});else if(!1&&cfg.city.googleAPIkey){var n=new Image(250,70);n.id="streetview-static",n.setAttribute("crossOrigin",""),n.crossOrigin="Anonymous",n.onload=function(){var a=document.createElement("canvas");a.width=n.width,a.height=n.height,a.getContext("2d").drawImage(n,0,0,n.width,n.height);var b=a.getContext("2d").getImageData(0,0,1,1).data;b[0]!=228||b[1]!=227||b[2]!=223?m.style.visibility="visible":m.style.height="0px"},n.src=["//maps.googleapis.com/maps/api/streetview?",cfg.city.googleAPIkey?"key="+cfg.city.googleAPIkey+"&":"","size=500x140&location=",f.lat,",",f.lng,"&fov=120&heading=0&pitch=0","?"+(new Date).getTime()].join(""),m.appendChild(n)}else m.style.height="0px"}},pg.loadYandexPanorama=function(a,b){typeof ymaps!="undefined"&&ymaps.panorama.isSupported()&&ymaps.panorama.locate([b.lat,b.lng]).done(function(b){if(b.length>0){a.innerHTML="",a.style.visibility="visible",a.style.height="150px";var c=new ymaps.panorama.Player(a,b[0],{controls:[]})}else a.style.height="0px"},function(a){console(a.message)})},pg.splitEncodedPolyline=function(a,b,c,d,e){var f=a.length,g=0,h=[],i=0,j=0,k=Number.POSITIVE_INFINITY,l,m,n=0,o=-1,p=0;b*=1e5,d*=1e5,c*=1e5,e*=1e5;while(g<f){var q,r=0,s=0;do q=a.charCodeAt(g++)-63,s|=(q&31)<<r,r+=5;while(q>=32);var t=s&1?~(s>>1):s>>1;i+=t,r=0,s=0;do q=a.charCodeAt(g++)-63,s|=(q&31)<<r,r+=5;while(q>=32);var u=s&1?~(s>>1):s>>1;j+=u,l=(i-b)*(i-b)+(j-c)*(j-c),k>l&&(k=l,n=o=p,m=Number.POSITIVE_INFINITY),l=(i-d)*(i-d)+(j-e)*(j-e),m>l&&(m=l,o=p),h[p]=[i/1e5,j/1e5],++p}o<n&&(o=p-1),h=h.slice(n,o+1);return h},pg.loadPolyline=function(a,b,c,d,e,f,g,h){var i=b;b=="eventbus"?i="bus":cfg.defaultCity=="klaipeda"&&c.charAt(0).toLowerCase()!="m"&&c!="31"&&c!="32"?i="bus":cfg.defaultCity=="vilnius"?c.indexOf("xxxtraukinuk")<0?b=="commercialbus"&&(i="bus"):i="bus":cfg.defaultCity=="riga"&&b=="expressbus"&&(i="minibus");var j=ti.toAscii([a,i,c].join("_"),!0)+".txt";j=j.replace(/\*/g,"@"),cfg.city.datadir=="riga"&&i=="minibus"?j="//www.marsruti.lv/rigasmikroautobusi/bbus/readfile.php?name="+j:j=cfg.city.datadir+"/"+j,ti.fDownloadUrl("get",j,function(i){i.indexOf("\r\n")<0?i=i.split("\n"):i=i.split("\r\n");var j=pg.getStyle("."+b),k=.8;for(var l=2;l<i.length;l+=3){if(!d[i[l-2]])continue;var m=pg.splitEncodedPolyline(i[l-1],e,f,g,h),n=j&&(j.backgroundColor||j.color)||"#0000FF",o=L.polyline(m,{color:n,opacity:k,weight:5,interactive:!1});k=.6,o.addTo(pg.GMap),pg.sisp&&((pg.loadedPolylines[[a,b,c].join("_")]||{}).polyline=o),pg.mapOverlays.push(o)}})},pg.stopLabelSelected=L.circleMarker([cfg.city.lat||0,cfg.city.lng||0],{radius:0,color:"rgb(60, 60, 60)",weight:0,fillColor:"white",fillOpacity:0,opacity:0}).addTo(pg.GMap),pg.stopLabelSelected._ready=!0;var t=L.icon({iconUrl:pg.imagesFolder+"MarkerStart.png",iconSize:[20,34],iconAnchor:[10,34]});pg.mapMarkerStart=L.marker([0,0],{icon:t,title:i18n.mapDragToChangeStart,draggable:!0});var u=L.icon({iconUrl:pg.imagesFolder+"MarkerFinish.png",iconSize:[20,34],iconAnchor:[10,34]});pg.mapMarkerFinish=L.marker([0,0],{icon:u,title:i18n.mapDragToChangeFinish,draggable:!0}),pg.mapMarkerStart.on("dragend",function(){pg.map={},pg.optimalResults=null;var a=pg.mapMarkerStart.getLatLng(),b=v(a),c=b.length?b.join(","):[a.lat.toFixed(6),a.lng.toFixed(6)].join(";");pg.fTabPlanner_Click(c,pg.inputFinish,"map")}),pg.mapMarkerFinish.on("dragend",function(){pg.map={},pg.optimalResults=null;var a=pg.mapMarkerFinish.getLatLng(),b=v(a),c=b.length?b.join(","):[a.lat.toFixed(6),a.lng.toFixed(6)].join(";");pg.fTabPlanner_Click(pg.inputStart,c,"map")}),pg.mapMarkerStart.on("dragstart",function(){pg.mapShowAllStops<0&&(pg.mapShowAllStops=Math.abs(pg.mapShowAllStops),setTimeout(function(){pg.clusterManager.refresh()},100))}),pg.mapMarkerFinish.on("dragstart",function(){pg.mapShowAllStops<0&&(pg.mapShowAllStops=Math.abs(pg.mapShowAllStops),pg.clusterManager.refresh())});function v(a){var b=pg.GMap.project(a,19),c=19-pg.GMap.getZoom(),d=1<<c+2,e=b.x-d,f=b.x+d,g=b.y-d,h=b.y+d,j=pg.clusterManager._mapMarkers,k=[];for(i=j.length;--i>=0;){marker=j[i];var l=marker._x,m=marker._y;if(m>h)break;m>=g&&l>=e&&l<=f&&k.push(marker.id)}return k}ClusterManager=function(a,b,c){this.map=a,this._mapMarkers=b.slice(),this.stop_colors={Gray:"DarkGrey",30:"Green",60:"Red",OnRoute:"Orange",OnRoute2:"White"},this.markerRedIcon=L.icon({iconUrl:pg.imagesFolder+"MarkerRed.png",iconSize:[12,20],iconAnchor:[6,20]}),this.clusterLayer=new L.FeatureGroup,this.clusterLayer.addTo(this.map),this._markersHidden=!1,this.stopCluster={},c=c||{},this.fitMapToMarkers=c.fitMapToMarkers===!0,c.fitMapMaxZoom&&(this.fitMapMaxZoom=c.fitMapMaxZoom),this.clusterMaxZoom=c.clusterMaxZoom?c.clusterMaxZoom:99,this.borderPadding=c.borderPadding||256,this.intersectPadding=c.intersectPadding||0,this.clusteringEnabled=c.clusteringEnabled!==!1,this.ZoomLevel=this.map.getZoom();var d=this._mapMarkers;for(var e=d.length;--e>=0;){var f=d[e],g=this.map.project(L.latLng(f.lat,f.lng),19);f._x=g.x,f._y=g.y}d.sort(function(a,b){return b._y-a._y}),this._mapMarkers=d,this._ready=!0},ClusterManager.prototype.hideMarkers=function(){this._markersHidden||(this._markersHidden=!0,this.refresh())},ClusterManager.prototype.draw=function(){this._markersHidden!==!1&&(this._markersHidden=!1,this.refresh())},ClusterManager.prototype.fitStops=function(a){var b=L.latLngBounds();for(var c=0;c<a.length;c++){var d=ti.fGetStopDetails(a[c]);d.lat&&d.lng&&b.extend([d.lat,d.lng])}pg.GMap.fitBounds(b)},ClusterManager.prototype.findClosestCluster=function(a,b){var c=b.slice(),d=a,e=b[0].trim(),f=Number.MAX_VALUE;for(var g=0;g<b.length;g++){var h=ti.fGetStopDetails(b[g]);h&&h.neighbours&&(c=c.concat(h.neighbours.split(",")))}for(var g=0;g<c.length;g++){var i=c[g].trim(),h=ti.fGetStopDetails(i);if(h&&h.lat&&h.lng){var j=this.map.latLngToContainerPoint([h.lat,h.lng]),k=(j.x-a.x)*(j.x-a.x)+(j.y-a.y)*(j.y-a.y);k<f&&(d=j,e=i,f=k)}}var l=e in this.stopCluster?this.stopCluster[e]:b;return{point:d,cluster:l}},ClusterManager.prototype.show=function(){for(var a=0;a<this.markers.length;a++)this.markers[a].addTo(this.stopsLayer)},ClusterManager.prototype.hide=function(){this.map.closePopup();for(var a=0;a<this.markers.length;a++)this.markers[a].remove()},ClusterManager.prototype.createStopMarker=function(a,b,c){c=c||!1;var d=L.circleMarker(a,{radius:b,color:"rgb(60, 60, 60)",weight:1,fillColor:c?c:"white",fillOpacity:c?.8:0,opacity:c?1:0,riseOnHover:!0}).addTo(this.clusterLayer);return d},ClusterManager.prototype.refresh=function(){pg.timeOfActivity=(new Date).getTime(),pg.toggleClass($("divMapShowAllStops"),"pressed",pg.mapShowAllStops>0),pg.toggleClass($("divMapShowWifiStops"),"pressed",pg.mapShowWifiStops),pg.toggleClass($("divMapShowBicyclesRent"),"pressed",pg.mapShowBicyclesRent);var a=this._markersHidden?"Gray":"",b=this.map,c=[],d=this.map.project(this.map.getBounds().getSouthWest(),19),e=this.map.project(this.map.getBounds().getNorthEast(),19),f=this._mapMarkers,g=pg.mapStops,h,j,k,l,m={};this.stopCluster={},this.clusters=[],this.clusterLayer.clearLayers();if(pg.mapShowAllStops>0||pg.mapShowWifiStops){var n=19-this.map.getZoom(),o=1<<n+8+2,p=d.x-o,q=e.x+o,r=d.y+o,s=e.y-o,t=cfg.defaultCity==="xxxkautra"?1:12;t=1;var u=this.map.getZoom(),v=this.clusteringEnabled&&u<=this.clusterMaxZoom,w=cfg.defaultCity==="vilnius"&&pg.transport==="stop",x=cfg.defaultCity==="riga"?"s":"xxx",y=1<<n+3+(u<12?1:0);for(i=f.length;--i>=0;){h=f[i];var z=h._y;if(z<s||!h.name||h.id=="gps")continue;if(z>r)break;var A=h._x;if(A>=p&&A<=q){if(h.id in m)continue;var B=A,C=z,D=[],E,F=[],G=1,H=h.rideEnd-h.rideStart,I=(h.info||"").indexOf("wifi")>=0;if(!I&&pg.mapShowAllStops<0)continue;if(v&&h.id.charAt(0)!=x){var J=g[h.id],K=h.name;K.length>1&&!isNaN(K.slice(-1))&&(K=K.slice(0,-1));for(var M=i;--M>=0;){var N=f[M];if(N._y>C+y)break;if(N.id in m)continue;var O=(N.info||"").indexOf("wifi")>=0;if(!O&&pg.mapShowAllStops<0)continue;N._x<=B+y&&N._x>=B-y&&(u<t||N.name.indexOf(K)==0)&&(J=J||g[N.id],m[N.id]=!0,D.push(N.id),F.push(N.name),I=I||O,H<h.rideEnd-h.rideStart&&N.time<4320&&(H=h.rideEnd-h.rideStart),G++,B=(A+=N._x)/G,C=(z+=N._y)/G)}}if(J)continue;D.push(h.id);if(G>1){k=this.map.unproject(L.point(B,C),19),G=1;if(u<12){F.sort();for(var M=F.length;--M>0;)F[M]!=F[M-1]&&++G;E=G>2?i18n.totalStops+": "+G:(F[0]+(G>1?", "+F[F.length-1]:"")).replace(/"/g,"")}else E=K.replace(/"/g,"")}else E=(h.name||"").replace(/"/g,""),k=[h.lat,h.lng];w&&H>=0&&(a=H<=30?"30":H<=60?"60":"",E=E+", "+i18n.ride+" "+H+" "+i18n.minutesShort);var P;if(G>1){for(var Q=0;Q<D.length;Q++)this.stopCluster[D[Q]]=D;var R=a?this.stop_colors[a]:"Yellow";P=this.createStopMarker(k,4,R),P.bindTooltip(E,{className:"tooltip-small",offset:[6,0]}).addTo(this.clusterLayer),P.cluster=!0,P.stopIds=D.join(",")}else{this.stopCluster[h.id]=[h.id],I&&!pg.mapShowWifiStops&&(I=!1);if(I){var S=["<div style=\"width:16px; height:9px;background-image: url('",pg.imagesFolder,"stop_wifi.png');\"/>"].join("");this.createStopMarker(k,4,!1).bindTooltip(S,{permanent:!0,direction:"top",className:"wifi",offset:[0,-4]}).addTo(this.clusterLayer)}if(!a&&E=="Stotis"&&h.id.length>4){var T=h.id.slice(-1).toUpperCase();this.createStopMarker(k,4,!1).bindTooltip(T,{permanent:!0,className:"station",direction:"right",offset:[4,0]}).addTo(this.clusterLayer)}var R=a?this.stop_colors[a]:"Yellow";h.id.charAt(0)===x&&(R="#5CAFFB"),P=this.createStopMarker(k,4,R),P.bindTooltip(E,{className:"tooltip-small",direction:"right",offset:[4,0]}).addTo(this.clusterLayer),P.stopIds=D.join(",")}this.clusters.push(P)}}}for(l in g){var P=null;h=g[l],k=[h.lat,h.lng];var E=pg.browserVersion<7&&(!pg.mapShowStopsNames||h.hidden)?h.name.replace(/"/g,""):"";if(h.img=="MarkerStart"){var U=pg.getStyle("transport_icon_"+h.transport),V=["<a href=\"#",h.href,"\" class=\"label_transport\" style=\"border:0px;\">","<img class=\"icon_narrow\" src=\"",U,"\" />",h.num&&"<span class=\"transfer"+h.transport+"\" style=\"line-height:18px; vertical-align:top;\">"+h.num+"</span>&nbsp;",h.time?"<span style=\"line-height:18px; vertical-align:top; border:0 none;\">&nbsp;"+h.time+"&nbsp;</span>":"","<span",pg.mapShowStopsNames?"":" class=\"unhide\""," style=\"line-height:18px; vertical-align:top; border:0 none;\">",h.name,"&nbsp;</span>","</a>"].join("");P=this.createStopMarker(k,4,!1),P.bindTooltip(V,{permanent:!0,interactive:!0,direction:"right",className:"tooltip-small",offset:[4,0]}).openTooltip()}else{h.img=="MarkerRed"?P=L.marker(k,{icon:this.markerRedIcon,title:E,riseOnHover:!0}).addTo(this.clusterLayer):(P=this.createStopMarker(k,4,h.img=="stopOnRoute2"?"White":"Yellow"),(h.img||"").indexOf("stopOnRoute")>=0&&P.setStyle({weight:2}));if(!E){var V=["<div style=\"",l=="vehicle"?" background-color:yellow; opacity:1;":"","\""," class=\"\">",h.time&&h.img=="stop"?h.time:"",h.name,"</div>"].join(""),W=pg.mapShowStopsNames&&!h.hidden;P.bindTooltip(V,{permanent:W,interactive:W,direction:"right",className:"tooltip-small",offset:[4,0]}),pg.mapShowStopsNames&&!h.hidden&&P.openTooltip()}}P.stopIds=l,this.clusters.push(P)}if(cfg.city.bicycles&&pg.mapShowBicyclesRent){var X=u<=12?12:16,Y=L.icon({iconUrl:pg.imagesFolder+"cycling.png",iconSize:[X,X]});for(l=0;l<cfg.city.bicycles.length;++l){h=cfg.city.bicycles[l],k=[h.lat,h.lng];var E=h.name.replace(/"/g,"")+"\"",Z=L.marker(k,{icon:Y,pane:"overlayPane",zIndexOffset:-1e3,title:E}).addTo(this.clusterLayer)}}};var w=[],x=ti.stops;for(var y in x){var z=x[y];w.push(z)}pg.clusterManager=new ClusterManager(d,w,{}),pg.clusterManager.refresh(),d.on("zoomend moveend",function(){pg.mapShowVehicles>0&&pg.fShowVehicles(),pg.clusterManager.refresh()});var A=L.icon({iconUrl:pg.imagesFolder+"location2_wait.png",iconSize:[20,20],iconAnchor:[10,20]});pg.youAreHere=L.marker([0,0],{icon:A,draggable:!0,title:i18n.youAreHere,riseOnHover:!0}),pg.locationAccuracyCircle=L.circle(null,0,{stroke:!1,fillColor:"#FF0000",fillOpacity:.3}),pg.youAreHereInfowindow=L.popup({offset:[0,-20],autoPan:!1}).setContent(i18n.dragMarkerText),pg.map_popup=L.popup({maxWidth:500,minWidth:250,className:"",autoPanPaddingTopLeft:L.point(5,40),autoPanPaddingBottomRight:L.point(40,15)}),pg.hashForMap&&pg.hashForMap.indexOf("mylocation")!=-1&&window.gps?pg.renderMyLocation(jQuery("#divContentRoutes"),window.gps):typeof pg.updateMyLocationMarker=="function"&&window.gps?pg.updateMyLocationMarker(window.gps):typeof mobile!="undefined"&&typeof mobile.updateMyLocationMarker=="function"&&window.gps&&mobile.updateMyLocationMarker(window.gps),pg.fMapShow()}},pg.getMapVehiclesLayer=function(){typeof leaflet.vehiclesLayer=="undefined"&&(VehiclesLayer=L.Layer.extend({onAdd:function(a){var b=a.getPane("markerPane");this._container=L.DomUtil.create("div"),this._container.id="divMapVehicles",b.appendChild(this._container),a.on("zoomend viewreset",this._update,this)},onRemove:function(a){this._container.innerHTML="",L.DomUtil.remove(this._container),a.off("zoomend viewreset",this._update,this)},_update:function(){this._container.innerHTML="",this._container.style.visibility="visible"},getContainer:function(){return this._container}}),leaflet.vehiclesLayer=new VehiclesLayer({pane:"markerPane"}),leaflet.vehiclesLayer.addTo(pg.GMap));return leaflet.vehiclesLayer},pg.divMapHide_Click=function(){pg.fMapHide(),pg.hashForMap="";if(typeof mobile!="undefined"){if(pg.urlUnderMobileMap){window.location.hash="#"+pg.urlUnderMobileMap;return}if(mobile.current_page=="schedule4"&&mobile.previous_page=="stop"){mobile.back();return}if(mobile.current_page=="stop"&&pg.inputStop&&pg.inputStop.indexOf(";")!=-1){pg.fUrlSet({transport:"search"});return}if(pg.urlPrevious==""||pg.urlPrevious=="/"+pg.language){pg.fUrlSet({transport:"",city:""});return}}pg.fUrlSet()},pg.divMapMaximize_Click=function(a){var b=pg.GMap&&pg.GMap.getCenter();pg.fUrlSetMap({maximized:!0}),b&&setTimeout(function(){pg.GMap.invalidateSize()},300);return pg.cancelEvent(a)},pg.divMapRestore_Click=function(a){var b=pg.GMap&&pg.GMap.getCenter();pg.fUrlSetMap({maximized:!1}),b&&pg.GMap.invalidateSize();return pg.cancelEvent(a)},pg.fToggleVehicles=function(a){pg.mapShowVehicles=a,pg.GMap&&cfg.city.urlGPS&&(pg.toggleClass($("divMapShowVehicles"),"pressed",a>0),pg.$mapShowCoolVehicles&&pg.toggleClass(pg.$mapShowCoolVehicles,"pressed",pg.mapShowCoolVehicles),pg.$mapShowWifiVehicles&&pg.toggleClass(pg.$mapShowWifiVehicles,"pressed",pg.mapShowWifiVehicles),pg.$mapShowUsbVehicles&&pg.toggleClass(pg.$mapShowUsbVehicles,"pressed",pg.mapShowUsbVehicles),pg.$mapShowVehiclesBicycleFriendly&&pg.toggleClass(pg.$mapShowVehiclesBicycleFriendly,"pressed",pg.mapShowVehiclesBicycleFriendly),a>0&&!pg.mapShowVehiclesInterval?(pg.mapShowVehiclesInterval=setInterval(pg.fShowVehicles,5e3),window.setTimeout(function(){pg.fShowVehicles()},typeof leaflet.vehiclesLayer=="undefined"?200:0)):a<=0&&(pg.mapShowVehiclesInterval&&(clearInterval(pg.mapShowVehiclesInterval),pg.mapShowVehiclesInterval=0),pg.getMapVehiclesLayer()._update(),pg.$mapRoutesDropdown&&((pg.$mapRoutesDropdown.innerHTML||"").indexOf("radio")>=0&&(pg.$mapRoutesDropdown.style.display="none")),pg.$mapLegend&&(pg.$mapLegend.style.display="none")))},pg.fShowVehicles=function(){if(cfg.city.urlGPS&&pg.mapShowVehicles>0){if(pg.hashForMap=="map"&&pg.mapShowVehicles!=2){pg.fToggleVehicles(-1);return}var a=cfg.city.urlGPS;a+=a.indexOf("?")>=0?"&time=":"?",a+=+(new Date);if(!pg.visibility||pg.visibility=="visible")pg.waitingForGPSData=0,pg.GPSDataChunk="",ti.fDownloadUrl("GET",a,pg.fProcessGPSData),cfg.city.urlGPS2&&(pg.waitingForGPSData=1,a=cfg.city.urlGPS2,a+=a.indexOf("?")>=0?"&time=":"?",a+=+(new Date),ti.fDownloadUrl("GET",a,pg.fProcessGPSData))}else pg.mapShowVehiclesInterval&&(clearInterval(pg.mapShowVehiclesInterval),pg.mapShowVehiclesInterval=0),pg.getMapVehiclesLayer()._update()},pg.fProcessGPSData=function(a){if(pg.mapShowVehicles>0){if(pg.waitingForGPSData==1){pg.waitingForGPSData=0,pg.GPSDataChunk=a;return}a+=pg.GPSDataChunk,a=a.replace("\r",""),a=a.split("\n");var b=[],c=","+pg.hashForMap+",",d=c.lastIndexOf("(");d>=0&&(c=c.substring(0,d)+",");var e=pg.transport||pg.schedule&&pg.schedule.transport;e==="stop"&&(e="");var f=pg.schedule&&pg.schedule.num||"",d=f.lastIndexOf("(");d>=0&&(f=f.substring(0,d)),c=c.replace("eventbus,su-menek","bus,86"),f.indexOf("su-menek")>=0&&(f=f.replace("su-menek","86"),e="bus");var g=cfg.city.courseOrigin||0,h=cfg.city.courseCounterClockwise?-1:1,i=pg.GMap.getBounds(),j=i.getSouthWest(),k=i.getNorthEast(),l=null;(cfg.city.urlGPS||"").indexOf("sos")>=0&&(l=0,pg.mapStops={},pg.mapShowStopsNames=!0);var m=null,n=null,o=null,p=($("radio_new_vehicles")||{}).checked,q=0,r=0;for(var d=a.length;d--;){var s=a[d].split(",");if(s.length>=4){var t=s[1].replace(/\s/g,"");if(t==="-")continue;if(cfg.defaultCity=="jurmala"&&s[0].length!=2)continue;if(cfg.defaultCity=="adazi"&&s[0].length!=3)continue;if(cfg.defaultCity=="riga"&&s[0].length>1)continue;var u=({1:"trol",3:"tram",4:"minibus",5:"seasonalbus",6:"suburbanbus"})[s[0].slice(-1)]||"bus";s[1].length&&(typeof ti.transportRoutes=="function"?u=ti.transportRoutes(s[1],u):cfg.defaultCity=="vilnius"&&(s[1].charAt(s[1].length-1).toLowerCase()=="g"?u="expressbus":u=="bus"&&s[1].charAt(s[1].length-1).toLowerCase()=="n"?u="nightbus":u=="bus"&&t=="177"&&(u="commercialbus",t="177R")));if(e!="plan"&&e!="home")if(pg.hashForMap==="map"||pg.hashForMap=="map,max"){if(e&&(f||typeof mobile=="undefined"&&(cfg.defaultCity=="rostov"||cfg.defaultCity=="mariupol"))&&u!==e)continue;if(f&&ti.toAscii(t)!==f)continue}else if(c.indexOf(","+u+","+ti.toAscii(t)+",")<0)continue;var v=s[6],w=s[4]?s[4]+" km/h":"",x=null;s[5]&&+s[5]<999?pg.vehicleCourses[v]=x=g+ +s[5]*h:cfg.defaultCity=="mariupol"&&(x=pg.vehicleCourses[v]);var y=+s[2]/1e6,z=+s[3]/1e6;cfg.defaultCity=="novorossiysk"&&(z=(+s[2]+ +s[3])/2e6,y=(+s[2]- +s[3])/2e6);if(l!==null){var A=(s[9]||"").split("#");l<=-1&&(pg.realTimeDepartures.vehicleID="",n=o=m=null),++l,l==1&&!pg.realTimeDepartures.vehicleID&&(pg.realTimeDepartures.vehicleID=v,l=-999999),pg.mapStops["vehicle"+d]={lat:z,lng:y,href:"",img:"stop",name:"&nbsp;&nbsp;&nbsp;<b>"+v+"</b>",seconds:ti.printTimeWithSeconds(parseInt(s[7],10))};if(pg.realTimeDepartures.vehicleID==v){m=d;if(A[1]){var B=A[1].split("_"),C={},D=s[8],E="",F=(D||"-").split("-"),G=F[F.length-1],H=ti.fGetRoutes(cfg.defaultCity,B[0],B[1],null,!0)||[];for(var I=0;I<H.length;++I)if(D==H[I].dirType){E=D;break}if(!E)for(var I=0;I<H.length;++I){var F=(H[I].dirType||"-").split("-");if(G==F[F.length-1]){E=H[I].dirType;break}}C[E]=!0,n=[cfg.defaultCity,B[0],B[1],C,z,y],A[2]&&s[8]==B[2]&&(o=A[2].split("|"))}L=[z,y],pg.realTimeDepartures.vehicleID==v&&pg.pannedTo>=2&&(pg.GMap.panTo(L),L=null)}if(d==0){while(pg.mapOverlays.length)pg.mapOverlays.pop().remove();L&&pg.realTimeDepartures.vehicleID&&(!pg.pannedTo||pg.pannedTo==2&&!pg.GMap.getBounds().contains(L))&&(pg.GMap.getZoom()<15&&pg.GMap.setZoom(15),pg.GMap.panTo(L),pg.pannedTo=pg.pannedTo||2),m!==null&&(pg.mapStops.vehicle=pg.mapStops["vehicle"+m],pg.mapStops.vehicle.name+="&nbsp; "+(pg.mapStops["vehicle"+m].seconds||"")),n&&pg.loadPolyline(n[0],n[1],n[2],n[3],n[4],n[5]);if(o)for(var J=0;J<o.length;J+=2){var K=ti.stops[o[J]];K&&(pg.mapStops[K.id]={lat:K.lat,lng:K.lng,href:"",info:K.info,img:J!=0?"stopOnRoute":"stopOnRoute",name:ti.printTimeWithSeconds(parseInt(o[J+1],10))+"&nbsp;"+K.lat.toFixed(5)+",&nbsp;"+K.lng.toFixed(5)})}pg.clusterManager.refresh()}}if(z<j.lat||z>k.lat||(y>k.lng||y<j.lng))if(l==0)continue;var L=[z,y],M=pg.GMap.latLngToLayerPoint(L),N=pg.getStyle("."+u),O=N&&(N.backgroundColor||N.color);O=O&&pg.styleRGBtoHex(O)||"0000FF",cfg.defaultCity=="adazi"&&v?v.substring(0,1).toUpperCase()=="M"&&(O="F58220",r++):cfg.defaultCity=="vilnius"&&(t=="86"?(t="SU-",O="F58220"):t=="177R"&&(t="177"));var P=w,Q=!1,R=!1,S=!1,T=!1,U=!1;q++,v=="KNZ"&&(P="");if(cfg.defaultCity=="klaipeda")Q=v.slice(-1)=="t",P=Q?i18n.lowFloorVehicleMapTip||"":"",P=(P?P+", ":"")+(v||"")+" "+w;else if(cfg.defaultCity=="tallinna-linn")Q=(cfg.city.lowFloorVehicles||"").indexOf(","+v+",")>=0;else{Q=v.toUpperCase().slice(-1)=="Z",P=Q?v.slice(0,-1):v;if(cfg.defaultCity=="vilnius"){P="",v.toUpperCase().indexOf("N")>=0&&(R=!0,r++);var J=(v||"x").toLowerCase().lastIndexOf("k");J>=0&&(S=!0,v=v.slice(0,J)+v.slice(J+1));var J=(v||"x").toLowerCase().lastIndexOf("w");J>=0&&(T=!0,v=v.slice(0,J)+v.slice(J+1));var J=(v||"x").toLowerCase().lastIndexOf("d");J>=0&&(U=!0,v=v.slice(0,J)+v.slice(J+1))}Q&&(P+=i18n.lowFloorVehicleMapTip||""),P=(P?P+", ":"")+w}var V=Q;cfg.defaultCity=="tallinna-linn"?V=!Q:["riga","jurmala","adazi"].indexOf(cfg.defaultCity)>=0&&(P="");var W=V?"color:gold; border-color:gold;":"";u!="minibus"&&(W+="z-index: 200;");if(!p||R)if(!pg.mapShowCoolVehicles||S)if(!pg.mapShowWifiVehicles&&!pg.mapShowUsbVehicles||T)if(!pg.mapShowVehiclesBicycleFriendly||U)pg.transformCSS?(typeof x=="number"&&b.push("<div class=\"arrow\" style=\"left:"+(M.x-10)+"px; top:"+(M.y-10)+"px; background-color:#"+O+";"+W+pg.transformCSS+":rotate("+(45+x)+"deg);\"></div>"),b.push("<div class=\"circle\"  style=\"left:"+(M.x-9)+"px; top:"+(M.y-9)+"px; background-color:#"+O+";"+W+(t.length>3?";font-size:8px":t.length>2?";font-size:smaller":"")+";\" title=\""+P+"\" data-vehicle-id=\""+v+"\" data-transport=\""+u+"\" data-route=\""+t+"\">"+(R?"<span style=\"box-shadow: inset 0 -1.5px 0 "+(V?"gold;":"white;")+"\">"+t+"</span>":t)+"</div>")):b.push("<img src=\"http://chart.apis.google.com/chart?cht=it&chs=20x20&chco="+O+",00000000,00000000&chx=ffffff&chf=bg,s,00000000&ext=.png&chl="+t+"\" title=\""+P+"\" style=\"z-index:110; position:absolute; width:20px; height:20px; left:"+(M.x-10)+"px; top:"+(M.y-10)+"px; cursor:pointer;\" />")}}if(pg.$mapRoutesDropdown&&cfg.defaultCity=="vilnius"){var X="radio";pg.$mapRoutesDropdown.style.display==""&&(X=pg.$mapRoutesDropdown.innerHTML||""),X.indexOf("radio")<0?pg.$mapRoutesDropdown.style.marginLeft="auto":(typeof mobile!="undefined"&&(pg.$mapRoutesDropdown.style.marginLeft="50px"),X="<span><fieldset style=\"cursor:default; line-height:20px;\"><input type=\"radio\" id=\"radio_all_vehicles\" name=\"vehicles_on_map\" style=\"vertical-align: baseline; position:relative; top:2px; margin:3px 3px 3px 0px;\"  onchange=\"pg.fShowVehicles();\" "+(p?"":"checked")+"><label for=\"radio_all_vehicles\" style=\"font-size:12px;\">"+i18n.mapAllVehicles+" ("+q+")</label><br /><input type=\"radio\" id=\"radio_new_vehicles\" name=\"vehicles_on_map\" style=\"vertical-align: baseline; position:relative; top:2px; margin:3px 3px 3px 0px;\"  onchange=\"pg.fShowVehicles();\" "+(p?"checked":"")+"><label for=\"radio_new_vehicles\" style=\"font-size:12px;\">"+i18n.mapNewVehicles+" ("+r+")</label></fieldset></span>",pg.$mapRoutesDropdown.innerHTML=X,pg.$mapRoutesDropdown.style.display="",resizeDropDown())}pg.$mapLegend&&(pg.$mapLegend.style.display=""),a=null,window.requestAnimationFrame(function(){pg.getMapVehiclesLayer().getContainer().innerHTML=b.join("")})}};function resizeDropDown(){var a=$("mapDropDown"),b=$("mapDropDownContent");if(a&&b){var c=document.body.clientWidth,d=a.offsetLeft,e=a.offsetWidth,f=b.offsetWidth,g=0;if(d+f>=c){var g=-(f/2)+e/2;g=d+g>0?g:-d,b.style.left=g+"px",b.style.borderTopLeftRadius="4px"}}}jq(window).bind("resize",function(a){resizeDropDown()}),pg.fShowTraffic=function(a){},pg.fScheduleShow=function(a){a.num&&(a.num=a.num.toLowerCase()),pg.schedule||(pg.schedulePane=1,($("spanReturnToRoutes")||{}).href=pg.urlPrevious,pg.urlUnderSchedulePane=pg.urlPrevious,pg.languageUnderSchedulePane=pg.language),document.body.className.indexOf("Schedule")<0&&(cfg.isMobilePage&&pg.hashForMap?document.body.className="ScheduleMapDisplayed":document.body.className="ScheduleDisplayed"),$("aDir1")&&setTimeout(function(){try{$("aDir1").focus()}catch(a){}},100);pg.schedule&&pg.schedule.city==a.city&&pg.schedule.transport==a.transport&&pg.schedule.num==a.num&&pg.schedule.dirType==a.dirType&&pg.schedule.tripNum==a.tripNum?(pg.schedule.dirType=a.dirType,pg.schedule.stopId=a.stopId,typeof mobile=="undefined"&&pg.fScheduleStopActivate()):(pg.schedule=a,($("spanDir1")||{}).innerHTML="&nbsp;",($("spanDir2")||{}).innerHTML="&nbsp;",($("dlDirStops1")||{}).innerHTML="&nbsp;",($("dlDirStops2")||{}).innerHTML="&nbsp;",($("divScheduleContentInner")||{}).innerHTML="<br/>"+i18n.loading,pg.fScheduleLoad())},pg.fScheduleHide=function(){pg.schedule=null,document.body.className.indexOf("Schedule")>=0&&(document.body.className="",$("divMap").style.width="100%",$("divMap").style.height="100%")},pg.fScheduleLoad=function(a){if(typeof mobile=="undefined"||typeof a!="undefined"){pg.schedules=null,cfg.city.doNotShowTimetables=cfg.city.doNotShowTimetables||{},($("ulScheduleDirectionsList")||{style:{}}).style.display="none";if(typeof ti.routes!=="object"||typeof ti.stops!=="object"){setTimeout(function(){pg.fScheduleLoad(a)},200);return}var b=null,c;cfg.city.showAllDirections?(c=ti.fGetRoutes(pg.schedule.city,pg.schedule.transport,pg.schedule.num,pg.schedule.dirType),$("aDir2").style.display="none",$("aDir1").innerHTML=$("aDir1").innerHTML.replace("▼","")):c=ti.fGetRoutes(pg.schedule.city,pg.schedule.transport,pg.schedule.num,null,!0,null);if(typeof mobile!="undefined")var d={directions:{1:[],2:[]},stops:[],trip:{},streets:[]};if(!c.length){a&&a(d),$("divScheduleContentInner").innerHTML="Error: route not found.";return}var e={},f={1:"",2:""};for(var g=0;g<c.length;g++){var h=c[g],i=h.name,j="";if(h.routeTag.indexOf("0")>=0&&pg.schedule.dirType!=h.dirType)continue;!b&&pg.schedule.dirType&&pg.schedule.dirType==h.dirType&&(b=h,j="strong");if(!e[i+h.dirType]){e[i+h.dirType]=!0;var k=h.dirType.split("-"),l=k[0],m=k[k.length-1];c.length>1&&l!=="a"&&m!=="b"?l.charAt(0)==="b"||m.charAt(0)==="a"||l.charAt(0)!=="a"&&m.charAt(0)!=="b"?(h.dirNum=2,j="indented"+(j?" "+j:"")):h.dirNum=1:h.dirNum=1;var n=pg.fUrlSet({schedule:{dirType:h.dirType},hashForMap:""},!0),o=pg.fUrlSet({schedule:{dirType:h.dirType},hashForMap:!0},!0);f[h.dirNum]+="<a href=\"#"+n+"\""+(j?" class=\""+j+"\"":"")+">"+i+"</a>",typeof mobile!="undefined"&&d.directions[h.dirNum].push({hash:n,hashForMap:o,name:i})}}($("ulScheduleDirectionsList")||{}).innerHTML=f[1]+f[2],b||(b=c[0]),pg.schedule.dirType=b.dirType,pg.schedule.dirTypes={},pg.schedule.route=b;var p=pg.schedulePane==2?2:1,q=[];for(var r=1;r<=2;r++){pg.schedule.dirTypes[b.dirType]=p,($("spanDir"+p)||{}).innerHTML=(b.num&&b.num.length<=5?"<span class=\"num num3 "+b.transport+"\" title=\""+i18n.transport[b.transport]+" "+b.num+"\">"+b.numHTML+"</span>":"")+b.name,q=[];var s=null,t=0,u=(b.streets||"").split(",")||[],v,w=null,x,y=pg.schedule.tripNum&&r==1&&!cfg.city.doNotShowTimetables[pg.schedule.transport]?pg.schedule.tripNum:0;y&&(v=typeof b.times==="string"?ti.explodeTimes(b.times):b.times,x=v.workdays.length,w=v.times);var z={};for(g=0;g<b.stops.length;g++){if(g<b.stops.length-1&&b.stops[g]==b.stops[g+1])continue;var A=ti.fGetStopDetails(b.stops[g]);z[A.name]=A.street}for(g=0;g<b.stops.length;g++){if(g<b.stops.length-1&&b.stops[g]==b.stops[g+1])if(typeof cfg=="object"&&cfg.defaultCity!="intercity")continue;var A=ti.fGetStopDetails(b.stops[g]),n=pg.fUrlSet({schedule:{dirType:b.dirType,stopId:A.id,tripNum:y},hashForMap:""},!0),o=pg.fUrlSet({schedule:{dirType:b.dirType,stopId:A.id,tripNum:y},hashForMap:!0},!0);q.push("<dt><a href=\"#"+n+"\" class=\"hover\">");var B=-16;(A.info||"").indexOf("wifi")>=0&&(q.push("<img style=\"margin: -2px 0 0 "+B+"px;\" src=\""+pg.imagesFolder+"stop_wifi.png\" alt=\"wifi stop\" title=\""+i18n.stopHasWiFi+"\" />"),B=0),(A.info||"").indexOf("wc")>=0&&(B<0&&(B=-20),q.push("<img style=\"margin: -2px 2px 0 "+B+"px; width:16px; height:16px; border:solid 1px black;\" src=\""+pg.imagesFolder+"wc.png\" alt=\"wc stop\" title=\""+i18n.stopHasWC+"\" />")),q.push((A.name=="Stotis"&&/[a-zA-Z]/.test(A.id.slice(-1))?"<span style=\"display:inline-block; border-radius:50%; border: 1px solid black; text-align: center; font-size:12px; font-weight:bold; line-height: 13px; background-color:yellow;z-index:999; width:12px; height:12px; margin:0 1px 0 -15px;\">"+A.id.slice(-1).toUpperCase()+"</span>":"")+(w?ti.printTime(w[y-1+g*x],null,"&#x2007;")+"&nbsp;&nbsp;":"")+A.name+(z[A.name]==A.street?"":" ("+A.street+")")+"</a>"),z[A.name]=A.street,cfg.defaultCity=="latvia"&&g<b.stops.length-1&&q.push("<a class=\"draw\" target=\"_blank\" href=\"http://www.stops.lt/latviatest/latvia/editor.html#"+b.stops[g]+","+b.stops[g+1]+"\">draw</a>"),q.push("</dt>");if(typeof mobile!="undefined"&&r==1){var C=w?ti.printTime(w[y-1+g*x],null,"&#x2007;"):"";d.stops.push({hash:n,hashForMap:o,id:A.id,name:A.name,time:C}),d.trip[A.id]={time:C,workdays:v?v.workdays[y-1]:"",previous_trip:v&&y>1&&v.workdays[y-2]==v.workdays[y-1]?y-1:"",next_trip:v&&y<v.workdays.length&&v.workdays[y]==v.workdays[y-1]?y+1:""}}if(r==1&&A.street){while(u[t])++t;u[t]={name:A.street,stops:A.name,hash:n},++t}}($("dlDirStops"+p)||{}).innerHTML=q.join(""),($("dlDirStops"+p)||{style:{}}).style.display="";if(r==2)break;for(t=u.length;--t>=0;)s=u[t],typeof s=="string"&&(s=u[t]={name:s}),s.name.replace(/"/g,"&quote;").replace(/\s/,"&nbsp;"),t+1<u.length&&s.name==u[t+1].name&&(s.stops+=", "+u[t+1].stops,s.hash=s.hash||u[t+1].hash,u[t+1].name=null);var D="";for(t=0;t<u.length;++t)s=u[t],s.name&&(D?D+=", ":D=i18n.routeStreets+": ",s.hash?D+="<a href=\"#"+s.hash+"\" class=\"hover\" title=\""+i18n.stops+": "+s.stops.replace(/"/g,"")+"\">"+s.name+"</a>":D+=s.name,typeof mobile!="undefined"&&d.streets.push(s));($("divScheduleRoute")||{}).innerHTML="<span class=\"icon icon_"+b.transport+"\"></span><span class=\"num num3 "+b.transport+"\">"+b.numHTML+"</span>&nbsp;&nbsp; "+D+"<div class=\"RouteDetails\""+(pg.scheduleDetailsExpanded?"":" style=\"display:none;\"")+">"+(cfg.defaultCity=="vilnius"?"":i18n.operator+": ")+ti.fOperatorDetails(b.operator,b.transport)+"</div>";if(c.length<=1)break;p=3-p;var k=b.dirType.split("-"),l=k[0],m=k[k.length-1],E=m+"-"+l,F=b.dirNum;b=null;for(g=0;g<c.length;g++){if(!b||F==b.dirNum&&F!=c[g].dirNum)b=c[g];if(c[g].dirType===E){b=c[g];break}}typeof mobile!="undefined"&&(d.backDir=l!=m?b:null);if(!b||l==m||cfg.defaultCity=="latvia"){($("aDir2")||{style:{}}).style.display="none",($("dlDirStops2")||{style:{}}).style.display="none";break}}a?a(d):pg.fScheduleStopActivate(),pg.schedule.tripNum||(($("divScheduleBody")||{}).scrollTop=0)}},pg.aDir_Click=function(a){setTimeout(function(){try{a.focus()}catch(b){}},100);var b=$("ulScheduleDirectionsList");(a.id||"").indexOf("2")>=0&&a.offsetLeft>100?(pg.scheduleProposedPane=2,b.style.right="10px",b.style.left=""):(pg.scheduleProposedPane=1,b.style.left=a.offsetLeft+"px",b.style.right=""),b.style.display="block"},pg.aDir_Blur=function(){$("ulScheduleDirectionsList").style.display="none"},pg.ulScheduleDirectionsList_Click=function(a){a=a||window.event;var b=a.target||a.srcElement;if(b.nodeName.toLowerCase()=="a"){var c=b.href.split("#")[1],d=pg.fUrlParse(c);pg.schedulePane=pg.scheduleProposedPane||1,c=pg.fUrlSet({schedule:{dirType:d.schedule.dirType,stopId:null,tripNum:0}},!0),c!=Hash.getHash()?Hash.go(c):pg.fScheduleLoad();return pg.cancelEvent(a)}},pg.fScheduleStops_Click=function(a,b){a=a||window.event;var c=a.target||a.srcElement;if(c.nodeName.toLowerCase()=="a"){pg.schedulePane=b;var d=c.href.split("#")[1],e=pg.fUrlParse(d);pg.fUrlSet({schedule:{dirType:e.schedule.dirType,stopId:e.schedule.stopId,tripNum:e.schedule.tripNum}});return pg.cancelEvent(a)}},pg.fTransferHideMenu=function(){if(pg.transfersMenuHide){var a=$("divTransfersMenu");a.style.display="none"}},pg.fTransfer_MouseOver=function(a){a=a||window.event;var b=a.target||a.srcElement;if(b.id=="divTransfersMenu"||(b.parentNode||{}).id=="divTransfersMenu"||b.id=="checkTransfer"||b.id=="spanCheckTransfer")pg.transfersMenuHide=!1;else{var c=b.getAttribute("data-transport");pg.transfersMenuHide=!0;if(cfg.defaultCity!="tallinna-linn"&&cfg.defaultCity!="riga"&&cfg.defaultCity!="rostov"||typeof b.className!="string"||b.className.indexOf("transfer")<0||!b.href){if(c&&pg.transfersDisplayed){pg.addSchedule=c;var d=!0;if(pg.schedules)for(var e in pg.transfersDisplayed){d=pg.transfersDisplayed[e];if(d&&d.transport==c&&!pg.schedules[e]){d=!0;break}}$("checkTransfer").checked=d!==!0,$("spanCheckTransfer").innerHTML=i18n.transport[c.replace("-remove","")],pg.transfersMenuHide=!1}}else{pg.addSchedule=pg.fUrlParse(b.href).schedule;if(pg.addSchedule){var d=ti.fGetRoutes(pg.addSchedule.city,pg.addSchedule.transport,pg.addSchedule.num,pg.addSchedule.dirType,!0)[0];$("checkTransfer").checked=b.className.indexOf("active")>=0,$("spanCheckTransfer").innerHTML=i18n.transport1[d.transport]+(d.num.length>15?"":" "+d.numHTML)+" "+i18n.towards+" "+d.name,pg.transfersMenuHide=!1}}var f=$("divTransfersMenu");pg.transfersMenuHide?f.style.display=="block"&&pg.fTransfer_MouseOut():(f.style.left=b.offsetLeft+"px",f.style.top=b.offsetTop+b.offsetHeight+"px",f.style.display="block")}},pg.fTransfer_MouseOut=function(){pg.transfersMenuHide=!0,setTimeout(pg.fTransferHideMenu,200)},pg.fScheduleStopActivate=function(){var a="/"+pg.schedule.dirType+"/"+pg.schedule.stopId+"/",b=pg.schedule.dirTypes[pg.schedule.dirType],c;for(var d=1;d<=2;d++){c=$("dlDirStops"+d).getElementsByTagName("a");for(var e=0;e<c.length;++e){var f=c[e],g=(f.className||"").replace("current","");d==b&&a&&pg.schedule.stopId&&("/"+f.href+"/").indexOf(a)>=0?(f.className=g+" current"+ti.fGetDirTag(pg.schedule.dirType),a=""):f.className.indexOf("current")>=0&&(f.className=g)}}if(a){c=$("dlDirStops"+(b||1)).getElementsByTagName("a");if(c&&(c[0]||{}).href){a=c[0].href.split("#")[1],pg.fUrlExecute(a);return}}($("aDir1")||{}).className=($("divScheduleLeft")||{}).className=b==1?"active":"",($("aDir2")||{}).className=($("divScheduleRight")||{}).className=b==2?"active":"",pg.browserVersion>=8&&pg.toggleClass($("divScheduleContentInner"),"Right",b==2),pg.fScheduleLoadTimetable()},pg.fScheduleLoadTimetable=function(a){if(typeof mobile=="undefined"||typeof a!="undefined"){var b,c,d,e=[pg.schedule.city,pg.schedule.transport,pg.schedule.num].join("_"),f=pg.schedules||{};pg.schedules||(f[e]=pg.schedule);var g=pg.nonEmptyCount(f)>(f[e]?1:0),h=ti.fGetTransfersAtStop(pg.schedule.stopId,!0,pg.schedule.route);if(typeof a=="function")var i={workdays:[],timetables:{},timetables_html:[],maxlength:{},transfers:[],transfers_routes:[]};pg.transfersDisplayed={};var j=null,k=null,l=[],m=[];for(d=0;d<h.length;d++){b=h[d],e=ti.toAscii([b.city,b.transport,b.num].join("_"),!0);if(pg.transfersDisplayed[e])continue;var n={id:b.id,city:b.city,transport:b.transport,num:ti.toAscii(b.num,!0),numHTML:b.numHTML,dirType:b.dirType,routeTag:b.stopId,stopId:b.stopId};pg.transfersDisplayed[e]=n;if(pg.city==="druskininkai"||pg.city==="liepaja")parseInt(pg.schedule.num,10)===parseInt(b.num,10)&&pg.schedule.num.toLowerCase().indexOf("s")<0&&b.num.toLowerCase().indexOf("s")<0&&(f[e]=n,g=g||pg.schedule.num!==b.num);else if(pg.city==="xxxklaipeda")if(pg.schedule.num+"e"===b.num.toLowerCase()||pg.schedule.num.indexOf("(")>=0&&pg.schedule.num.replace("(","e(")===b.num.toLowerCase().replace(/\s/g,""))f[e]=n,g=g||pg.schedule.num!==b.num.toLowerCase();c=pg.fUrlSet({schedule:n},!0),j!==b.transport&&(j=b.transport,l.push(" <span class=\"icon icon_narrow icon_"+b.transport+"\" data-transport=\""+b.transport+"\"></span>&nbsp;"));var o="<a class=\"hover "+(f[e]?"activetransfer ":"transfer")+j+"\" href=\"#"+c+"\" title=\""+(b.name||"").replace(/"/g,"")+"\">"+h[d].numHTML.replace(/\s/g,"&nbsp;")+"</a> ";typeof a=="function"&&(i.transfers.push(c),i.transfers_routes.push(b)),l.push(o),f[e]&&(k!==b.transport&&(k=b.transport,o=" <span class=\"icon icon_narrow icon_"+b.transport+"\" data-transport=\""+b.transport+"-remove\"></span>&nbsp;"+o),m.push(o),f[e].stopId=b.stopId)}l.push("<span style=\"display:inline-block; width:2px;\"></span>");var p=ti.fGetStopDetails(pg.schedule.stopId),q=(p.street?", "+p.street:"")+(p.area&&!cfg.cities[pg.city].skipStopArea?", "+p.area:"")+(p.city&&!cfg.cities[pg.city].skipStopCity?", "+p.city:"");p[cfg.cities[pg.city].stopFareZone||"noFareZone"]&&(q+=", "+i18n.fareZone+" "+p[cfg.cities[pg.city].stopFareZone]),q=q.length>0?"<span class=\"details\"> ("+q.substring(2)+")</span>":"",($("divScheduleStop")||{}).innerHTML="<span class=\"stop-name\">"+i18n.stop+"</span><strong> "+p.name+"</strong>"+q+"&nbsp;&nbsp; "+l.join("");if(p.street){var r=p.street.replace(/"/g,"&quote;").replace(/\s/,"&nbsp;"),s=$("divScheduleRoute")&&$("divScheduleRoute").getElementsByTagName("a");if(s)for(d=s.length;--d>=0;)s[d].innerHTML.indexOf(r)<0?s[d].className=="hover strong"&&(s[d].className="hover"):s[d].className="hover strong"}var t=[],u=0,v=Number.POSITIVE_INFINITY,w=0,x=cfg.city.doNotMergeTimetables;pg.schedule.stopId!=pg.schedule.route.stops[0]&&cfg.city.doNotShowTimetables&&cfg.city.doNotShowTimetables[pg.transport]&&(f=null);for(var e in f){var n=f[e];if(!n||!n.stopId)continue;if(!pg.transfersDisplayed[e])continue;var y=ti.fGetStopDetails(n.stopId),z={},A=(y||{raw_data:""}).raw_data.split(";"),B=n.dirType.split("-"),C=B[0],D=B[B.length-1],E=2;C==="a"||D==="b"?E=1:C.charAt(0)!=="b"&&D.charAt(0)!=="a"&&(C.charAt(0)==="a"||D.charAt(0)==="b")&&(E=1);var F=ti.toAscii(pg.schedule.route.name,!0);for(var d=ti.FLD_DIRS;d<A.length;d+=2){b=ti.fGetRoutes(A[d]);if(b.city===n.city&&b.transport===n.transport&&ti.toAscii(b.num,!0)===n.num&&b.times&&(!pg.schedule.route.routeTag||pg.schedule.route.routeTag=="0"&&!b.routeTag||b.id===pg.schedule.route.id||ti.toAscii(b.name,!0)===F)){B=b.dirType.split("-"),C=B[0],D=B[B.length-1],D=D.split("_")[0];var G=2;C==="a"||D==="b"?G=1:C.charAt(0)!=="b"&&D.charAt(0)!=="a"&&(C.charAt(0)==="a"||D.charAt(0)==="b")&&(G=1);if(E!==G)continue;if(!g&&cfg.defaultCity=="siauliai"&&F!=ti.toAscii(b.name,!0)&&B.length==2&&"aba".indexOf(C+D)>=0)continue;if(z[b.id])continue;z[b.id]=!0,b.tag=(!g&&b.dirType!=pg.schedule.dirType&&ti.toAscii(b.name,!0)!==F?"other":"current")+ti.fGetDirTag(b.dirType);if(b.tag=="current"||b.tag=="other"&&C.charAt(0)=="d")b.tag="";(pg.city==="druskininkai"||pg.city==="liepaja")&&pg.schedule.num===b.num&&(b.tag=""),pg.city==="klaipeda"&&(b.transport==="expressbus"||b.num.substring(b.num.length-1).toLowerCase()==="e"||b.num.toLowerCase().indexOf("e (")>0)&&(b.tag="express");var H=typeof b.times==="string"?ti.explodeTimes(b.times):b.times,I=H.workdays,J=H.tag,K=H.times,L=+A[d+1];b.stops[L]==b.stops[L+1]&&++L;var M=I.length,N=M;for(var O=M+L*M;N--;){var P=K[--O];v>P&&P>=0&&(v=P),w<P&&P>=0&&(w=P);var Q=b.tag,R=!1,S=!1;J.charAt(N)==="1"?Q=(Q?Q+" ":"")+"highlighted":J.charAt(N)==="3"?(Q=(Q?Q+" ":"")+"highlighted",R=!0):J.charAt(N)==="4"?(Q=(Q?Q+" ":"")+"smallbus",S=!0):J.charAt(N)==="2"&&(R=!0,pg.city=="druskininkai"&&(Q=(Q?Q+" ":"")+"highlighted")),pg.schedule.tripNum&&b.dirType===pg.schedule.dirType&&pg.schedule.tripNum-1==N&&(Q=(Q?Q+" ":"")+"clicked");if(x)t[u++]={time:P,workday:I[N],route:b,tag:Q,bicycle:R,small_capacity:S,tripNum:N};else for(var T=1;T<=7;T++)I[N].indexOf(T)>=0&&(t[u++]={time:P,workday:T,route:b,tag:Q,bicycle:R,small_capacity:S,tripNum:N})}}}}t.sort(function(a,b){if(a.workday<b.workday)return-1;if(a.workday>b.workday)return 1;if(a.time<b.time)return-1;if(a.time>b.time)return 1;if(a.route.id<b.route.id)return-1;if(a.route.id>b.route.id)return 1;return 0});var U="";$("divScheduleRoute")&&(g&&(U="<div class=\"selectedNumbers\" style=\"width:100%; margin-top:10px;\">"+m.join(" &nbsp;")+" &nbsp;<label id=\"labelShowDeparturesWithNumbers\" for=\"showDeparturesWithNumbers\"><input name=\"showDeparturesWithNumbers\" id=\"showDeparturesWithNumbers\" type=\"checkbox\" value=\"showDeparturesWithNumbers\""+(pg.showDeparturesWithNumbers?" checked=\"checked\"":"")+" onclick=\"pg.fToggleNumbersAtDepartures();\" />"+i18n.showDeparturesWithRouteNumbers+"</label></div>")),l=[];if(t.length){var V,W=v=~~(v/60)-1,w=~~(w/60),X=[],Y=[],Z;for(d=0,O=t.length;d<=O;d++){if(d>0&&(d===O||t[d].workday!=t[d-1].workday)){var Z=l.join(";"),M=t[d-1].workday;for(kk=1;kk<=7;++kk)if(X[kk]===Z){Y[kk]+=M;break}kk>7&&(X[M]=Z,Y[M]=""+M);if(d===O)break;l=[]}Z=t[d];var b=Z.route;l.push(Z.time,b.city,b.transport,b.num,b.dirType)}l=[];for(d=0,O=t.length;d<=O;d++){if(d<O){Z=t[d];if(x)Y[Z.workday]=Z.workday;else if(!Y[Z.workday])continue}if(d>0&&(d===O||Z.workday!=t[d-1].workday)){W!=-999&&l.push("</td></tr>");if(cfg.defaultCity==="tallinna-linn")for(var _=0;_<w-W;_++)l.push("<tr><th>—</th><td></td></tr>");l.push("</tbody></table>"),U+=l.join(""),typeof a=="function"&&i.timetables_html.push(l.join("")),l=[];if(d===O)break}if(d==0||Z.workday!=t[d-1].workday){W=v;var ba=pg.fWeekdaysName(Y[t[d].workday],pg.transport);ba.length>20&&(ba=ba.replace(",",",<br/>")),l.push("<table class=\"table table-bordered timetable ","days-",Y[t[d].workday],"\" cellspacing=\"0\" cellpadding=\"0\"><tbody><tr><th></th><th class=\"workdays\">"+ba+"</th></tr>"),typeof a=="function"&&(i.workdays.push(Y[t[d].workday]),i.timetables[Y[t[d].workday]]=[],i.maxlength[Y[t[d].workday]]=0)}var bb=Z.time;if(bb<0)continue;var bc=~~(bb/60);bb=bb%60;if(W!==bc){if(W!=v){l.push("</td></tr>");while(++W<bc)l.push("<tr><th>&mdash;</th><td></td></tr>")}else while(++W<bc)l.push("<tr><th>"+(cfg.defaultCity==="tallinna-linn"?"&mdash;":"&nbsp;")+"</th><td></td></tr>");W=bc,l.push("<tr><th>"+bc%24+"</th><td"+(g?" style=\"white-space:normal;\"":"")+">"),typeof a=="function"&&i.timetables[Y[t[d].workday]].push({hour:bc%24,minutes:[]})}var bd=Z.route;c=pg.fUrlSet({schedule:{city:bd.city,transport:bd.transport,num:bd.num,dirType:bd.dirType,stopId:bd.stopId,tripNum:Z.tripNum+1}},!0);var be=bd.numHTML;if(cfg.defaultCity==="tallinna-linn"&&be.length>5){var bf=be.indexOf(" ");bf!=-1&&(be=be.substring(0,bf)+"*")}l.push("<a href=\"#"+c+"\" title=\""+(g?i18n.transport1[bd.transport]+(bd.num.length>15?"":" "+bd.numHTML)+" "+i18n.towards+" ":"")+bd.name.replace(/"/g,"")+"\""+(Z.tag?"class=\""+Z.tag+"\"":"")+">"+(bb<10?"0":"")+bb+(g?"<span class=\"departure"+bd.transport+"\">"+(cfg.defaultCity==="tallinna-linn"?"":"\\")+be+"</span>":"")+(Z.bicycle?"<img class=\"icon\" style=\"margin:0 1px;\" src=\""+pg.imagesFolder+"bicycle.png\">":"")+(g&&cfg.defaultCity!="tallinna-linn"?"</a>&#x200A;":"</a>"));if(typeof a=="function"){var bg=i.timetables[Y[t[d].workday]],bh=bg[bg.length-1];bh.minutes.push({hash:c,min:bb,title:g?i18n.transport1[bd.transport]+(bd.num.length>15?"":" "+bd.num)+" "+i18n.towards+" ":"",classname:Z.tag||"",bicycle:Z.bicycle,small_capacity:Z.small_capacity}),bh.minutes.length>i.maxlength[Y[t[d].workday]]&&(i.maxlength[Y[t[d].workday]]=bh.minutes.length)}}}if(pg.schedule.route&&pg.schedule.route.transport){b=pg.schedule.route,l=[];var bi=cfg.city["notes_"+b.transport+"_"+b.num.toLowerCase()]||cfg.city["notes_"+b.operator]||cfg.city["notes_"+b.transport];bi&&(typeof a=="function"&&(i.notes=bi),U="<div style=\"margin-top:10px; clear:both;\">"+(bi[pg.language]||bi.en||bi)+"</div>"+U),bi=cfg.city.skipOperator?"":ti.fOperatorDetails(b.operator,b.transport),bi&&l.push("<p class=\"noindent\">"+(cfg.defaultCity=="vilnius"?"":"<strong>"+i18n.operator+":</strong> ")+bi+"</p>"),bi=(cfg.operators[b.operator]||cfg.operators[b.transport]||cfg.operators[b.transport+"_"+b.num]||{notes:""}).notes,bi&&(bi=bi[pg.language]||bi.en||bi,bi=bi.replace("%operator",b.operator),l.push("<p>"+bi+"</p><br /><br /><p>")),f&&(l.push("<p class=\"noindent\"><strong>"+i18n.scheduleCommentsInfo+":</strong>"),U.indexOf("bicycle")>=0&&l.push("<p>"+(i18n["transferBicyclesDepartures_"+cfg.defaultCity]||i18n.transferBicyclesDepartures||"").replace("&#128690;","<img class=\"icon\" style=\"margin:0;\" src=\""+pg.imagesFolder+"bicycle.png\">")),bi=(cfg.operators[b.operator]||cfg.operators[b.transport]||{comments:""}).comments,bi?l.push("<p>"+(bi[pg.language]||bi.en||bi).replace("%operator",b.operator)+"</p>"):(i18n.scheduleDelaysWarning&&i18n.scheduleDelaysWarning.length>10&&l.push("<p>"+i18n.scheduleDelaysWarning),l.push("<p>"+i18n.scheduleComments)),U.indexOf("smallbus")>=0&&l.push("<p>"+i18n.smallBus12Departures),U.indexOf("highlighted")>=0&&l.push("<p>"+(cfg.defaultCity==="tallinna-linn"?i18n.lowFloorDepartures2:i18n.lowFloorDepartures)),U.indexOf("other")>=0&&l.push("<p>"+(cfg.defaultCity==="tallinna-linn"?i18n.scheduleChangedDepartures2:i18n.scheduleChangedDepartures)),bi=cfg.city.scheduleFooter,bi&&(bi=bi[pg.language]||bi.en||bi,bi=bi.replace("%operator",b.operator),l.push("<p>"+bi))),($("divScheduleContentBottom")||{}).innerHTML=l.join("</p>")+"</p>"}pg.replaceHtml($("divScheduleContentInner"),U+"<div style=\"clear:both;\"></div>"),a&&a(i)}},pg.fCheckTransfer_Click=function(){if(!pg.addSchedule)return!1;$e=$("checkTransfer");var a;pg.schedules||(a=[pg.schedule.city,pg.schedule.transport,pg.schedule.num].join("_"),pg.schedules={},pg.schedules[a]=pg.schedule);if(typeof pg.addSchedule=="object")a=ti.toAscii([pg.addSchedule.city,pg.addSchedule.transport,pg.addSchedule.num].join("_")),pg.schedules[a]=$e.checked?pg.addSchedule:null;else{pg.addSchedule=(pg.addSchedule||"").replace("-remove","");for(var a in pg.transfersDisplayed){var b=pg.transfersDisplayed[a];b.transport==pg.addSchedule&&(pg.schedules[a]=$e.checked?b:null)}}pg.fScheduleLoadTimetable();return},pg.fToggleNumbersAtDepartures=function(){pg.showDeparturesWithNumbers=$("showDeparturesWithNumbers").checked,pg.toggleClass($("divScheduleContentInner"),"HideNumbers",!pg.showDeparturesWithNumbers)},pg.fWeekdaysName=function(a,b){var c="";pg.schedule&&pg.schedule.route&&(pg.schedule.route.weekdays||"").indexOf("!")>=0&&(a||"").indexOf("7")>=0&&(c="notfestal"),a=="1234"&&cfg.isMobilePage&&!i18n["weekdays1234"]&&(i18n.weekdays1234=i18n.weekdays1+"-"+i18n.weekdays4);var d=i18n[b+"weekdays"+a+c]||i18n[b+"weekdays"+a]||i18n["weekdays"+a+c]||i18n["weekdays"+a]||"";if(d)return d;var e=a.split("");d;for(var f=e.length;--f>=0;)d=e[f],e[f]=i18n[b+"weekdays"+d+c]||i18n[b+"weekdays"+d]||i18n["weekdays"+d+c]||i18n["weekdays"+d]||d;d=e.join(", ");return d},pg.inputSuggestedStops_Focus=function(a){pg.sisp&&(($("star-popup")||{style:{}}).style.display="none"),pg.inputActive!==a&&(pg.inputActive=a,pg.stopsSuggestedForText=pg[pg.inputActive.id]?pg.inputActive.value:null);if(pg.inputActive.className==="empty"||pg.inputActive.value==i18n.mapPoint||pg.inputActive.value=="Point on map"||pg.inputActive.value==i18n.myLocation||pg.inputActive.value=="My location")pg.inputActive.className="",pg.inputActive.value="",typeof pg.updateStopInputValue=="function"&&pg.updateStopInputValue(pg.inputActive);pg.timerSuggestedStopsShow===!1?pg.timerSuggestedStopsShow=0:(pg.fSuggestedStopsShow(!0),pg.timerSuggestedStopsShow===0&&(pg.timerSuggestedStopsShow=setInterval(pg.fSuggestedStopsShow,200)))},pg.inputSuggestedStops_Blur=function(a){if(!document.activeElement||document.activeElement.id!="divSuggestedStops")pg.timerSuggestedStopsShow&&clearInterval(pg.timerSuggestedStopsShow),pg.timerSuggestedStopsShow=0,a&&!a.value&&(a.value=a.id=="inputFinish"?i18n.finishStop:a.id=="inputStopFilter"?"":i18n.startStop,typeof pg.updateStopInputValue=="function"&&pg.updateStopInputValue(a),a.className="empty",pg.sisp&&(a.id=="inputStart"?pg.starClear("start"):a.id=="inputFinish"&&pg.starClear("finish"))),pg.timerSuggestedStopsHide||(pg.timerSuggestedStopsHide=setTimeout(function(){pg.timerSuggestedStopsHide=0,a&&a.id=="inputStop"&&a.value!=pg.inputStopText&&((!pg.sisp||!pg.tablo)&&pg.fSuggestedStopsSelectFirst(a)),pg.timerSuggestedStopsShow||pg.fSuggestedStopsHide()},200))},pg.divSuggestedStops_Blur=function(){(!document.activeElement||!pg.inputActive||document.activeElement.id!==pg.inputActive.id)&&pg.inputSuggestedStops_Blur(pg.inputActive)},pg.fSuggestedStopsShow=function(a,b){if(pg.inputActive){var c=pg.inputActive.value||"";pg.sisp&&pg.tablo&&pg.inputActive.id=="inputStop"&&(c?pg.inputActive.parentNode.classList.add("active"):pg.inputActive.parentNode.classList.remove("active"));var d=$("divSuggestedStops");if(a!==!0&&pg.stopsSuggestedForText===c&&d.style.display==="block")return;if(a!==!0&&pg.stopLastTyped!==c){pg.stopLastTyped=c;return}if(pg.stopsSuggestedForText!=c&&pg.inputStopText!=pg.stopSuggestedForMap)if(!pg.sisp||!pg.tablo)pg[pg.inputActive.id]="";pg.stopLastTyped=c,typeof ti.stops==="object"&&(pg.stopsSuggestedForText=c);var e=[];if(pg.sisp){var f=typeof favourites!="undefined"?favourites.getLabels():[];f.length&&(e.push("<span style=\"display:block; padding-left:10px;line-height:26px;\"><b>"+(i18n.favourites||(pg.language=="en"?"My labels":"Mano asmenžymės"))+":</b></span>"),f.forEach(function(a){var b=a.key,c=a.label,d=ti.fGetAnyStopDetails(b),f=[];d.city&&!cfg.cities[pg.city].skipStopCity&&f.push(d.city),d.area&&!cfg.cities[pg.city].skipStopArea&&f.push(d.area),d.streets&&f.push(d.streets),f=f.length>0?"<span class=\"details\"> ("+d.name+")</span>":"",f="<a id=\""+b+"\" href=\"\" onclick=\"return false;\"><span class=\"icon icon_map\" title=\""+i18n.showInMap+"\"></span><span class=\"star-favourite\"></span>"+(c.name||"").substring(0,30)+f+"</a>",e.push(f)}));var g=pg.getStopsNearBy(3);g.length&&(e.push("<span style=\"display:block; padding-left:10px;line-height:26px;\"><b>"+(i18n.stopsNearBy||(pg.language=="en"?"Stops nearby":"Stotelės netoliese"))+":</b></span>"),g.forEach(function(a){var b=[];a.city&&!cfg.cities[pg.city].skipStopCity&&b.push(a.city),a.area&&!cfg.cities[pg.city].skipStopArea&&b.push(a.area),a.streets&&b.push(a.streets),b=b.length>0?"<span class=\"details\"> ("+b.join(", ")+")</span>":"",pg.sisp&&a.towards&&(b="<span class=\"details\">"+a.towards+"</span>"),b="<a id=\""+a.id+"\" href=\"\" onclick=\"return false;\"><span class=\"icon icon_map\" title=\""+i18n.showInMap+"\"></span>"+a.name+b+(typeof a.distance=="number"?"<span class=\"distance\">"+a.distance+" m</span>":"")+(pg.sisp&&a.transfers?pg.detailsTransfers2(a.transfers):"")+"</a>",e.push(b)}))}if(e.length||c.length>=2&&typeof ti.stops=="object"){b=b||(c.length>1?ti.fGetStopsByName(pg.stopSuggestedForMap||c):[]);if(b.length==0){if(!pg.inputActive||pg.inputActive.id!="inputLocation")c.length&&e.push("<a id=\"aMoreChars\" href=\"\" onclick=\"return false;\"><span class=\"icon icon_info\"></span>"+i18n.noStopsFound+"</a>")}else{e.push("<span style=\"display:block; padding-left:10px;line-height:26px;\"><b>"+i18n.stops+":</b></span>");var h=","+pg[pg.inputActive.id]+",";for(var i=0;i<b.length;i++){var j=b[i],k=[];j.city&&!cfg.cities[pg.city].skipStopCity&&k.push(j.city),j.area&&!cfg.cities[pg.city].skipStopArea&&k.push(j.area),j.streets&&k.push(j.streets),k=k.length>0?"<span class=\"details\"> ("+k.join(", ")+")</span>":"",pg.sisp&&j.towards&&(k="<span class=\"details\">("+j.towards+")</span>"),k="<a id=\""+j.id+"\" href=\"\" onclick=\"return false;\"><span class=\"icon icon_map\" title=\""+i18n.showInMap+"\"></span>"+(h.indexOf(","+j.id+",")>=0?"<strong>"+j.name+"</strong>":j.name)+k+(typeof j.distance=="number"?"<span class=\"distance\">"+j.distance+" m</span>":"")+(pg.sisp&&j.transfers?pg.detailsTransfers2(j.transfers):"")+"</a>",!1&&h.indexOf(","+j.id+",")>=0?e.splice(0,0,k):e.push(k)}}}else{if(pg.sisp&&!g.length)return;pg.sisp||e.push("<a id=\"aMoreChars\" href=\"\" onclick=\"return false;\"><span class=\"icon icon_info\"></span>"+(typeof ti.stops!="object"?i18n.receivingData:i18n.typeSomeChars)+"</a>")}pg.geocoder||ti.fCreateGeocoder();if(c.length>=3&&pg.geocoder){var l=$("geocaching-results");l?e.push("<div id=\"geocaching-results\">"+l.innerHTML+"</div>"):e.push("<div id=\"geocaching-results\"><span style=\"display:block; padding-left:10px;line-height:26px;\"><b>"+i18n.addressesAndPlaces+":</b><br/>"+i18n.loading+"</span></div>")}e.push("<a id=\"aSuggestShowMap\" href=\"\" onclick=\"return false;\"><span class=\"icon icon_stops\"></span>"+i18n.selectFromMap+"</a>"),typeof mobile!="undefined"&&mobile.kautra&&e.pop(),(d||{}).innerHTML=e.join("");if(c&&c.length>=3)if(!!1||typeof mobile=="undefined")if(pg.inputActive.id=="inputStop"||pg.inputActive.id=="inputStopFilter"){var l=$("geocaching-results");l&&(l.style.display="none")}else pg.geocoder&&pg.geocoder.search(c,function(a){var b=$("geocaching-results");if(b){var c="";a.length?c="<span style=\"display:block; padding-left:10px;line-height:26px;\"><b>"+i18n.addressesAndPlaces+":</b></span>":c="<a id=\"aMoreChars\" href=\"\" onclick=\"return false;\"><span class=\"icon icon_info\"></span>"+i18n.noAddressesAndPlacesFound+"</a>";for(var d=0;d<a.length;d++){var e=a[d];if(e.key||e.id)c+="<a "+(e.key?"data-key=\""+e.key+"\"":"id=\""+e.id+"\"")+" onclick=\"return false;\" href=\"\"><span class=\"icon icon_map\" title=\""+i18n.showInMap+"\"></span>"+e.name+"</a>"}b.innerHTML=c,b.style.display="block"}});if(d&&pg.inputActive.offsetHeight){var m=$("divContentWrapper")||{offsetLeft:0,offsetTop:0},n=pg.inputActive.offsetLeft,o=pg.inputActive.offsetTop+pg.inputActive.offsetHeight+1;pg.sisp&&(o-=1,pg.inputActive.id==="inputStop"&&(o+=2)),getComputedStyle(pg.inputActive.parentNode).position=="relative"&&(n+=pg.inputActive.parentNode.offsetLeft,o+=pg.inputActive.parentNode.offsetTop),$("tblContentPlannerOptions")&&pg.inputActive.id!=="inputStop"&&(m.offsetLeft===0||n<m.offsetLeft||cfg.searchOnly)&&(o+=$("tblContentPlannerOptions").offsetTop,n+=$("tblContentPlannerOptions").offsetLeft),pg.inputActive.id==="inputStop"&&m.offsetLeft===0&&!pg.tablo&&(o=0),pg.inputActive.id!=="inputStop"&&n<m.offsetLeft&&(n+=m.offsetLeft,o+=m.offsetTop),typeof mobile!="undefined"&&mobile.tallinn&&(o=120,pg.inputActive.id=="inputFinish"&&(o+=35));if(typeof mobile!="undefined"&&mobile.kautra){var p=jQuery(pg.inputActive).offset();o=p.top+40,n=p.left,d.style.width=jQuery(pg.inputActive).width()+"px"}typeof mobile=="undefined"&&cfg.defaultCity=="tallinna-linn"&&typeof jQuery!="undefined"&&(o=jQuery("#planner .plan-stations").position().top+20+40,pg.inputActive.id=="inputFinish"?(o+=38,d.classList.add("finish"),d.classList.remove("start")):(d.classList.add("start"),d.classList.remove("finish")),n=pg.hashForMap?120:300),pg.sisp&&pg.inputActive.id=="inputStopFilter"&&(o=58),d.style.top=o+"px",d.style.left=n+"px"}pg.inputActive.offsetWidth>2&&(typeof mobile=="undefined"||mobile.kautra?(d.style.minWidth=pg.inputActive.offsetWidth-2+"px",pg.sisp&&(pg.inputActive.id=="inputStart"||pg.inputActive.id=="inputFinish")&&(d.style.width=pg.inputActive.offsetWidth-2+"px"),pg.transport=="home"&&(d.style.width=pg.inputActive.offsetWidth+"px")):d.style.right=window.innerWidth-(pg.inputActive.offsetWidth+n)+"px"),d.scrollTop=0,d.style.overflowX="hidden";if(pg.sisp&&pg.widget)d.style.overflowY="auto";else if(typeof mobile!="object"||!mobile.kautra)d.style.overflowY=e.length>6?"scroll":"hidden";d.style.height=e.length>6&&!pg.sisp?"156px":"auto",d.style.display="block"}},pg.fSuggestedStopsHide=function(){pg.stopSuggestedForMap="",$("divSuggestedStops").style.display!="none"&&($("divSuggestedStops").style.display="none")},pg.divSuggestedStops_MouseDown=function(a){var b=a&&(a.target||a.srcElement);if(b&&(b.id==="divSuggestedStops"||b.id==="geocaching-results"))return!1;return!0},pg.eSuggestedStops_Click=function(a){pg.timerSuggestedStopsHide&&(clearTimeout(pg.timerSuggestedStopsHide),pg.timerSuggestedStopsHide=0);var b=a&&(a.target||a.srcElement);if(b&&(b.id==="divSuggestedStops"||b.id==="geocaching-results"))return!1;var c=b&&(b.className||"").toLowerCase(),d=b.getAttribute("data-key");if(b&&!b.id&&!d){b=b.parentNode;var d=b.getAttribute("data-key")}if(!b)return pg.cancelEvent(a);function e(b,c){if(c&&c.indexOf("map")>=0){pg.inputStopText=pg.stopSuggestedForMap=pg.stopSuggestedForMap||pg.stopsSuggestedForText;if(pg.transport=="plan"){var d;pg.inputActive.id==="inputStart"?(pg.mapCenterTo={type:"start",id:b},pg.loadedPlannerParams="clear start",d="plan/"+b+"/"+(pg.inputFinish||"")):(pg.mapCenterTo={type:"finish",id:b},pg.loadedPlannerParams="clear finish",d="plan/"+(pg.inputStart||"")+"/"+b),Hash.go(d+"/map")}else Hash.go("stop/"+b+"/map");setTimeout(function(){try{pg.inputActive.focus()}catch(a){}},100)}if(b&&b.indexOf("ShowMap")>=0){pg.fSuggestedStopsHide(),pg.fUrlSetMap({});return pg.cancelEvent(a)}if(b&&b.indexOf("MoreChars")<0&&(c||"").indexOf("icon_map")<0){if(b.charAt(0)!="@"){var e=ti.fGetAnyStopDetails(b),f=e.name;if(pg.sisp){var g=favourites.getLabel(b);g&&(f=g.name+" ("+e.name+")")}pg.inputActive.value=f,typeof pg.updateStopInputValue=="function"&&pg.updateStopInputValue(pg.inputActive),pg.inputActive.className="",pg.stopsSuggestedForText=e.name,pg[pg.inputActive.id]=b,pg.fSuggestedStopsHide(),pg.timerSuggestedStopsShow=!1,pg.inputSuggestedStops_KeyDown(null,-13)}}else{try{pg.inputActive.focus()}catch(h){}pg[pg.inputActive.id]=""}}d?pg.geocoder.getPlaceId(d,function(a){e(a,c)}):b.id!=="divSuggestedStops"&&e(b.id,c);return pg.cancelEvent(a)},pg.inputKeyTab=function(a){var b=window.event?window.event.keyCode:a.keyCode;b==9&&pg.inputSuggestedStops_KeyDown(null,13)},pg.inputSuggestedStops_KeyDown=function(a,b){pg.stopSuggestedForMap="",b||(b=window.event?window.event.keyCode:a.keyCode);b==27?(pg.timerSuggestedStopsShow&&clearInterval(pg.timerSuggestedStopsShow),pg.timerSuggestedStopsShow=0,pg.fSuggestedStopsHide()):b==13||b==-13||b==-13?(pg.timerSuggestedStopsShow&&clearInterval(pg.timerSuggestedStopsShow),pg.timerSuggestedStopsShow=0,b==13&&pg.fSuggestedStopsSelectFirst(),pg[pg.inputActive.id]&&pg.fSuggestedStopsHide(),pg.inputActive.id==="inputStop"||pg.inputActive.id==="inputLocation"?pg[pg.inputActive.id]&&pg.fTabStop_Click(pg[pg.inputActive.id]):pg.inputActive.id==="inputStopFilter"?pg.sispTransportFilter(pg.inputStopFilter):(pg.loadedPlannerParams!=pg.inputStart+"/"+pg.inputFinish&&(pg.loadedPlannerParams="clear results"),pg.fTabPlanner_Click(pg.inputStart,pg.inputFinish),pg.inputActive.id==="inputStart"&&pg.inputStart&&!pg.inputFinish?setTimeout(function(){try{$("inputFinish").focus()}catch(a){}},100):pg.inputActive.id==="inputFinish"&&pg.inputFinish&&!pg.inputStart?setTimeout(function(){try{$("inputStart").focus()}catch(a){}},100):pg.inputStart&&pg.inputFinish&&setTimeout(function(){try{$("buttonSearch").focus()}catch(a){}},100))):b!=9&&(pg.inputActive.className=="empty"&&(pg.inputActive.value="",typeof pg.updateStopInputValue=="function"&&pg.updateStopInputValue(pg.inputActive),pg.inputActive.className=""),pg.fSuggestedStopsShow(),pg.timerSuggestedStopsShow||(pg.timerSuggestedStopsShow=setInterval(pg.fSuggestedStopsShow,200)))},pg.fSuggestedStopsSelectFirst=function(a){a=a||pg.inputActive;if(a){pg[a.id]="";if(a.value&&a.value.length>=2){var b=ti.fGetStopsByName(a.value);b.length>0&&(a.value!=b[0].name&&(a.value=b[0].name,typeof pg.updateStopInputValue=="function"&&pg.updateStopInputValue(a)),pg.stopsSuggestedForText=b[0].name,pg[a.id]=b[0].id,a.id==="inputStop"&&pg.fLoadDepartingRoutes())}}},pg.switchStops=function(a){var b=pg.inputStart;pg.inputStart=pg.inputFinish,pg.inputFinish=b,pg.fLoadPlannerTab(),a&&pg.inputStart&&pg.inputFinish&&pg.fUrlSet({transport:"plan",inputStart:pg.inputStart,inputFinish:pg.inputFinish,hashForMap:pg.hashForMap&&"map"});if(cfg.isVilniusAirport)if(pg.inputFinish=="2613"&&pg.inputStart=="2613"){var c=$("inputStart"),d=$("inputFinish");c.getAttribute("disabled")&&(c=$("inputFinish"),d=$("inputStart")),c.setAttribute("disabled","disabled"),d.removeAttribute("disabled")}else pg.inputFinish=="2613"?($("inputFinish").setAttribute("disabled","disabled"),$("inputStart").removeAttribute("disabled")):pg.inputStart=="2613"&&($("inputStart").setAttribute("disabled","disabled"),$("inputFinish").removeAttribute("disabled"));return!1},pg.fTabStop_Click=function(a){pg.fUrlSet({transport:"stop",inputStop:a||pg.inputStop,hashForMap:pg.hashForMap&&"map"});return!1},pg.fTabPlanner_Click=function(a,b){pg.fUrlSet({transport:"plan",inputStart:a||pg.inputStart||pg.inputStop,inputFinish:b||pg.inputFinish,hashForMap:pg.hashForMap&&"map"});return!1},pg.fTabActivate=function(){var a=pg.city+"_"+pg.transport;pg.transport||(a="city",cfg.cities[pg.city]&&pg.city!==pg.fGetCity(pg.city)&&(a="region"));var b=$("divNav")&&$("divNav").getElementsByTagName("a");if(b)for(var c=b.length;--c>=0;)b[c].id===a?b[c].className="active":b[c].className.indexOf("active")>=0&&(b[c].className="");($("dt_stop")||{}).className=pg.transport==="stop"?"active":"";if(pg.transport==="stop")(cfg.defaultCity=="tallinna-linn"||pg.loadedDepartingRoutes!==pg.inputStop)&&setTimeout(pg.fLoadDepartingRoutes,10);else if(pg.transport==="plan"){typeof mobile=="undefined"&&(($("plan")||{}).className="active"),pg.loadedPlannerParams!==pg.inputStart+"/"+pg.inputFinish&&setTimeout(pg.fLoadPlannerTab,10);var d=""+(($("inputTime")||{}).value||"");d.trim()===""&&(d=ti.dateToMinutes(new Date)%1440,($("inputTime")||{}).value=ti.printTime(d))}else if(!pg.loadedRoutesHash||pg.loadedRoutesHash.indexOf(pg.city+"/"+pg.transport+"/")!=0)($("inputRoutes")||{}).value=pg.routesFilter="",pg.inputRoutes_Blur(),pg.fLoadRoutesList();($("divContentRoutes")||{style:{}}).style.display=pg.transport==="stop"||pg.transport==="plan"||pg.transport==="favourites"||pg.transport==="contacts"||pg.transport==="help"?"none":"block",($("divContentDepartingRoutes")||{style:{}}).style.display=pg.transport==="stop"?"block":"none",($("divContentPlanner")||{style:{}}).style.display=pg.transport==="plan"?"block":"none"},pg.footerHTML=function(){var a=["<div class=\"footer-info\">"],b=cfg.cities[pg.city].footer;b=b&&(b[pg.language]||b.en),b&&a.push(b);if(!cfg.isMobilePage){cfg.programmedBy&&a.push("<p id=\"programmedBy\" class=\"smalltext graytext\">"+(cfg.programmedBy[pg.language]||cfg.programmedBy.en||"")+"</p>");var c=cfg.cities[cfg.defaultCity].webcounter;c&&(a.push("<a id=\"webcounter\" href=\"http://whos.amung.us/stats/"+c+"\" target=\"_blank\" style=\"float:right; position:relative; bottom:20px; padding:10px;\">"),a.push("<img width=\"80\" height=\"15\" border=\"0\" title=\"web tracker\" alt=\"web tracker\" src=\"//whos.amung.us/swidget/"+c+".gif\"></a>"))}a.push("</div>");return a.join("")},pg.fLoadRoutesList=function(a){if(typeof mobile=="undefined"||typeof a!="undefined"){var b=$("divContentRoutesResults");if(typeof ti.routes!=="object"){pg.loadedRoutesHash="",(b||{}).innerHTML="<br/>"+i18n.receivingData,setTimeout(function(){pg.fLoadRoutesList(a)},200);return}var c=$("inputRoutes")&&($("inputRoutes").className=="empty"?"":ti.toAscii($("inputRoutes").value,2));if(c&&pg.routesFilter!=c){pg.routesFilter=c,setTimeout(function(){pg.fLoadRoutesList(a)},200);return}pg.routesFilter=c;if(pg.loadedRoutesHash==pg.city+"/"+pg.transport+"/"+c&&typeof mobile=="undefined"&&pg.transport!="favourites"&&pg.transport!="home")return;pg.loadedRoutesHash=pg.city+"/"+pg.transport+"/"+c;var d=ti.fGetRoutes(pg.city,pg.transport,null,null,null,c||(cfg.city.showAllDirections?"*":""));a&&a(d);if(!d||!d.length){(b||{}).innerHTML="<br/>&nbsp;"+i18n.noRoutesFound;return}var e=function(){var a=[];a.push("<table id=\"tblRoutes\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\"><tbody>");for(var b=0;b<d.length;b++)a.push(pg.fMakeRouteRowHTML(d[b],"tblRoutes",b));a.push("</tbody></table><br/>"),a.push(pg.footerHTML()),pg.replaceHtml($("divContentRoutesResults"),a.join(""))};if(pg.browserVersion<=8&&d.length>25&&!c){(b||{}).innerHTML="<br/>"+i18n.loading,setTimeout(e,100);return}e()}},pg.fLoadDepartingRoutes=function(a,b){pg.loadedDepartingRoutes=null,pg.realTimeDepartures.timer&&a&&(clearTimeout(pg.realTimeDepartures.timer),pg.realTimeDepartures.timer=0);var c=$("divContentDepartingRoutesResults");pg.inputStop&&pg.stopsByIP&&pg.inputStop.indexOf("192.168.")>=0&&cfg.city.defaultTransport=="tablo"&&(pg.IP=pg.inputStop,pg.tablo=pg.stopsByIP[pg.IP]||{stops:"unknown"},pg.inputStop=pg.tablo.stops,reloadTabloContent());var d=ti.fGetAnyStopDetails(pg.inputStop);if(a)var e=[];if(cfg.city.defaultTransport!="tablo")if(d.id)$("inputStop")&&($("inputStop").value=pg.inputStopText=d.name||"",$("inputStop").className=""),pg.startStop||(pg.startStop=pg.inputStop);else if(c&&!pg.inputStop&&typeof ti.stops=="object"){var f=pg.fUrlSet({hashForMap:"map"},!0);$("divContentDepartingRoutesHeader").style.display="none",(c||{}).innerHTML=("<p class=\"help\">"+i18n.searchDeparturesHelp+"<p/><p class=\"help\">"+i18n.tripPlannerHelpMap).replace(/<a>/g,"<a class=\"underlined map\" href=\"#"+f+"\">"),document.activeElement&&document.activeElement.id!=="inputStop"&&($("inputStop").value=i18n.startStop,$("inputStop").className="empty",setTimeout(function(){try{$("inputStop").focus()}catch(a){}},100));return}if(typeof ti.routes!=="object"||typeof ti.stops!=="object")cfg.city.defaultTransport!="tablo"&&((c||{}).innerHTML="<br/>"+i18n.receivingData),setTimeout(function(){pg.fLoadDepartingRoutes(a,b)},200);else{pg.loadedDepartingRoutes=pg.inputStop,pg.stopsSuggestedForText=d.name;if(cfg.city.defaultTransport=="tablo")($("spanContentDepartingRoutesStop")||{}).innerHTML=d.name||"",d.name&&d.name.length>=30&&(($("spanContentDepartingRoutesStop")||{style:{}}).style.fontSize="54px"),($("spanDepartureDate")||{}).innerHTML=ti.printTime(ti.dateToMinutes(new Date));else{var g=(d.street?", "+d.street:"")+(d.area&&!cfg.cities[pg.city].skipStopArea?", "+d.area:"")+(d.city&&!cfg.cities[pg.city].skipStopCity?", "+d.city:"");d[cfg.cities[pg.city].stopFareZone||"noFareZone"]&&(g+=", "+i18n.fareZone+" "+d[cfg.cities[pg.city].stopFareZone]),g=g.length>0?"<span class=\"details\"> ("+g.substring(2)+")</span>":"";var h=[],f=pg.fUrlSet({hashForMap:"map"},!0),i=pg.transfers=ti.fGetRoutesAtStop(pg.inputStop,!1),j={},k=null,h=[];for(var l=0;l<i.length;l++){var m=i[l];if(m.num.indexOf("(")>0)continue;m.num=m.num.split("(")[0].trim(),m.numHTML=m.numHTML.split("(")[0].trim();var n=ti.toAscii([m.city,m.transport,m.num].join(","),!0);if(j[n])continue;var o={city:m.city,transport:m.transport,num:ti.toAscii(m.num,!0),dirType:m.dirType,stopId:m.stopId};j[n]=o;var p=pg.fUrlSet({schedule:o},!0);k!==m.transport&&(k=m.transport,h.push(" <span class=\"icon icon_narrow icon_"+m.transport+"\" data-transport=\""+m.transport+"\"></span>&nbsp;"));var q="<a class=\"hover transfer"+k+"\" href=\"#"+p+"\" title=\""+(m.name||"").replace(/"/g,"")+"\">"+i[l].numHTML.replace(/\s/g,"&nbsp;")+"</a> ";h.push(q)}h.push("<span style=\"display:inline-block; width:2px;\"></span>"),($("spanContentDepartingRoutesStop")||{}).innerHTML="<a href=\"#"+f+"\" class=\"icon icon_map\" title=\""+i18n.showInMap+"\"></a>"+i18n.stop+" <strong>"+d.name+"</strong>"+g+h.join("")+"<br />"}h=[];var r=new Date,s=-1;typeof mobile!="undefined"&&typeof b!="undefined"?s=b:$("inputDepartureDate")&&(s=+$("inputDepartureDate").value);var t={start_stops:pg.inputStop,finish_stops:"",transport:{}};typeof pg.tablo=="object"&&(t.start_stops=pg.tablo.stops||"unknown"),s<0?(t.date=r,startTime=ti.dateToMinutes(r)%1440):(t.date=new Date(r.getFullYear(),r.getMonth(),r.getDate()+s),startTime=-1);var u=dijkstra(t,cfg.city.defaultTransport=="tablo"||typeof mobile!="undefined"?startTime:0*startTime,0);if(cfg.city.urlVehicleDepartures&&s<0){c&&($("divContentDepartingRoutesHeader").style.display="",(c||{}).innerHTML="<br/>"+i18n.loading),pg.departuresBySchedule=u,pg.fProcessVehicleDepartures(null,a);if(cfg.city.defaultTransport!="tablo")return}if(!u||!u.length){(c||{}).innerHTML="<br/>"+i18n.noDepartingRoutes;return}h.push("<table id=\"tblDepartingRoutes\" class=\"routes-list\" cellpadding=\"0\" cellspacing=\"0\"><tbody>");var v={};for(var w=0;w<u.length;w++){var m=u[w].route,x=ti.toAscii(m.city+";"+m.transport+";"+m.num+";"+m.name+";"+m.stopId,!0),y={departure:u[w].start_time,bLowFloorVehicle:u[w].bLowFloorVehicle};if(x in v){var z=v[x];u[z].route.departures.push(u[w].start_time),u[z].route.tripNums.push(u[w].tripNum),u[z].route.vehicles.push(y)}else v[x]=w,u[w].route.departures=[u[w].start_time],u[w].route.tripNums=[u[w].tripNum],u[w].route.vehicles=[y]}for(var w=0,z=0;w<u.length;w++)u[w].route.departures&&(u[w].route.departures.sort(function(a,b){if(a<b)return-1;if(a>b)return 1;return 0}),u[w].route.vehicles.sort(function(a,b){if(a.departure<b.departure)return-1;if(a.departure>b.departure)return 1;return 0}),u[w].route.departures[0]<0&&u[w].route.num.indexOf("(")>=0?w=w:(a?e.push(pg.fMakeRouteRowHTML(u[w].route,"tblDepartingRoutes",z,startTime,!0,d.id)):h.push(pg.fMakeRouteRowHTML(u[w].route,"tblDepartingRoutes",z,startTime,!1,d.id)),++z));if(cfg.city.defaultTransport=="tablo"){pg.realTimeData&&(pg.realTimeData="",pg.realTimeDepartures.timer2&&(clearTimeout(pg.realTimeDepartures.timer2),pg.realTimeDepartures.timer2=setTimeout(function(){pg.realTimeDepartures.timer2=0,pg.fLoadDepartingRoutes()},15e3))),pg.fMakeTabloHTML(u);return}c&&((c||{}).innerHTML=h.join("")+"</tbody></table>",$("divContentDepartingRoutesHeader").style.display=""),a&&a(e)}},pg.fMakeTabloHTML=function(a){if(pg.inputStop=="unknown")setTimeout(function(){location.reload(!0)},3e4),$("divContentDepartingRoutes").innerHTML="<p style=\"font-size:96px; padding-top:128px; text-align:center; text-transform:none;\">Vyksta sistemos derinimo<br />darbai</p>"+(cfg.defaultCity!="vilnius"?"":"<div style=\"position:absolute; bottom:20px; right:20px; color:#606060; font-size:34px; text-transform:none;\"><img src=\""+pg.imagesFolder+"sisp_logo.png\" /><br />www.vilniustransport.lt</div>");else{var b=[];pg.departuresBySchedule.sort(function(a,b){return a.start_time-b.start_time}),a.sort(function(a,b){return a.start_time-b.start_time});var c=0,d,e=new Date,f=(e.getTime()-e.setHours(10,0,0,0))/1e3+36e3;f/=60,f<240&&(f+=1440);if(pg.realTimeData){if(pg.departuresBySchedule&&pg.departuresBySchedule.length){var g=pg.departuresBySchedule.slice(0);for(c=0,d=-1;c<pg.departuresBySchedule.length;c++)g[c].bySchedule=!0,d<0&&g[c].start_time>=f&&(d=c);d<0?g=[]:d>0&&(g=g.slice(d));var h=f;a&&a.length?h=a[0].start_time||h:a=[],h+=h%1440<240?30:60,g.length&&h<g[0].start_time&&a.push.apply(a,g)}}else c=c+0;for(var c=a.length;--c>=0;){var i=a[c].route;if(i.vehicles)for(var d=i.vehicles.length;--d>=0;)b.push({route:i,start_time:i.vehicles[d].departure,vehicleID:i.vehicles[d].vehicleID,departure_data:i.vehicles[d],bySchedule:a[c].bySchedule})}b.sort(function(a,b){if(a.start_time<b.start_time)return-1;if(a.start_time>b.start_time)return 1;return ti.naturalSort(a.route.num,b.route.num)});var j;for(j=0;j<(cfg.defaultCity=="vilnius"?6:9);){var k={},l=!1;for(var c=0;c<b.length;c++){var m=b[c];if(l&&m.bySchedule)break;var i=m.route,n=ti.toAscii(i.city+";"+i.transport+";"+i.num+";",!0),o,p=i.destination||i.name,q=["–","—","- "," -","-"];if(cfg.defaultCity!="tallinna-linn"||!pg.realTimeData)for(var r=0;r<q.length;++r){d=p.lastIndexOf(q[r]);if(d>=3){p=p.substring(d+1).trim();if(q[r+1]=="-")break}}cfg.defaultCity!="vilnius"&&p.toLowerCase().slice(-10)=="oro uostas"&&(p="oro uostas&nbsp;&nbsp;&nbsp;<img style=\"vertical-align: baseline;\" height=\"52\" width=\"52\" src=\"images/airport_blue_52.png\" />"),cfg.defaultCity!="vilnius"&&m.departure_data.bBicycle&&(p+="&nbsp;&nbsp;<img style=\"vertical-align: baseline;\" height=\"52\" width=\"72\" src=\"images/bicycle_blue_52.png\" />");if(m.html||m.start_time<0)continue;var s=f;f<240&&m.start_time>=720&&(s=f+1440);if(!pg.realTimeData&&m.start_time<=s)continue;if(m.start_time<=s-.5)continue;if(cfg.defaultCity=="klaipeda"&&m.start_time<=s+.5)continue;pg.realTimeData&&(c=c+1-1);if(cfg.defaultCity=="tallinna-linn"){if(";tram;trol;bus;".indexOf(";"+i.transport+";")<0)continue;o=ti.fGetStopDetails(m.route.stopId),n=n+ti.toAscii(o.name,!0)+";";if(k[n]){var t;m.start_time==999999?t="":m.start_time<s+60&&pg.realTimeData?t=Math.floor(m.start_time-s+.5)+" min":t=ti.printTime(Math.floor(m.start_time+.5));var u=k[n];u.html=(u.html||"").replace("%1",t);continue}}else if(k[n])continue;k[n]=m,l=!0;var v=!1,w="",x="",y="",z="",A=i.numHTML,B=i.transport;cfg.defaultCity=="vilnius"?(A+="</div>",m.departure_data.bLowFloorVehicle&&(A+="<div class=\"icon_wheelchair\"></div>",v=!1),m.departure_data.bCoolVehicle&&(A+="<div class=\"icon_snowflake\"></div>"),m.departure_data.bWifi&&(A+="<div class=\"icon_wifi\"></div>"),m.departure_data.bUsb&&(A+="<div class=\"icon_usb\"></div>"),m.departure_data.bBicycle&&(A+="<div class=\"icon_bicycle\"></div>"),m.departure_data.bAirport&&(A+="<div class=\"icon_plane\"></div>",p="oro uostas/<b style=\"font-size:40px;\">airport</b>")):(v=m.departure_data.bLowFloorVehicle,m.departure_data.bCoolVehicle&&(w="<div class=\"snowflake\"><img src=\"snowflake.png\"></div>"),m.departure_data.bUsb&&(y="<div class=\"usb\"><img src=\"usb.png\"></div>"),cfg.defaultCity=="klaipeda"?(m.departure_data.bChristmasTree&&(z="<div class=\"usb\"><img src=\"christmastree.png\"></div>"),m.departure_data.bWifi&&(x="<div class=\"wifi\"><img src=\"wifi.svg\"></div>"),m.departure_data.bElectrobus&&(B="electrobus")):m.departure_data.bWifi&&(w="<div class=\"usb\"><img src=\"wifi.png\"></div>")),m.html="<tr><td><div><span class=\"icon icon_"+B+"\"></span></div></td><td style=\"position:relative; left:0;top:0;\"><div class=\"num "+i.transport+" \">"+A+"</div></td><td class=\"name\" style=\"position:relative; left:0;top:0;\"><div>"+p+"</div>"+z+w+x+y+(v?"<div class=\"wheelchair\">"+(cfg.defaultCity!="tallinna-linn"?"<img src=\"wheelchair.svg\">":"")+"</div>":"")+"</td><td class=\"time\"><div>",m.start_time==999999?m.html+="---":m.start_time<s+60&&pg.realTimeData?cfg.defaultCity=="klaipeda"&&m.start_time<s+1?m.html+="<1 min.":m.html+=Math.floor(m.start_time-s+.5)+" min"+(cfg.defaultCity!="tallinna-linn"?".":"")+(pg.realTimeData?"":"*"):m.html+=ti.printTime(Math.floor(m.start_time+.5)),m.html+="</div></td>";if(cfg.defaultCity=="tallinna-linn"){m.html+="<td><div class=\"next-departures\">%1<br/>%1</div></td>";var o=ti.fGetStopDetails(m.route.stopId);m.html+="<td><div class=\"white-circle\">&nbsp;</div></td><td><div class=\"stop_name\"><b>"+(o.name||"")+"</b><br/><i>"+(o.street||"")+"</i></div></td>"}m.html+="</tr>";if(cfg.defaultCity!="tallinna-linn")if(++j>=(cfg.defaultCity=="vilnius"?6:9))break}if(cfg.defaultCity=="tallinna-linn")break;if(!l)break}var C="<table id=\"tblDepartingRoutes\" class=\"routes-list\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><th colspan=\"2\">Maršrutas</th><th class=\"name\">Kryptis</th><th class=\"time\">Laikas</th></tr>";for(var c=0,j=0;c<b.length;c++)if(b[c].html){C+=b[c].html.replace("%1","&nbsp;").replace("%1","&nbsp;"),++j;if(cfg.defaultCity=="tallinna-linn"&&j>=1007)break}if(cfg.defaultCity=="tallinna-linn"&&j<8){C+="<tr class=\"bottom\"><td rowspan=\""+(8-j).toString()+"\" colspan=\"7\"",j>4?C+="><div>":C+=" class=\"phone\"><div><span id=\"spanPhone1\"></span><br/><span id=\"spanPhone2\"></span><br/>",C+="transport.tallinn.ee</div></td></tr>";for(;++j<8;)C+="<tr class=\"bottom\"></tr>"}C+="</tbody></table>",($("spanDepartureDate")||{}).innerHTML=ti.printTime(ti.dateToMinutes(new Date)),($("divContentDepartingRoutesResults")||{}).innerHTML=C,($("divContentDepartingRoutesHeader")||{style:{}}).style.display="";if(pg.tablo){var D=new Date;if(pg.tablo.validFrom instanceof Date&&!isNaN(pg.tablo.validFrom.getTime())&&(!pg.tablo.validTo||pg.tablo.validTo instanceof Date&&!isNaN(pg.tablo.validTo.getTime()))){if(!pg.tablo.validFrom||D<pg.tablo.validFrom||pg.tablo.validTo&&D>pg.tablo.validTo)pg.tablo.message=!1}else pg.tablo.message=!1;if(cfg.defaultCity!="klaipeda")if(pg.tablo.imageValidFrom instanceof Date&&!isNaN(pg.tablo.imageValidFrom.getTime())&&(!pg.tablo.imageValidTo||pg.tablo.imageValidTo instanceof Date&&!isNaN(pg.tablo.imageValidTo.getTime()))){if(!pg.tablo.imageValidFrom||D<pg.tablo.imageValidFrom||pg.tablo.imageValidTo&&D>pg.tablo.imageValidTo)pg.tablo.image=!1}else pg.tablo.image=!1;($("TabloImage")||{style:{}}).style.display=pg.tablo.image?"block":"none",pg.tablo.image&&(($("TabloImage")||{style:{}}).style.backgroundImage=cfg.defaultCity=="vilnius"&&location.hostname.indexOf("stops.lt")<0&&window.location.hostname!="xxxlocalhost"?"url(\"http://192.168.14.14/Media/"+pg.tablo.image+"\")":"url(\"Media/"+pg.tablo.image+"\")"),($("divTabloMessagePanel")||{style:{}}).style.display=pg.tablo.message?"block":"none",($("divTabloMessage")||{style:{}}).style.visibility=pg.tablo.message?"visible":"hidden"}}},pg.google_spreadsheet_JSON=function(a){var b=JSON.parse(a),c=[],d=+(new Date).setHours(0,0,0,0);if(b&&b.feed&&b.feed.entry)for(var e=0;e<b.feed.entry.length;e++){var f=b.feed.entry[e],g=Object.keys(f),h={};for(var i=0;i<g.length;i++){var j=g[i].indexOf("gsx$");if(j>-1){var k=g[i],l=k.substring(4),m=f[k],n=m.$t;n=n.trim();if(l=="from"||l=="until"){h[l+"Debug"]=n;var o=ti.parseISOLocal(n);o=(o-d)/6e4,o>1440&&l=="from"&&window.location.href.indexOf("test.html")>=0&&(o%=1440),h[l]=o}else"stopnumber,bus,trol,tram".indexOf(l)<0?h[l]=n:h[l]=n.replace(/\s|\n/g,"")}}c.push(h)}return c},pg.fProcessVehicleDepartures=function(a,b){if(typeof mobile=="undefined"||typeof b!="undefined"){if(cfg.defaultCity=="tallinna-linn"){var c=new Date;if(+c-(pg.stop_closures_checked_time||0)>3e5){pg.stop_closures_checked_time=+c,ti.fDownloadUrl("get","https://spreadsheets.google.com/feeds/list/1PNmzdrizdwf0VmVDqEf_w17vTTMUC42CNhwqNLljzJg/1/public/values?alt=json&timestamp="+ +c,function(c){pg.stop_closures=pg.google_spreadsheet_JSON(c),pg.fProcessVehicleDepartures(a,b)},!0);return}if(c>=new Date(2018,1,23,19,0)&&c<=new Date(2018,1,23,23,59)||c>=new Date(2018,1,24,7,0)&&c<=new Date(2018,1,24,14,30)){pg.realTimeData="";if(typeof b=="function")b([]);else{var d=$("divContentDepartingRoutesResults");(d||{}).innerHTML="<br/>"+i18n.stopNoRealtimeDepartures}return}}if(pg.realTimeDepartures.timer){clearTimeout(pg.realTimeDepartures.timer),pg.realTimeDepartures.timer=0;if(typeof mobile!="undefined"&&["favourites","schedule4","schedule5","stop","index","home"].indexOf(mobile.current_page)==-1)return}if(!cfg.city.urlVehicleDepartures)return;pg.realTimeDepartures.timer=setTimeout(function(){pg.realTimeDepartures.timer=0,pg.fProcessVehicleDepartures(null,b)},location.hostname=="localhost"?1009999:1e4);if(cfg.isApp&&a&&typeof a=="object"){b(a);return}if(typeof a!=="string"){pg.realTimeDepartures.timer2||(pg.realTimeDepartures.timer2=setTimeout(function(){pg.realTimeDepartures.timer2=0,pg.fLoadDepartingRoutes()},location.hostname=="localhost"?15e3:pg.realTimeData?9e5:15e3));if(typeof mobile=="object"&&["favourites","index","home"].indexOf(mobile.current_page)!=-1||["favourites","home"].indexOf(pg.transport)!=-1&&typeof pg.favouriteStops!="undefined")var e=(pg.favouriteStops||"").split(",");else if((typeof mobile=="object"||cfg.defaultCity=="tallinna-linn")&&pg.schedule&&pg.schedule.stopId){var e=[pg.schedule.stopId];if(pg.schedules){e=[];for(var f in pg.schedules){var g=pg.schedules[f];g&&e.indexOf(g.stopId)==-1&&e.push(g.stopId)}}}else var e=(pg.inputStop||"").split(",");if(e.join(",").indexOf(";")!=-1)return;pg.stopsBySiriID={};for(var h=0;h<e.length;++h){var i=(ti.stops[e[h]]||{}).siriID||0;i&&(pg.stopsBySiriID[i]=e[h],e[h]=i)}if(e&&e.length==1&&e[0]=="")return;(!pg.visibility||pg.visibility=="visible")&&ti.fDownloadUrl("GET",cfg.city.urlVehicleDepartures+"?stopid="+e.join(",")+"&time="+ +(new Date),function(a){pg&&pg.fProcessVehicleDepartures(a,b)},cfg.city.defaultTransport=="tablo"?!0:!1);return}a&&pg.realTimeDepartures.timer2&&(clearTimeout(pg.realTimeDepartures.timer2),pg.realTimeDepartures.timer2=0);if(a&&a.substring(0,6)=="reload"){location.reload(!0);return}a=a||pg.realTimeData||"",pg.realTimeData=a;if(!a&&cfg.city.defaultTransport=="tablo")return;cfg.city.defaultTransport=="tablo"&&(pg.vehicleIconState=="cool"?pg.vehicleIconState="wifi":pg.vehicleIconState=="wifi"?pg.vehicleIconState="usb":pg.vehicleIconState="wifi"),a=a.split("\n");if(pg.realTimeDepartures.$mapPopup)if(!pg.realTimeDepartures.mapStop)if(pg.realTimeDepartures.vehicleID){var j={};for(var h=0;h<a.length;h++){var k=a[h].trim().split(",");while(k[k.length-1]=="")k.pop();if(k.length<2)continue;var l=({1:"trol",3:"tram",4:"minibus"})[k[0]]||"bus";j[l+";"+k[3]]={transport_number:k[0],route_number:k[1],direction_type:k[2].replace(/>/g,"-"),stops:k.slice(4)}}var m=j[pg.realTimeDepartures.vehicleTransport+";"+pg.realTimeDepartures.vehicleID],n="<br/>No data available";if(m){n=[];for(var h=0;h<m.stops.length-1;h+=2)n.push(ti.printTime((+m.stops[h+1]+30)/60)+"&nbsp;&nbsp;<a href=\"#stop/"+m.stops[h]+"/map\">"+ti.fGetStopDetails(m.stops[h]).name)+"</a>";n=n.join("</br>")}var o=pg.realTimeDepartures.vehicleTransport,p=pg.realTimeDepartures.vehicleRouteNum,q=ti.fGetRoutes(cfg.defaultCity,o,p,m?m.direction_type:!1),r="";q&&q.length&&q[0].name&&(r="<strong>"+q[0].name+"</strong></br>");var s="<div class=\"baloon_close\"></div><div class=\"baloon_content\"><span class=\"baloon_title\"><span class=\"icon icon_"+o+"\"></span><span class=\"num num3 "+o+"\">"+(p||"?")+"</span>"+pg.realTimeDepartures.vehicleID+"</span><br/>"+r+"<div style=\"padding:8px 20px 0 0; height:150px; overflow-y:auto; overflow-x:hidden;\">"+n+"</div></div>"}if(pg.transport=="stop"&&pg.loadedDepartingRoutes&&pg.loadedDepartingRoutes!=null&&+($("inputDepartureDate")||{value:0}).value===-1||cfg.city.defaultTransport=="tablo"&&pg.loadedDepartingRoutes||typeof mobile=="object"&&pg.schedule&&pg.schedule.stopId&&pg.loadedDepartingRoutes||typeof mobile=="object"&&pg.loadedDepartingRoutes&&pg.transport==="stop"&&jQuery("#stop .nav-departures li.active").attr("data-departure")=="-1"||typeof mobile=="object"&&mobile.current_page=="favourites"&&pg.loadedDepartingRoutes||typeof mobile=="object"&&mobile.current_page=="index"&&pg.loadedDepartingRoutes||typeof b=="function"&&pg.loadedDepartingRoutes&&(pg.schedule||["favourites","home"].indexOf(pg.transport)!=-1&&typeof pg.favouriteStops!="undefined")){var t={},u=pg.loadedDepartingRoutes.split(",");for(var h=0;h<u.length;++h)t[u[h]]=!0;var v=[];v.push("<table id=\"tblDepartingRoutes\" class=\"routes-list\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\"><tbody>");var w={},x=[],y=ti.dateToMinutes(new Date,!0)%1440;y<180&&cfg.defaultCity!="tallinna-linn"&&(y+=1440);var z=1e4;for(var h=0;h<a.length;h++){var k=a[h].trim().split(","),A,B;if(h==0&&k[0]!=="stop"){cfg.defaultCity==="tallinna-linn"&&k[4]&&!isNaN(k[4])&&(B=parseInt(k[4]),B>=0&&(y=B/60%1440));continue}if(k.length>=2&&k[0]==="stop"){stopId=k[1];if(cfg.defaultCity=="tallinna-linn")stopId=pg.stopsBySiriID[stopId];else if(cfg.city.urlVehicleDepartures.indexOf("departures.txt")>=0){if(t[stopId])continue;for(;h<a.length-1;h++)if(a[h+1].trim().indexOf("stop")>=0)break}continue}if(k.length<=3)continue;if(cfg.defaultCity==="tallinna-linn"){A={city:cfg.defaultCity,transport:k[0],num:k[1],numHTML:k[1],name:k[4]||"",destination:k[4]||""};var C=[A.city,A.transport,A.num.toLowerCase()].join("_");if(pg.good_siri_direction&&!pg.good_siri_direction(C,pg.transfers,A.destination))continue;B=+k[2],z>B-y*60&&(z=B-y*60),B=Math.floor(B/60);for(var D=0;D<pg.transfers.length;++D)if(A.num===pg.transfers[D].num&&A.transport===pg.transfers[D].transport&&A.city===pg.transfers[D].city&&stopId===pg.transfers[D].stopId){var E=A.destination;A=pg.transfers[D],A.destination=E;break}}else{typeof ti.transportRoutes=="function"&&(k[0]=ti.transportRoutes(k[1]));if(cfg.defaultCity=="vilnius"&&k[0]=="bus"&&k[1].length&&k[1].charAt(k[1].length-1).toLowerCase()=="n")k[0]="nightbus",cfg.city.defaultTransport=="tablo"&&(k[1]=k[1].substring(0,k[1].length-1),A=null),A=(ti.fGetRoutes(cfg.defaultCity,k[0],k[1].toUpperCase(),k[2],!0)||[])[0];else{A=(ti.fGetRoutes(cfg.defaultCity,k[0],k[1],k[2],!0)||[])[0];if(!A){cfg.defaultCity=="kaunas"&&(k[5]=k[6]);if(!k[5])continue;var F=(k[2]||"-").split("-"),G=F[F.length-1],q=ti.fGetRoutes(cfg.defaultCity,k[0],k[1],null,!0)||[];for(var D=0;D<q.length;++D){var F=(q[D].dirType||"-").split("-");if(G==F[F.length-1]){A=q[D];break}if(q[D].name.indexOf(k[5])>=q[D].name.length-3-k[5].length)break}}}A=A||{city:cfg.defaultCity,transport:k[0],num:k[1],numHTML:k[1],name:k[5]||"",destination:k[5]||""},A&&k[5]&&(A.name=A.name||k[5],A.destination=k[5]),B=+k[3]/60}var f=ti.toAscii(A.city+";"+A.transport+";"+A.num+";"+A.name,!0);f+=";"+stopId;var H=w[f],I=k[4],J={};if(cfg.defaultCity=="vilnius"||cfg.defaultCity=="klaipeda"){var K=(I||"x").toLowerCase().lastIndexOf("k");K>=3&&(J.bCoolVehicle=!0,I=I.slice(0,K)+I.slice(K+1)),(I||"x").toLowerCase().indexOf("w")>=0&&(J.bWifi=!0,I=I.replace(/w/ig,""))}cfg.defaultCity=="vilnius"&&((I||"x").toLowerCase().indexOf("d")>=0&&(J.bBicycle=!0,I=I.replace(/d/ig,"")),A&&A.name&&A.name.toLowerCase().slice(-10)=="oro uostas"&&(J.bAirport=!0));if(cfg.defaultCity=="klaipeda"){var K=(I||"x").toLowerCase().lastIndexOf("n");K>=3&&(J.bChristmasTree=!0,I=I.slice(0,K)+I.slice(K+1)),K=(I||"x").toLowerCase().lastIndexOf("e"),K>=3&&(J.bElectrobus=!0,I=I.slice(0,K)+I.slice(K+1))}cfg.defaultCity=="tallinna-linn"?J.bLowFloorVehicle=(cfg.city.lowFloorVehicles||"").indexOf(","+I+",")>=0:(cfg.defaultCity=="klaipeda"?J.bLowFloorVehicle=/[ztZT]/.test((I||"x").slice(-1)):J.bLowFloorVehicle=/[zZ]/.test((I||"x").slice(-1)),J.bLowFloorVehicle&&(I=I.slice(0,-1))),cfg.defaultCity=="vilnius"&&(pg.vehicleIconState=="wifi"&&J.bWifi?J.bUsb=!(J.bBicycle&&J.bCoolVehicle&&J.bAirport):pg.vehicleIconState=="usb"&&J.bWifi&&(J.bWifi=!(J.bBicycle&&J.bCoolVehicle&&J.bAirport),J.bUsb=!0));if(pg.stop_closures)for(var D=0;D<pg.stop_closures.length;++D){var L=pg.stop_closures[D],M=","+L.stopnumber+",";if(M.indexOf(","+stopId+",")<0&&M.indexOf((","+stopId).split("-")[0]+",")<0)continue;var N=L[A.transport]||"";if(N!="all"&&(","+N+",").indexOf(","+A.num+",")<0)continue;if(B>=L.from&&B<=L.until){B=999999,A.message=L.message;break}}J.vehicleID=I,J.departure=B,J.zeroGround=k.length==7&&k[6]=="Z";if(B<y-.5)B=B;else if(H){if(B!=999999)if(cfg.defaultCity!="tallinna-linn"||B<=y+30)H.route.departures.push(B),H.route.vehicles.push(J)}else A.departures=[B],A.vehicles=[J],A.stopId=stopId,w[f]={route:A}}for(var f in w){var A=w[f];A.route.departures.sort(function(a,b){return a-b}),A.route.vehicles.sort(function(a,b){return a.departure-b.departure}),A.start_time=A.route.vehicles[0].departure,x.push(A)}x.sort(function(a,b){if(a.route.sortKey<b.route.sortKey)return-1;if(a.route.sortKey>b.route.sortKey)return 1;return ti.naturalSort(a.route.num,b.route.num)}),pg.realTimeDepartures.timer&&cfg.defaultCity==="tallinna-linn"&&z>=30&&(clearTimeout(pg.realTimeDepartures.timer),pg.realTimeDepartures.timer=setTimeout(function(){pg.realTimeDepartures.timer=0,pg.fProcessVehicleDepartures(null,b)},z<=90?3e4:6e4));if(typeof b=="function"){var O=[];for(var h=0;h<x.length;h++){O[h]=pg.fMakeRouteRowHTML(x[h].route,"tblDepartingRoutes",0,y,!0);var P=x[h].route.departures[0];O[h].timetowait=P==999999?P:Math.floor(x[h].route.departures[0]-y+.5)}b(O,y)}else if(cfg.city.defaultTransport=="tablo"){var Q=new Date;pg.startedTimestamp?Q-pg.startedTimestamp>864e5&&location.reload():(pg.startedTimestamp=new Date(Q.valueOf()),pg.startedTimestamp.setHours(3,0,0,0),pg.startedTimestamp>=Q&&pg.startedTimestamp.setDate(Q.getDate()-1)),pg.fMakeTabloHTML(x)}else{for(var h=0;h<x.length;h++){var P=x[h].route.departures[0];x[h].route.timetowait=P==999999?P:Math.max(0,Math.floor(x[h].route.departures[0]-y+.5)),v.push(pg.fMakeRouteRowHTML(x[h].route,"tblDepartingRoutes",0,-1,!1,x[h].route.destination))}($("divContentDepartingRoutesResults")||{}).innerHTML=v.join("")+"</tbody></table>"}}}},pg.fLoadPlannerTab=function(a,b){a===!0&&(pg.optimalResults=null,pg.loadedPlannerParams=null,pg.hashForMap="");if(b)var c={errors:[]};var d=""+((typeof mobile!="undefined"?jQuery(".inputTime").val():($("inputTime")||{}).value)||"");d===""?(d=ti.dateToMinutes(new Date)%1440,($("inputTime")||{}).value=ti.printTime(d),typeof mobile!="undefined"&&jQuery(".inputTime").val(ti.printTime(d))):d=ti.toMinutes(d);var e=ti.fGetAnyStopDetails(pg.inputStart),f=ti.fGetAnyStopDetails(pg.inputFinish);f.id?(($("inputFinish")||{}).value=f.name||"",($("inputFinish")||{}).className=""):!pg.inputFinish&&typeof ti.stops=="object"&&(($("divContentPlannerResults")||{}).innerHTML=i18n.typeFinishStop,b&&c.errors.push({text:i18n.typeFinishStop}),document.activeElement&&document.activeElement.id!=="inputFinish"&&(($("inputFinish")||{}).value=i18n.finishStop,($("inputFinish")||{}).className="empty"));if(e.id)($("inputStart")||{}).value=e.name||"",($("inputStart")||{}).className="";else if(!pg.inputStart||typeof ti.stops=="object")($("divContentPlannerResults")||{}).innerHTML=i18n.typeStartStop,b&&c.errors.push({text:i18n.typeStartStop}),document.activeElement&&document.activeElement.id!=="inputStart"&&(($("inputStart")||{}).value=i18n.startStop,($("inputStart")||{}).className="empty");if(typeof ti.routes!=="object"||typeof ti.stops!=="object")($("divContentPlannerResults")||{}).innerHTML="<br/>"+i18n.receivingData,setTimeout(function(){pg.fLoadPlannerTab(!1,b)},200);else{if(!pg.inputStart&&!pg.inputFinish||(pg.loadedPlannerParams||"").indexOf("clear")>=0){pg.loadedPlannerParams=pg.inputStart+"/"+pg.inputFinish,pg.optimalResults=null,pg.hashForMap&&pg.hashForMap!="map"&&(pg.map={},pg.hashForMap="map",pg.fMapShow());var g=pg.fUrlSet({hashForMap:"map"},!0);($("divContentPlannerResults")||{}).innerHTML="<p class=\"help\">"+i18n.tripPlannerHelp+"</p><p class=\"help\">"+i18n.tripPlannerHelpMap.replace(/<a>/g,"<a class=\"underlined map\" href=\"#"+g+"\">")+"</p>",b&&(c.errors.push({text:i18n.tripPlannerHelp}),b(c));return}pg.loadedPlannerParams=pg.inputStart+"/"+pg.inputFinish;if(!e.id||!f.id){b&&b(c);return}var h=new Date,i=h;cfg.defaultCity=="tallinna-linn"?jQuery("#inputDateNew").val()&&(i=jQuery("#inputDateNew").datepicker("getDate")):i=new Date(h.getFullYear(),h.getMonth(),h.getDate()+ +(typeof mobile!="undefined"?jQuery(".inputDate").val():$("inputDate").value));var j={start_stops:pg.inputStart=="gps"?[ti.stops.gps.lat,ti.stops.gps.lng].join(";"):pg.inputStart,finish_stops:pg.inputFinish=="gps"?[ti.stops.gps.lat,ti.stops.gps.lng].join(";"):pg.inputFinish,reverse:typeof mobile!="undefined"?parseInt(jQuery(".inputReverse").val(),10):parseInt($("inputReverse").value,10),date:i,start_time:d,lowFloor:typeof mobile!="undefined"?jQuery(".checkHandicapped").is(":checked"):$("checkHandicapped").checked,transport:{},route_nums:((typeof mobile!="undefined"?jQuery(".inputRoutesFilter").val():($("inputRoutesFilter")||{}).value)||"").trim(),walk_speed_kmh:typeof mobile!="undefined"?parseInt(jQuery(".inputWalkSpeed").val()||4,10):parseInt($("inputWalkSpeed").value||4,10),walk_max:typeof mobile!="undefined"?jQuery(".inputWalkMax").val():$("inputWalkMax").value,change_time:typeof mobile!="undefined"?parseInt(jQuery(".inputChangeTime").val()||3,10):parseInt($("inputChangeTime").value||3,10),callback1:b||(typeof mobile!="undefined"?mobile.renderPlannerResults:pg.fPrintOptimalTrips),callback:b||(typeof mobile!="undefined"?mobile.renderPlannerResults:pg.fPrintOptimalTrips)},k=pg.fGetCity(pg.city);for(var l=1;l<=2;l++){for(var m=0,n=cfg.cities[k].transport;m<n.length;m++)j.transport[n[m]]=typeof mobile!="undefined"?jQuery(".checkbox"+n[m]).is(":checked"):($("checkbox"+n[m])||{checked:!0}).checked;k=cfg.cities[k].region;if(!k||!cfg.cities[k])break}cfg.defaultCity=="vilnius"&&"plane"in j.transport&&(j.transport.plane=120,j.mode="vintra",j.shapes_url="http://www.stops.lt/shapes/"),($("divContentPlannerResults")||{}).innerHTML="<br/>"+i18n.calculating;if(typeof mobile=="undefined"||typeof mobile!="undefined"&&(pg.hashForMap||mobile.tallinnPlannerReady)||a)typeof mobile!="undefined"&&jq("#loading").show(),setTimeout(function(){ti.findTrips(j)},100)}},pg.fPrintOptimalTrips=function(a,b,c){var d=pg.optimalResults=a.results;pg.map={};var e=[];for(var f=0;f<d.length;f++){var g=d[f],h=d[f].legs,i=[],j=[];for(var k=0;k<h.length;k++){var l=h[k],m=l.route,n=(h[k+1]||{route:null}).route;if(m&&m.transport){n&&m.city===n.city&&m.transport===n.transport&&m.num===n.num&&(cfg.defaultCity!="intercity"&&(l.finish_stop.name=h[k+1].finish_stop.name,l.finish_time=h[k+1].finish_time,++k)),j.push("<span class=\"icon icon_narrow icon_"+m.transport+"\" title=\""+i18n.transport1[m.transport]+" "+m.num+" "+i18n.towards+" "+m.name+"\"></span>"),g.direct_trip&&m.num.length<=8&&(j.push("<span class=\"num num"+Math.min(l.route.num.length,4)+" "+l.route.transport+"\">"+l.route.numHTML+"</span>"),l.online_data&&j.push(" "+l.online_data.code+" "+l.online_data.departureAsStr+" &rarr; "+l.online_data.arrivalAsStr)),m.stopId=l.start_stop.id,m.tripNum=(l.trip_num||-1)+1;var o=pg.fUrlSet({schedule:m,mapHash:""},!0),p=l.travel_time;p=p>=60?ti.printTime(p,":","duration"):p+"&nbsp;"+i18n.minutesShort;var q="";if(l.stops&&l.stops.length){q=" style=\"cursor: default;\" title=\""+l.stops.length+" stops:";for(var r=0;r<l.stops.length;++r)q+=(r?", ":" ")+ti.printTime(l.stops[r].departure_time.minutes)+" "+l.stops[r].name;q+="\""}i.push("<p class=\"results\"><span class=\"icon icon_"+l.route.transport+"\"></span><span class=\"num num"+Math.min(l.route.num.length,4)+" "+l.route.transport+"\">"+l.route.numHTML+"</span>"+(cfg.searchOnly?"":"<a class=\"hover\" href=\"#"+o+"\" title=\""+i18n.showSchedule+"\">")+i18n.transport1[l.route.transport]+" "+i18n.towards+"&nbsp;"+l.route.name+(cfg.searchOnly?"":"</a>")+" <br/><strong>"+(cfg.defaultCity=="xxxvilnius2"?"":ti.printTime(l.start_time))+(l.online_data?"("+l.online_data.departureAsStr+")":"")+" "+l.start_stop.name+(l.start_platform&&"("+l.start_platform+")"||"")+"</strong> &rarr; "+(cfg.defaultCity=="xxxvilnius2"?"":ti.printTime(l.finish_time))+(l.online_data?"("+l.online_data.arrivalAsStr+")":"")+" "+l.finish_stop.name+(l.finish_platform&&"("+l.finish_platform+")"||"")+(cfg.defaultCity=="xxxvilnius2"?"":"<span class=\"graytext\""+q+"> ("+i18n.ride+" "+p+(cfg.city.has_trips_ids?" trip ID="+l.trip_id+(l.trip_date?"("+l.trip_date.yyyymmdd("-")+")":"")+", trip num="+l.trip_code+(l.online_data?", bezrindas trip ID="+l.online_data.code:""):"")+(cfg.city.has_trips_ids===2?", trip operator="+l.trip_operator+", trip group="+l.trip_group:"")+")</span>")+"</p>")}else{if(l.start_time==l.finish_time&&parseInt(l.start_stop.id,10)==parseInt(l.finish_stop.id,10))continue;j.push("<span class=\"icon icon_narrow icon_walk\" title=\""+i18n.walk+" "+(l.finish_time-l.start_time)+"&nbsp;"+i18n.minutesShort+"\"></span>"),i.push("<p class=\"results\"><span class=\"icon icon_walk\"></span><strong>"+(cfg.defaultCity=="xxxvilnius2"?"":ti.printTime(l.start_time))+" "+l.start_stop.name+"</strong> &rarr; "+(cfg.defaultCity=="xxxvilnius2"?"":ti.printTime(l.finish_time))+" "+l.finish_stop.name+"<span class=\"graytext\"> ("+i18n.walk+" "+(l.finish_time-l.start_time)+"&nbsp;"+i18n.minutesShort+")</span></p></a>")}if(l.taxi)for(var s=0;s<l.taxi.length;++s){var t=l.taxi[s];i.push((s?"<br />":"")+"km: "+t.km+", "+t.name+", phone: "+t.phone)}}e.push("<div"+(f%2?"":" class=\"grey\"")+" style=\"border-bottom: solid 1px gray; padding:5px 0 5px 5px;\"><table><tbody><tr><td><a href=\"\" onclick=\"return false;\" data-option-num=\""+(f+1)+"\" title=\""+(f?i18n.showDetails:i18n.hideDetails)+"\" class=\""+(f?"expand":"collapse")+"\"><span class=\"icon\"></span><strong class=\"hover\">"+i18n.option+"&nbsp;"+(f+1)+".</strong></a> <a href=\"#"+pg.city+"/"+pg.transport+"/map,,,"+(f+1)+"\" class=\"icon icon_map\" title=\""+i18n.showInMap+"\"></a> "+(cfg.defaultCity=="xxxvilnius2"?"":ti.printTime(g.start_time,null,"&#x2007;")+" &mdash; "+ti.printTime(g.finish_time,null,"&#x2007;"))+",</td><td style=\"white-space:pre-wrap;\">"+(g.distance?"atstumas&nbsp;"+Math.round(g.distance)/1e3+"&nbsp;km":i18n.travelDuration+"&nbsp;<strong>"+ti.printTime(g.travel_time,":","duration"))+"</strong>  "+(typeof g.cost=="number"?"kaina&nbsp;"+g.cost+"&euro;  ":"")+"<span style=\"white-space:nowrap;\">"+j.join("")+"</span></td></tr></tbody></table><div class=\"RouteDetails\" style=\""+(f?"display:none;":"")+"\">"),e.push(i.join("")+"</a></div></div>")}if(d.length>0){pg.fTogglePlannerOptions(!1),b&&document.body.className.indexOf("Map")>=0&&(pg.mapShowAllStops=-Math.abs(pg.mapShowAllStops),pg.fUrlSetMap({optimalRoute:1}));if(cfg.defaultCity==="latvia"){ti.TimeZoneOffset=2;var u="http://routelatvia.azurewebsites.net/?";u+="origin="+a.start_stops,u+="&destination="+a.finish_stops,u+="&departure_time="+ti.toUnixTime(a.date,a.start_time),e.push("<br/><a target=\"_blank\" href=\""+u+"\">"+u+"</a>"),e.push("<div id=\"online_results\">"),a.online_query_url?e.push("<a target=\"_blank\" href=\""+a.online_query_url+"\">"+a.online_query_url+"</a>"):b||e.push("<br/>Calculating alternative routes...");if(a.online_results_JSON){var d=JSON.parse(a.online_results_JSON);e.push("<div style=\"white-space:pre;\">",JSON.stringify(d,null,4),"</div>")}e.push("</div>")}}else e.push("<br/>"+i18n.noOptimalRoutes);var v=$("divContentPlannerResults");(v||{}).innerHTML=e.join("")},pg.fMakeRouteRowHTML=function(a,b,c,d,e){var f,g="map,"+a.city+","+a.transport+","+a.num;cfg.city.showAllDirections&&(g=g+","+a.dirType),g=ti.toAscii(g,!0),b=="tblRoutes"?(f=pg.fUrlSet({schedule:{city:a.city,transport:a.transport,num:a.num,dirType:a.dirType},hashForMap:""},!0),pg.routesFilter&&(g+=","+a.dirType),g=pg.fUrlSet({hashForMap:g},!0)):(f=pg.fUrlSet({schedule:{city:a.city,transport:a.transport,num:a.num,dirType:a.dirType,stopId:a.stopId},hashForMap:""},!0),g=pg.fUrlSet({hashForMap:g+","+a.dirType+","+a.stopId},!0));var h="<a style=\"display:inline-block\" href=\"#"+f+"\" title=\""+i18n.showSchedule+"\">",i="";for(var j=1;j<=7;j++)if((a.weekdays||"").indexOf(j)<0)i+="<span class=\"blankday\" title=\""+i18n["weekdays"+j]+": "+i18n.routeNotOperate+"\">"+i18n.weekdaysShort[j]+"</span>";else{var k=a.validityPeriods[j-1];k=k?": "+i18n.validFrom+" "+pg.formatDate(k):"",i+="<span"+(j>=6?"":" class=\"weekend\"")+" title=\""+i18n["weekdays"+j]+k+"\">"+i18n.weekdaysShort[j]+"</span>"}cfg.city.planHandicappedOption!==!1&&(a.weekdays&&a.weekdays.indexOf("z")>=0&&(i+="<img src=\""+pg.imagesFolder+"handicapped.png\" alt=\"low floor\" title=\""+i18n.lowFloorVehicles+"\" />")),a.weekdays&&a.weekdays.indexOf("s")>=0&&(i+="<img src=\""+pg.imagesFolder+"minibus_16_1E90FF.png\" alt=\"small bus\" title=\""+i18n.smallBus12Service+"\" />"),a.weekdays&&a.weekdays.indexOf("b")>=0&&(i+="<img src=\""+pg.imagesFolder+"bicycle16.png\" alt=\"transfer bicycle\" title=\""+(i18n["transferBicycles_"+cfg.defaultCity]||i18n.transferBicycles)+"\" />");var l=h+(!0||b=="tblDepartingRoutes"?"":"<span class=\"icon icon_expand\" title=\""+i18n.showDetails+"\"></span>")+"<span class=\"icon icon_"+a.transport+"\"></span>";a.transport=="train"||a.transport=="metro"?l+="<span style=\"display:none;\">"+a.num+"</span>":l+="<span class=\"num num"+Math.min(a.num.length,4)+" "+a.transport+"\">"+a.numHTML+"</span>";if(e)var m={route:a,hash:f,times:[],zeroGround:[],notes:[]};var n="<span class=\"hover\">"+a.name+((a.commercial||"").indexOf("E")>=0?" ("+i18n.express+")":"")+"</span>";i+=pg.render_airport_icon(a.name,pg.routesFilter!="").replace("&nbsp;",""),n="<tr"+(b!="tblDepartingRoutes"&&c%2!=0?" class=\"white\"":"")+"><td class=\"routeName\"><a class=\"icon icon_map\" title=\""+i18n.showInMap+"\" href=\"#"+g+"\"></a>"+l+n+"</a>",n+="</td><td class=\"weekdays\"><a href=\"#"+f+"\">"+i+"</a></td><td class=\"lastcol\"></td></tr>";if(b==="tblDepartingRoutes"){if(cfg.city.doNotShowTimetables&&cfg.city.doNotShowTimetables[a.transport]&&a.departures.length&&a.departures[0]>=0)if((","+pg.inputStop+",").indexOf(","+a.stops[0]+",")<0){n+="<tr class=\"white\"><td class=\"DeparturesRow\" colspan=\"4\">",n+="</td></tr>";return n}n+="<tr class=\"white\"><td class=\"DeparturesRow\" colspan=\"4\"><span><span class=\"icon icon_collapse\"></span><span class=\"icon";var o=Infinity,p=Infinity,q=0,r=18;for(var s=a.departures.length;--s>=0;){var t=a.departures[s];if(t<0)continue;if(t<d)break;++q,t=~~t;var u=~~(t/60);if(o!=u){if(++q>r&&t<d)break;o=u}p=t}s<0&&q<r?n+="\">":n+=" icon_expand\" title=\""+i18n.stopShowAllDepartures+"\">";var v=-1;q=0;for(s=0;s<a.departures.length;++s){var t=a.departures[s];if(t<0)continue;e&&(m.times.push(~~(.5+t)),a.vehicles&&a.vehicles[s]&&m.zeroGround.push(a.vehicles[s].zeroGround)),t=~~t;var u=~~(t/60);t>=p&&++q,v!=u&&(v=u,t>=p&&++q,n+="</span></span><span style=\"display:inline-block;\"><span class=\"DeparturesHour"+(u<o||q>r?" collapse":"")+"\">&nbsp;"+u%24+"</span><span style=\"vertical-align:top\""+(t<p||q>r?" class=\"collapse\"":"")+">&#x200A;"),t==p&&(n+="</span><span style=\"vertical-align:top\">"),q==r+1&&(n+="</span><span style=\"vertical-align:top\" class=\"collapse\">"),t=t%60,n+=(t<10?"0":"")+t+" "}v===-1?(e&&m.notes.push(i18n.routeNotOperate),n+="</span><span>"+i18n.routeNotOperate):!q&&a.departures.length?(a.departures.sort(function(a,b){return a-b}),e&&m.times.length==0&&m.notes.push(i18n.stopLatestDeparture+"&nbsp;"+ti.printTime(a.departures[a.departures.length-1])),n+="</span><span style=\"cursor:default;\" class=\"hideWhenExpanded\">"+i18n.stopLatestDeparture+"&nbsp;"+ti.printTime(a.departures[a.departures.length-1])):q>r&&(n+="</span><span style=\"cursor:default;\" class=\"hideWhenExpanded\">..."),n+="</span></span></td></tr>",(v===-1||!q)&&a.dirType&&a.dirType.indexOf("d")>=0&&(n="")}return e?m:n},pg.fContent_Click=function(a){pg.stopSuggestedForMap&&(pg.stopSuggestedForMap="",pg.fSuggestedStopsHide());var b=a&&(a.target||a.srcElement);if(!b)return!0;var c,d,e;for(var f=b;f;f=f.parentNode){if((f.tagName||"").toLowerCase()==="tr")break;d||(c=f&&(f.className||"").toLowerCase(),c.indexOf("expand")<0?c.indexOf("collapse")<0?(f.href||"").indexOf("#")>=0&&(e=pg.fUrlParse(f.href),f.className.indexOf("map")<0?e.schedule?d=pg.fUrlSet({schedule:e.schedule},!0):(d="hash",e.language=pg.language,e.hashForMap||pg.hashForMap&&(pg.city===e.city&&pg.transport===e.transport?e.hashForMap=pg.hashForMap:e.hashForMap="map")):d=pg.fUrlSet({hashForMap:e.hashForMap},!0)):(d="collapse",b=f):(d="expand",b=f));if((f.tagName||"").toLowerCase()==="a")break;if((f.className||"").toLowerCase()==="departuresrow"&&d==="expand"){d="",f.className="DeparturesRowFull";break}if((f.className||"").toLowerCase()==="departuresrowfull"&&d==="collapse"){d="",f.className="DeparturesRow";break}}var g=[];while(f){f=f.parentNode,g=f&&f.getElementsByTagName("div")||[];if(g.length)break}d=="expand"?(b.className=b.className.replace("expand","collapse"),b.title=i18n.hideDetails,(g[0]||{style:{}}).style.display="",pg.schedule&&(pg.scheduleDetailsExpanded=!0),document.body.className.indexOf("Map")>=0&&pg.fUrlSetMap({optimalRoute:b.getAttribute("data-option-num")||1}),d=""):d=="collapse"?(b.className=b.className.replace("collapse","expand"),b.title=i18n.showDetails,(g[0]||{style:{}}).style.display="none",pg.schedule&&(pg.scheduleDetailsExpanded=!1),d=""):d=="hash"&&(pg.fUrlSet(e),d="");if(d||d===""){d&&Hash.go(d);return pg.cancelEvent(a)}return!0},pg.inputRoutes_KeyDown=function(a,b){var c=$("inputRoutes");b||(b=window.event?window.event.keyCode:a.keyCode),b==27?(c.value="",setTimeout(pg.fLoadRoutesList,200)):b!=9&&(c.className=="empty"&&(c.value="",c.className=""),pg.routesFilter="",setTimeout(pg.fLoadRoutesList,200))},pg.inputRoutes_Focus=function(){$e=$("inputRoutes"),$e.className==="empty"&&($e.className="",$e.value="")},pg.inputRoutes_Blur=function(){$e=$("inputRoutes"),$e&&!$e.value&&($e.value=i18n.typeRouteNameOrNumber,$e.className="empty")}